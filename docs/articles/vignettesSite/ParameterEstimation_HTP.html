<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>statgenHTP tutorial: 5. Estimation of parameters from time courses • statgenHTP</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="statgenHTP tutorial: 5. Estimation of parameters from time courses">
<meta property="og:description" content="statgenHTP">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">statgenHTP</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../index.html">
    <span class="fas fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../../articles/index.html">Vignettes</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="../../news/index.html">
    <span class="fas fa-newspaper-o"></span>
     
    news
  </a>
</li>
<li>
  <a href="../../reference/index.html">
    <span class="fas fa-file-code-o"></span>
     
    functions
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-seedling"></span>
     
    other packages
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="https://biometris.github.io/statgenSTA">statgenSTA</a>
    </li>
    <li>
      <a href="https://biometris.github.io/statgenGxE">statgenGxE</a>
    </li>
    <li>
      <a href="https://biometris.github.io/statgenGWAS">statgenGWAS</a>
    </li>
  </ul>
</li>
<li>
  <a href="https://github.com/Biometris/statgenHTP">
    <span class="fas fa-github fa-lg fab"></span>
     
    github
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="ParameterEstimation_HTP_files/header-attrs-2.7/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>statgenHTP tutorial: 5. Estimation of parameters from time courses</h1>
                        <h4 class="author">Emilie Millet, Bart-Jan van Rossum, Martin Boer, Fred van Eeuwijk</h4>
            
            <h4 class="date">2021-03-05</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/Biometris/statgenHTP/blob/master/vignettes/vignettesSite/ParameterEstimation_HTP.Rmd"><code>vignettes/vignettesSite/ParameterEstimation_HTP.Rmd</code></a></small>
      <div class="hidden name"><code>ParameterEstimation_HTP.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>This document presents the final step of the HTP data analysis: extracting interesting parameters from the modeled time courses <span class="citation">(Brien et al. 2020)</span>. For example, in the second data set from the PhenoArch platform, the maximum leaf area (from the P-splines) or the maximum leaf growth rate (from the first derivatives) are relevant parameters (see figure below). We could assess their variability in the genotypes and the difference between treatments, <em>e.g.</em> has the water scenario decreased the maximum leaf area?</p>
<p><img src="figures/psplinederiv_Arch.png" width="80%"></p>
<p>It is also possible to specify a period for the parameter estimation. For example, in the first data set from the Phenovator platform, we can select the period with the high light intensity (see figure below) and estimate the maximum slope during that period (from the first derivatives). This could be interpreted as a recovery rate of the photosystem II efficiency.</p>
<p><img src="figures/psplinederiv_Vator.png" width="80%"></p>
<p>These parameters could then be further analyzed, for example in a GxE analysis (see <a href="https://biometris.github.io/statgenGxE/index.html"><em>statgenGxE</em></a>), or a genetic analysis (see <a href="https://biometris.github.io/statgenGWAS/index.html"><em>statgenGWAS</em></a>).</p>
<p>The functions described in this tutorial can be applied to corrected data, genotypic means (BLUEs or BLUPS) (see <a href="SpatialModel_HTP.html"><strong>statgenHTP tutorial: 3. Correction for spatial trends</strong></a>) or on raw data. It allows estimating maximum, minimum, mean, area under the curve (auc) or percentile using predicted values, first or second derivative, during a given period or for the whole time course.</p>
<hr>
</div>
<div id="estimation-of-parameters-from-curves" class="section level1">
<h1 class="hasAnchor">
<a href="#estimation-of-parameters-from-curves" class="anchor"></a>Estimation of parameters from curves</h1>
<div id="example-1" class="section level2">
<h2 class="hasAnchor">
<a href="#example-1" class="anchor"></a>Example 1</h2>
<p>We will use the <code>fit.splineNumOut</code> previously created (see <a href="OutlierSerieObs_HTP.html"><strong>statgenHTP tutorial: 4. Outlier detection for series of observations</strong></a>). It contains the P-spline prediction on a subset of plants without the time course outliers. We will estimate the area under the curve of the trait:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">subGenoVator</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"G070"</span>, <span class="st">"G160"</span>, <span class="st">"G151"</span>, <span class="st">"G179"</span>, <span class="st">"G175"</span>, <span class="st">"G004"</span>, <span class="st">"G055"</span><span class="op">)</span>
<span class="va">paramVator1</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="../../reference/estimateSplineParameters.html">estimateSplineParameters</a></span><span class="op">(</span>HTPSpline <span class="op">=</span> <span class="va">fit.splineNumOut</span>,
                           estimate <span class="op">=</span> <span class="st">"predictions"</span>,
                           what <span class="op">=</span> <span class="st">"AUC"</span>,
                           timeMin <span class="op">=</span> <span class="fl">330</span>,
                           timeMax <span class="op">=</span> <span class="fl">432</span>,
                           genotypes <span class="op">=</span> <span class="va">subGenoVator</span><span class="op">)</span>

<span class="fu">ggplot</span><span class="op">(</span><span class="va">paramVator1</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">genotype</span>, y <span class="op">=</span> <span class="va">AUC_predictions</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_boxplot</span><span class="op">(</span>na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ylab</span><span class="op">(</span><span class="st">"AUC of EffPsII"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="ParameterEstimation_HTP_files/figure-html/paramVator-1.png" width="384"></p>
<p>For this subset of genotypes, there is a variability in AUC of the psII efficiency. This could be used in genetic analysis and maybe to perform a GWAS.</p>
<p>Another example is using the derivative during the recovery period (at the end of the time course, so after the light change) to get the maximum slope, or the maximum rate of the psII per time unit during this period.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">paramVator2</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="../../reference/estimateSplineParameters.html">estimateSplineParameters</a></span><span class="op">(</span>HTPSpline <span class="op">=</span> <span class="va">fit.splineNumOut</span>,
                           estimate <span class="op">=</span> <span class="st">"derivatives"</span>,
                           what <span class="op">=</span> <span class="st">"max"</span>,
                           timeMin <span class="op">=</span> <span class="fl">210</span>,
                           timeMax <span class="op">=</span> <span class="fl">312</span>,
                           genotypes <span class="op">=</span> <span class="va">subGenoVator</span><span class="op">)</span>

<span class="fu">ggplot</span><span class="op">(</span><span class="va">paramVator2</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">genotype</span>, y <span class="op">=</span> <span class="va">max_derivatives</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_boxplot</span><span class="op">(</span>na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ylab</span><span class="op">(</span><span class="st">"Max recovery slope"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="ParameterEstimation_HTP_files/figure-html/paramVator2-1.png" width="384"></p>
<blockquote>
<p>Note: when “min” or “max” is selected, the output also contains the parameter occurence time point, as numerical <code>timeNumber</code> and date <code>timePoint</code>. See in the table below:</p>
</blockquote>
<table class="table">
<thead><tr class="header">
<th align="center">genotype</th>
<th align="center">plotId</th>
<th align="center">max_derivatives</th>
<th align="center">max_timeNumber</th>
<th align="center">max_timePoint</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">G004</td>
<td align="center">c11r55</td>
<td align="center">0.0067723</td>
<td align="center">227.7778</td>
<td align="center">2018-06-10 04:23:40</td>
</tr>
<tr class="even">
<td align="center">G004</td>
<td align="center">c13r20</td>
<td align="center">0.0084969</td>
<td align="center">226.0000</td>
<td align="center">2018-06-10 02:37:00</td>
</tr>
<tr class="odd">
<td align="center">G004</td>
<td align="center">c19r15</td>
<td align="center">0.0073180</td>
<td align="center">232.0000</td>
<td align="center">2018-06-10 08:37:00</td>
</tr>
<tr class="even">
<td align="center">G004</td>
<td align="center">c21r45</td>
<td align="center">0.0091551</td>
<td align="center">223.3333</td>
<td align="center">2018-06-09 23:57:00</td>
</tr>
<tr class="odd">
<td align="center">G004</td>
<td align="center">c24r48</td>
<td align="center">0.0080869</td>
<td align="center">224.2222</td>
<td align="center">2018-06-10 00:50:20</td>
</tr>
<tr class="even">
<td align="center">G004</td>
<td align="center">c2r15</td>
<td align="center">0.0079296</td>
<td align="center">226.0000</td>
<td align="center">2018-06-10 02:37:00</td>
</tr>
</tbody>
</table>
</div>
<div id="example-2" class="section level2">
<h2 class="hasAnchor">
<a href="#example-2" class="anchor"></a>Example 2</h2>
<p>For this example, we will use the genotypic prediction (BLUPs, see <a href="SpatialModel_HTP.html"><strong>statgenHTP tutorial: 3. Correction for spatial trends</strong></a>) available in the <code>spatPredArch</code> data set. We will fit P-splines at the genotypic level using the <code>geno.decomp</code> levels defined in the spatial model.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">spatPredArch</span><span class="op">)</span>  
<span class="va">fit.splineGenoArch</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/fitSpline.html">fitSpline</a></span><span class="op">(</span>inDat <span class="op">=</span> <span class="va">spatPredArch</span>, 
                                trait <span class="op">=</span> <span class="st">"predicted.values"</span>,
                                knots <span class="op">=</span> <span class="fl">15</span>,
                                minNoTP <span class="op">=</span> <span class="fl">18</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">fit.splineGenoArch</span>, 
     genotypes <span class="op">=</span> <span class="st">"GenoA36"</span><span class="op">)</span></code></pre></div>
<p><img src="ParameterEstimation_HTP_files/figure-html/fitSplineArch-1.png" width="576"></p>
<p>We can estimate the maximum value of the leaf area from the predicted P-splines:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">paramArch1</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="../../reference/estimateSplineParameters.html">estimateSplineParameters</a></span><span class="op">(</span>HTPSpline <span class="op">=</span> <span class="va">fit.splineGenoArch</span>,
                           estimate <span class="op">=</span> <span class="st">"predictions"</span>,
                           what <span class="op">=</span> <span class="st">"max"</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span><span class="va">paramArch1</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">max_predictions</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_histogram</span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">0.015</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">facet_grid</span><span class="op">(</span><span class="va">.</span> <span class="op">~</span> <span class="va">geno.decomp</span>, scales<span class="op">=</span><span class="st">"free_x"</span>,space <span class="op">=</span> <span class="st">"free_x"</span><span class="op">)</span></code></pre></div>
<p><img src="ParameterEstimation_HTP_files/figure-html/paramArch1fig-1.png" width="576"></p>
</div>
<div id="example-3" class="section level2">
<h2 class="hasAnchor">
<a href="#example-3" class="anchor"></a>Example 3</h2>
<p>For this example, we will use the raw data from the RootPhAir, corrected for individually outlying observations (see <a href="OutlierSingleObs_HTP.html"><strong>statgenHTP tutorial: 2. Outlier detection for single observations</strong></a>) and time course outliers (see <a href="OutlierSerieObs_HTP.html"><strong>statgenHTP tutorial: 4. Outlier detection Time course</strong></a>). We will fit P-splines at the plant level on a subset of genotypes.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">subGenoRoot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span> <span class="st">"2"</span>,<span class="st">"6"</span>,<span class="st">"8"</span>,<span class="st">"9"</span>,<span class="st">"10"</span>,<span class="st">"520"</span>,<span class="st">"522"</span><span class="op">)</span>
<span class="va">fit.splineRootOut</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/fitSpline.html">fitSpline</a></span><span class="op">(</span>inDat <span class="op">=</span> <span class="va">noCorrectedRootOut</span>,
                               trait <span class="op">=</span> <span class="st">"tipPos_y"</span>,
                               knots <span class="op">=</span> <span class="fl">10</span>,
                               genotypes <span class="op">=</span> <span class="va">subGenoRoot</span>,
                               minNoTP <span class="op">=</span> <span class="fl">0</span>,
                               useTimeNumber <span class="op">=</span> <span class="cn">TRUE</span>,
                               timeNumber <span class="op">=</span> <span class="st">"thermalTime"</span><span class="op">)</span></code></pre></div>
<p>We will then estimate the mean growth rate using <code>what = "mean"</code> for the subset of genotypes:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">paramRoot1</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="../../reference/estimateSplineParameters.html">estimateSplineParameters</a></span><span class="op">(</span>HTPSpline <span class="op">=</span> <span class="va">fit.splineRootOut</span>,
                           estimate <span class="op">=</span> <span class="st">"derivatives"</span>,
                           what <span class="op">=</span> <span class="st">"mean"</span><span class="op">)</span>

<span class="fu">ggplot</span><span class="op">(</span><span class="va">paramRoot1</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">genotype</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">mean_derivatives</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_boxplot</span><span class="op">(</span>na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ylab</span><span class="op">(</span><span class="st">"Max root tip growth rate"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">xlab</span><span class="op">(</span><span class="st">"genotype"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="ParameterEstimation_HTP_files/figure-html/paramRoot1-1.png" width="384"></p>
<hr>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Brien2020" class="csl-entry">
Brien, Chris, Nathaniel Jewell, Stephanie J. Watts-Williams, Trevor Garnett, and Bettina Berger. 2020. <span>“Smoothing and Extraction of Traits in the Growth Analysis of Noninvasive Phenotypic Data.”</span> <em>Plant Methods</em> 16 (1): 36. <a href="https://doi.org/10.1186/s13007-020-00577-6">https://doi.org/10.1186/s13007-020-00577-6</a>.
</div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Emilie J Millet, Maria Xose Rodriguez Alvarez, Diana Marcela Perez Valencia, Isabelle Sanchez, Nadine Hilgert, Bart-Jan van Rossum, Fred van Eeuwijk, Martin Boer.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
