<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>statgenHTP tutorial: 2. Outlier detection for single observations • statgenHTP</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="statgenHTP tutorial: 2. Outlier detection for single observations">
<meta property="og:description" content="statgenHTP">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">statgenHTP</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.4.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../articles/index.html">Vignettes</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="../news/index.html">
    <span class="fas fa-newspaper-o"></span>
     
    news
  </a>
</li>
<li>
  <a href="../reference/index.html">
    <span class="fas fa-file-code-o"></span>
     
    functions
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-seedling"></span>
     
    other packages
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="https://biometris.github.io/statgenSTA">statgenSTA</a>
    </li>
    <li>
      <a href="https://biometris.github.io/statgenGxE">statgenGxE</a>
    </li>
    <li>
      <a href="https://biometris.github.io/statgenGWAS">statgenGWAS</a>
    </li>
  </ul>
</li>
<li>
  <a href="https://github.com/Biometris/statgenHTP">
    <span class="fas fa-github fa-lg"></span>
     
    github
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="OutlierSingleObs_HTP_files/header-attrs-2.7/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>statgenHTP tutorial: 2. Outlier detection for single observations</h1>
                        <h4 class="author">Emilie Millet, Bart-Jan van Rossum, Isabelle Sanchez, Nadine Hilgert</h4>
            
            <h4 class="date">2021-02-23</h4>
      
      
      <div class="hidden name"><code>OutlierSingleObs_HTP.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>An outlier is usually defined as an observation that appears to be inconsistent with the remainder of the data set <span class="citation">(Barnett and Lewis 1994)</span>. Observations may be single time points <span class="citation">(Grubbs 1950)</span> or whole time courses of one or more variables <span class="citation">(Hubert, Rousseeuw, and Segaert 2015)</span>. An illustration is given below, where we see the difficulty of deciding whether a biomass time course (red curve at the bottom left) is atypical in a set of time courses from plants of the same genotype, or whether this slow growth is due to the plant’s position in the platform.</p>
<div class="figure">
<img src="figures/heatmap.png" alt="Heatmap of the biomass estimated at a specific time point (with a color gradient) of each plant according to its location in the platform (line, position). Well-watered (WW) treatment on the left, water deficit (WD) on the right. The plots show the biomass time courses for a given genotype (3 repetitions in each treatment). The question is whether the red growth curve on the left corresponds to an outlier plant (seed problem for example) or whether this slow growth is due to the plant's location in the platform (PhenoArch Platform, INRAE). *Courtesy: Llorenç Cabrera-Bosquet and Santiago Alvarez Prado.*" width="80%"><p class="caption">
Heatmap of the biomass estimated at a specific time point (with a color gradient) of each plant according to its location in the platform (line, position). Well-watered (WW) treatment on the left, water deficit (WD) on the right. The plots show the biomass time courses for a given genotype (3 repetitions in each treatment). The question is whether the red growth curve on the left corresponds to an outlier plant (seed problem for example) or whether this slow growth is due to the plant’s location in the platform (PhenoArch Platform, INRAE). <em>Courtesy: Llorenç Cabrera-Bosquet and Santiago Alvarez Prado.</em>
</p>
</div>
<p>The concept of outlier can be extended to “outlier plants,” defined here as biological replicates deviating from the overall distribution of plants on a multi-criteria basis, regardless of the quality of measurements <span class="citation">(Alvarez Prado et al. 2019)</span>.</p>
<p>This documents describes the procedures to detect outlying single observations in a time course with examples on experimental data measured directly on the plants or indirectly via image analysis for example.</p>
<hr>
</div>
<div id="definition-of-outlying-single-observation" class="section level1">
<h1 class="hasAnchor">
<a href="#definition-of-outlying-single-observation" class="anchor"></a>Definition of outlying single observation</h1>
<p>Time courses of phenotypic data are viewed as continuous time-related functions. The first cleaning step consists in roughly checking the consistency of each point with its neighbors within a time course. Outlying single observations are measurements at a given time that do not follow the expected behavior. The detection of outlying observations is done “one time course after the other.” Identifying and removing these points will facilitate the outlier detection of series of observations or plants, as proposed in <a href="OutlierSerieObs_HTP.html"><strong>statgenHTP tutorial: 4. Outlier detection for series of observations</strong></a>.</p>
<p>The detection requires fitting a model from the data, as a function of time. Two types of models can be used, one based on nonlinear parametric regression (Gompertz Model or sigmoidal function for example) and the other on non-parametric regression. Data annotation is based on the comparison of the experimental data with its estimated value from the model. If they significantly differ, the data will be annotated as suspect.</p>
<blockquote>
<p><em>NOTE: We only consider non-parametric regression in this package because of its flexibility to fit any type of curve.</em></p>
</blockquote>
</div>
<div id="illustration-of-the-non-parametric-function" class="section level1">
<h1 class="hasAnchor">
<a href="#illustration-of-the-non-parametric-function" class="anchor"></a>Illustration of the non-parametric function</h1>
<p>Local regression is a well known smoothing technique which locally approximates an unknown function by parametric functions. It is a two-step procedure included in the <code>detectSingleOut</code> function: the <code>locfit()</code> <a href="https://cran.r-project.org/web/packages/locfit/index.html">function</a> fits a local regression at a set of points, then, the <code><a href="https://rdrr.io/r/stats/predict.html">predict()</a></code> function is used to interpolate this fit to other points. A confidence interval can then be calculated. Points outside this interval will be annotated as outliers.</p>
<p>The user can set:</p>
<ul>
<li><p>the smoothing parameter <code>nnLocfit</code>. This is the parameter <code>nn</code> from the locfit package (Nearest neighbor component of the smoothing parameter). This parameter values range from 0 to 1, with the higher the value, the smoother the curve.</p></li>
<li><p>the level at which the confidence interval <code>confIntSize</code> is calculated. A large value calculates a wide interval and fewer outliers are annotated.</p></li>
<li><p>the parameter <code>checkEdges</code>. By setting this parameter to <code>TRUE</code> (the default), before the local regression a check is done to determine if the first and last time point in the time series for a plot are outliers. The <code>locfit</code> function sometimes has problems determining these outliers. The use of this parameter is demonstrated in example 2.</p></li>
</ul>
<p>The functions are illustrated with the three example data sets. For more information about the data, see <a href="Intro_HTP.html"><strong>statgenHTP tutorial: 1. Introduction, data description and preparation</strong></a>.</p>
<div id="example-1" class="section level2">
<h2 class="hasAnchor">
<a href="#example-1" class="anchor"></a>Example 1</h2>
<p>First a <code>TP</code> object is created containing all the time points.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">PhenovatorDat1</span> <span class="op">&lt;-</span> <span class="va">PhenovatorDat1</span><span class="op">[</span><span class="op">!</span><span class="va">PhenovatorDat1</span><span class="op">$</span><span class="va">pos</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"c24r41"</span>, <span class="st">"c7r18"</span>, <span class="st">"c7r49"</span><span class="op">)</span>, <span class="op">]</span>
<span class="co">## Create a TP object containing the data from the Phenovator.</span>
<span class="va">phenoTP</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createTimePoints.html">createTimePoints</a></span><span class="op">(</span>dat <span class="op">=</span> <span class="va">PhenovatorDat1</span>,
                            experimentName <span class="op">=</span> <span class="st">"Phenovator"</span>,
                            genotype <span class="op">=</span> <span class="st">"Genotype"</span>,
                            timePoint <span class="op">=</span> <span class="st">"timepoints"</span>,
                            repId <span class="op">=</span> <span class="st">"Replicate"</span>,
                            plotId <span class="op">=</span> <span class="st">"pos"</span>,
                            rowNum <span class="op">=</span> <span class="st">"y"</span>, colNum <span class="op">=</span> <span class="st">"x"</span>,
                            addCheck <span class="op">=</span> <span class="cn">TRUE</span>,
                            checkGenotypes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"check1"</span>, <span class="st">"check2"</span>, <span class="st">"check3"</span>, <span class="st">"check4"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>We are then running the function on a subset of plants to set the parameters, using the <code>plotIds</code> option. The smoothing parameter <code>nnLocfit</code> is set at 0.1. The curves are atypical and to detect only the very strange points, fitted curves cannot be too smooth. The confidence interval size <code>confIntSize</code> is set at 3 which is a relatively narrow interval.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># First select a subset of plants, for example here 8 plants.</span>
<span class="va">plantSel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"c1r17"</span>,<span class="st">"c13r17"</span>,<span class="st">"c6r51"</span>,<span class="st">"c21r24"</span>,<span class="st">"c5r54"</span>,<span class="st">"c21r32"</span>,<span class="st">"c14r48"</span>,<span class="st">"c5r26"</span><span class="op">)</span> 
<span class="co"># Then run on the subset</span>
<span class="va">resuVatorHTP</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/detectSingleOut.html">detectSingleOut</a></span><span class="op">(</span>TP <span class="op">=</span> <span class="va">phenoTP</span>,
                                trait <span class="op">=</span> <span class="st">"EffpsII"</span>,
                                plotIds <span class="op">=</span> <span class="va">plantSel</span>,
                                confIntSize <span class="op">=</span> <span class="fl">3</span>,
                                nnLocfit <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left"></th>
<th align="center">plotId</th>
<th align="center">timePoint</th>
<th align="center">EffpsII</th>
<th align="center">yPred</th>
<th align="center">sd_yPred</th>
<th align="center">lwr</th>
<th align="center">upr</th>
<th align="center">outlier</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">14</td>
<td align="center">c13r17</td>
<td align="center">2018-06-06 14:37:00</td>
<td align="center">0.685</td>
<td align="center">0.6652226</td>
<td align="center">0.0296058</td>
<td align="center">0.5764051</td>
<td align="center">0.7540400</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="left">15</td>
<td align="center">c13r17</td>
<td align="center">2018-06-06 16:37:00</td>
<td align="center">0.638</td>
<td align="center">0.6457325</td>
<td align="center">0.0421541</td>
<td align="center">0.5192701</td>
<td align="center">0.7721948</td>
<td align="center">0</td>
</tr>
<tr class="odd">
<td align="left">16</td>
<td align="center">c13r17</td>
<td align="center">2018-06-07 09:07:00</td>
<td align="center">0.690</td>
<td align="center">0.6931412</td>
<td align="center">0.0488887</td>
<td align="center">0.5464752</td>
<td align="center">0.8398073</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="left">17</td>
<td align="center">c13r17</td>
<td align="center">2018-06-07 11:37:00</td>
<td align="center">0.649</td>
<td align="center">0.6598289</td>
<td align="center">0.0302392</td>
<td align="center">0.5691112</td>
<td align="center">0.7505465</td>
<td align="center">0</td>
</tr>
<tr class="odd">
<td align="left">18</td>
<td align="center">c13r17</td>
<td align="center">2018-06-07 14:37:00</td>
<td align="center">0.668</td>
<td align="center">0.6556880</td>
<td align="center">0.0223011</td>
<td align="center">0.5887847</td>
<td align="center">0.7225913</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="left">19</td>
<td align="center">c13r17</td>
<td align="center">2018-06-07 16:37:00</td>
<td align="center">0.663</td>
<td align="center">0.6681819</td>
<td align="center">0.0401541</td>
<td align="center">0.5477196</td>
<td align="center">0.7886443</td>
<td align="center">0</td>
</tr>
</tbody>
</table>
<p>The function output is a <code>data.frame</code> containing for each plant at each time point: the predicted value, <code>yPred</code>, the standard deviation of the prediction, <code>sd_yPred</code>, the limits of the confidence interval, <code>lwr</code> and <code>upr</code>, and the <code>outlier</code> status. When a point is annotated as outlying, the last column value is 1, it is 0 otherwise.</p>
<p>The predicted values can be visualized to adjust the smoothing parameter and the confidence interval using the <code>plot</code> function. The option <code>outOnly</code>, default value <code>TRUE</code>, enables visualizing only plants with annotated outliers. Here, we are visualizing one plant and then all the selected plants to check the prediction.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">resuVatorHTP</span>,
     plotIds <span class="op">=</span> <span class="st">"c13r17"</span>,
     outOnly <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p><img src="OutlierSingleObs_HTP_files/figure-html/plotOutVatorFA1-1.png" width="480" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">resuVatorHTP</span>,
     plotIds <span class="op">=</span> <span class="va">plantSel</span>,
     outOnly <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p><img src="OutlierSingleObs_HTP_files/figure-html/plotOutVatorFA2-1.png" width="672" style="display: block; margin: auto;"></p>
<p>In the plots, the black points are the raw data, the red line is the predicted curve, the green lines are the lower and upper limits of the confidence interval. Outlying points are highlighted in blue.</p>
<p>The annotated points can be replaced by NA for the studied trait using the function <code>removeSingleOut</code>. It creates a new <code>TP</code> object.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">phenoTPOut</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/removeSingleOut.html">removeSingleOut</a></span><span class="op">(</span><span class="va">phenoTP</span>,
                              <span class="va">resuVatorHTP</span><span class="op">)</span>
<span class="co"># Check one value annotated as outlier in the original TP object</span>
<span class="va">phenoTP</span><span class="op">[[</span><span class="fl">16</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">phenoTP</span><span class="op">[[</span><span class="fl">16</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">plotId</span><span class="op">==</span><span class="st">"c14r32"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"plotId"</span>, <span class="st">"EffpsII"</span><span class="op">)</span><span class="op">]</span>
<span class="co">#&gt;    plotId EffpsII</span>
<span class="co">#&gt; 16 c14r32    0.63</span>
<span class="co"># Check the same value in the new TP object</span>
<span class="va">phenoTPOut</span><span class="op">[[</span><span class="fl">16</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">phenoTPOut</span><span class="op">[[</span><span class="fl">16</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">plotId</span><span class="op">==</span><span class="st">"c14r32"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"plotId"</span>, <span class="st">"EffpsII"</span><span class="op">)</span><span class="op">]</span>
<span class="co">#&gt;    plotId EffpsII</span>
<span class="co">#&gt; 16 c14r32    0.63</span></code></pre></div>
</div>
<div id="example-2" class="section level2">
<h2 class="hasAnchor">
<a href="#example-2" class="anchor"></a>Example 2</h2>
<p>First a <code>TP</code> object is created containing all the time points.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">phenoTParch</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createTimePoints.html">createTimePoints</a></span><span class="op">(</span>dat <span class="op">=</span> <span class="va">PhenoarchDat1</span>,
                                experimentName <span class="op">=</span> <span class="st">"Phenoarch"</span>,
                                genotype <span class="op">=</span> <span class="st">"geno"</span>,
                                timePoint <span class="op">=</span> <span class="st">"Time"</span>,
                                plotId <span class="op">=</span> <span class="st">"pos"</span>,
                                rowNum <span class="op">=</span> <span class="st">"Row"</span>,
                                colNum <span class="op">=</span> <span class="st">"Col"</span><span class="op">)</span></code></pre></div>
<p>We are then running the function on a subset of plants to set the parameters, using the <code>plotIds</code> option. The smoothing parameter <code>nnLocfit</code> is set at 0.5. The curves are linear and medium smooth is enough. The confidence interval size <code>confIntSize</code> is set at 5 which is a medium interval.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># First select a subset of plants, for example here 7 plants </span>
<span class="va">plantSelArch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"c22r7"</span>, <span class="st">"c8r22"</span>, <span class="st">"c1r10"</span>, <span class="st">"c21r43"</span>, <span class="st">"c14r15"</span>, <span class="st">"c25r12"</span>, <span class="st">"c6r54"</span><span class="op">)</span>
<span class="co"># Then run on the subset</span>
<span class="va">resuArchHTP</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/detectSingleOut.html">detectSingleOut</a></span><span class="op">(</span>TP <span class="op">=</span> <span class="va">phenoTParch</span>,
                               trait <span class="op">=</span> <span class="st">"LA_Estimated"</span>,
                               plotIds <span class="op">=</span> <span class="va">plantSelArch</span>,
                               confIntSize <span class="op">=</span> <span class="fl">5</span>,
                               nnLocfit <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left"></th>
<th align="center">plotId</th>
<th align="center">timePoint</th>
<th align="center">LA_Estimated</th>
<th align="center">yPred</th>
<th align="center">sd_yPred</th>
<th align="center">lwr</th>
<th align="center">upr</th>
<th align="center">outlier</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">22</td>
<td align="center">c14r15</td>
<td align="center">2017-05-09</td>
<td align="center">0.3095688</td>
<td align="center">0.2998288</td>
<td align="center">0.0023225</td>
<td align="center">0.2882164</td>
<td align="center">0.3114412</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="left">23</td>
<td align="center">c14r15</td>
<td align="center">2017-05-11</td>
<td align="center">0.3268933</td>
<td align="center">0.3305959</td>
<td align="center">0.0023188</td>
<td align="center">0.3190019</td>
<td align="center">0.3421899</td>
<td align="center">0</td>
</tr>
<tr class="odd">
<td align="left">24</td>
<td align="center">c14r15</td>
<td align="center">2017-05-12</td>
<td align="center">0.3420478</td>
<td align="center">0.3450079</td>
<td align="center">0.0028001</td>
<td align="center">0.3310072</td>
<td align="center">0.3590086</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="left">25</td>
<td align="center">c14r15</td>
<td align="center">2017-05-13</td>
<td align="center">0.3621102</td>
<td align="center">0.3587838</td>
<td align="center">0.0037381</td>
<td align="center">0.3400936</td>
<td align="center">0.3774741</td>
<td align="center">0</td>
</tr>
<tr class="odd">
<td align="left">26</td>
<td align="center">c14r15</td>
<td align="center">2017-05-15</td>
<td align="center">0.0910594</td>
<td align="center">0.3871152</td>
<td align="center">0.0062159</td>
<td align="center">0.3560358</td>
<td align="center">0.4181947</td>
<td align="center">1</td>
</tr>
</tbody>
</table>
<p>The prediction values can be visualized to adjust the smoothing parameter and the confidence interval using the <code>plot</code> function.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">resuArchHTP</span>,
     plotIds <span class="op">=</span> <span class="st">"c14r15"</span>,
     outOnly <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p><img src="OutlierSingleObs_HTP_files/figure-html/plotOutArchFA1-1.png" width="384" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">resuArchHTP</span>,
     plotIds <span class="op">=</span> <span class="va">plantSelArch</span>,
     outOnly <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p><img src="OutlierSingleObs_HTP_files/figure-html/plotOutArchFA2-1.png" width="672" style="display: block; margin: auto;"></p>
<p>In the plots, the black points are the raw data, the red line is the predicted curve, the green lines are the lower and upper limits of the confidence interval. Outlying points are highlighted in blue.</p>
<p>It is possible to run the outlier detection without first checking if the first and last time point are outlying. Doing this could be useful is some cases, but might give undesired results as well as the example below shows.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Detect outliers without first checking edges.</span>
<span class="va">resuArchHTPNoEdges</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/detectSingleOut.html">detectSingleOut</a></span><span class="op">(</span>TP <span class="op">=</span> <span class="va">phenoTParch</span>,
                                      trait <span class="op">=</span> <span class="st">"LA_Estimated"</span>,
                                      plotIds <span class="op">=</span> <span class="st">"c14r15"</span>,
                                      checkEdges <span class="op">=</span> <span class="cn">FALSE</span>,
                                      confIntSize <span class="op">=</span> <span class="fl">5</span>,
                                      nnLocfit <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">resuArchHTPNoEdges</span><span class="op">)</span></code></pre></div>
<p><img src="OutlierSingleObs_HTP_files/figure-html/plotOutVatorFA3-1.png" width="672" style="display: block; margin: auto;"></p>
<p>The annotated points can be replaced by NA for the studied trait using the function <code>removeSingleOut</code>. It creates a new <code>TP</code> object.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">phenoTParchOut</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/removeSingleOut.html">removeSingleOut</a></span><span class="op">(</span><span class="va">phenoTParch</span>,
                                  <span class="va">resuArchHTP</span><span class="op">)</span>
<span class="co"># Check one value annotated as outlier in the original TP object</span>
<span class="va">phenoTParch</span><span class="op">[[</span><span class="fl">30</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">phenoTParch</span><span class="op">[[</span><span class="fl">30</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">plotId</span><span class="op">==</span><span class="st">"c12r31"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"plotId"</span>, <span class="st">"LA_Estimated"</span><span class="op">)</span><span class="op">]</span>
<span class="co">#&gt;       plotId LA_Estimated</span>
<span class="co">#&gt; 37368 c12r31    0.2447164</span>
<span class="co"># Check the same value in the new TP object</span>
<span class="va">phenoTParchOut</span><span class="op">[[</span><span class="fl">30</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">phenoTParchOut</span><span class="op">[[</span><span class="fl">30</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">plotId</span><span class="op">==</span><span class="st">"c12r31"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"plotId"</span>, <span class="st">"LA_Estimated"</span><span class="op">)</span><span class="op">]</span>
<span class="co">#&gt;       plotId LA_Estimated</span>
<span class="co">#&gt; 37368 c12r31    0.2447164</span></code></pre></div>
</div>
<div id="example-3" class="section level2">
<h2 class="hasAnchor">
<a href="#example-3" class="anchor"></a>Example 3</h2>
<p>First a <code>TP</code> object is created containing all the time points.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rootTP</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createTimePoints.html">createTimePoints</a></span><span class="op">(</span>dat <span class="op">=</span> <span class="va">RootDat1</span>,
                           experimentName <span class="op">=</span> <span class="st">"UCL1"</span>,
                           genotype <span class="op">=</span> <span class="st">"Genotype"</span>,
                           timePoint <span class="op">=</span> <span class="st">"Time"</span>,
                           plotId <span class="op">=</span> <span class="st">"plantId"</span>,
                           rowNum <span class="op">=</span> <span class="st">"Strip"</span>,
                           colNum <span class="op">=</span> <span class="st">"Pos"</span><span class="op">)</span></code></pre></div>
<p>We are then running the function on a subset of plants to set the parameters, using the <code>plotIds</code> option. The smoothing parameter <code>nnLocfit</code> is set at 1. The curves are almost linear and a strong smooth is enough to get an accurate curve shape (line). The confidence interval size <code>confIntSize</code> is set at 5 which is a medium interval.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># First select a subset of plants, for example here 7 plants </span>
<span class="va">plantSelRoot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">RootDat1</span><span class="op">$</span><span class="va">plantId</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">7</span><span class="op">]</span>
<span class="co"># Then run on the subset</span>
<span class="va">resuRootHTP</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/detectSingleOut.html">detectSingleOut</a></span><span class="op">(</span>TP <span class="op">=</span> <span class="va">rootTP</span>,
                               trait <span class="op">=</span> <span class="st">"tipPos_y"</span>,
                               plotIds <span class="op">=</span> <span class="va">plantSelRoot</span>,
                               confIntSize <span class="op">=</span> <span class="fl">5</span>,
                               nnLocfit <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left"></th>
<th align="center">plotId</th>
<th align="center">timePoint</th>
<th align="center">tipPos_y</th>
<th align="center">yPred</th>
<th align="center">sd_yPred</th>
<th align="center">lwr</th>
<th align="center">upr</th>
<th align="center">outlier</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">38</td>
<td align="center">A_01_2</td>
<td align="center">2016-11-12 03:21:58</td>
<td align="center">6.775000</td>
<td align="center">6.355150</td>
<td align="center">0.1571693</td>
<td align="center">5.569304</td>
<td align="center">7.140996</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="left">39</td>
<td align="center">A_01_2</td>
<td align="center">2016-11-12 05:41:17</td>
<td align="center">6.760714</td>
<td align="center">6.451046</td>
<td align="center">0.1570347</td>
<td align="center">5.665872</td>
<td align="center">7.236219</td>
<td align="center">0</td>
</tr>
<tr class="odd">
<td align="left">40</td>
<td align="center">A_01_2</td>
<td align="center">2016-11-12 14:57:43</td>
<td align="center">6.775000</td>
<td align="center">6.856314</td>
<td align="center">0.1555333</td>
<td align="center">6.078648</td>
<td align="center">7.633981</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="left">41</td>
<td align="center">A_01_2</td>
<td align="center">2016-11-12 17:16:51</td>
<td align="center">6.921429</td>
<td align="center">6.965262</td>
<td align="center">0.1550652</td>
<td align="center">6.189936</td>
<td align="center">7.740588</td>
<td align="center">0</td>
</tr>
<tr class="odd">
<td align="left">42</td>
<td align="center">A_01_2</td>
<td align="center">2016-11-13 04:52:57</td>
<td align="center">6.014286</td>
<td align="center">7.576345</td>
<td align="center">0.1541887</td>
<td align="center">6.805402</td>
<td align="center">8.347288</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="left">43</td>
<td align="center">A_01_2</td>
<td align="center">2016-11-13 07:12:14</td>
<td align="center">5.728571</td>
<td align="center">7.711560</td>
<td align="center">0.1549867</td>
<td align="center">6.936627</td>
<td align="center">8.486493</td>
<td align="center">1</td>
</tr>
</tbody>
</table>
<p>The prediction values can be visualized to adjust the smoothing parameter and the confidence interval using the <code>plot</code> function.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">resuRootHTP</span>,
     plotIds <span class="op">=</span> <span class="st">"A_03_2"</span>,
     outOnly <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p><img src="OutlierSingleObs_HTP_files/figure-html/plotOutRootFA1-1.png" width="288" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">resuRootHTP</span>,
     plotIds <span class="op">=</span> <span class="va">plantSelRoot</span>,
     outOnly <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p><img src="OutlierSingleObs_HTP_files/figure-html/plotOutRootFA2-1.png" width="672" style="display: block; margin: auto;"></p>
<p>In the plots, the black points are the raw data, the red line is the predicted curve, the green lines are the lower and upper limits of the confidence interval. Outlying points are highlighted in blue.</p>
<p>The annotated points can be replaced by NA for the studied trait using the function <code>removeSingleOut</code>. It creates an new <code>TP</code> object.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rootTPOut</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/removeSingleOut.html">removeSingleOut</a></span><span class="op">(</span><span class="va">rootTP</span>,
                             <span class="va">resuRootHTP</span><span class="op">)</span>
<span class="co"># Check one value annotated as outlier in the original TP object</span>
<span class="va">rootTP</span><span class="op">[[</span><span class="fl">11127</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">rootTP</span><span class="op">[[</span><span class="fl">11127</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">plotId</span> <span class="op">==</span> <span class="st">"A_01_2"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"plotId"</span>, <span class="st">"tipPos_y"</span><span class="op">)</span><span class="op">]</span>
<span class="co">#&gt;    plotId tipPos_y</span>
<span class="co">#&gt; 42 A_01_2 6.014286</span>
<span class="co"># Check the same value in the new TP object</span>
<span class="va">rootTPOut</span><span class="op">[[</span><span class="fl">11127</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">rootTPOut</span><span class="op">[[</span><span class="fl">11127</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">plotId</span> <span class="op">==</span> <span class="st">"A_01_2"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"plotId"</span>, <span class="st">"tipPos_y"</span><span class="op">)</span><span class="op">]</span>
<span class="co">#&gt;    plotId tipPos_y</span>
<span class="co">#&gt; 42 A_01_2       NA</span></code></pre></div>
<hr>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-AlvarezPrado2019" class="csl-entry">
Alvarez Prado, Santiago, Isabelle Sanchez, Llorenç Cabrera-Bosquet, Antonin Grau, Claude Welcker, François Tardieu, and Nadine Hilgert. 2019. <span>“To Clean or Not to Clean Phenotypic Datasets for Outlier Plants in Genetic Analyses?”</span> <em>Journal of Experimental Botany</em> 70 (15): 3693–98. <a href="https://doi.org/10.1093/jxb/erz191">https://doi.org/10.1093/jxb/erz191</a>.
</div>
<div id="ref-BarnettLewis1994" class="csl-entry">
Barnett, Vic, and Tobby Lewis. 1994. <em>Outliers in Statistical Data</em>. Wiley Series in Probability and Statistics. Wiley. <a href="https://books.google.nl/books?id=B44QAQAAIAAJ">https://books.google.nl/books?id=B44QAQAAIAAJ</a>.
</div>
<div id="ref-Grubbs1950" class="csl-entry">
Grubbs, Frank E. 1950. <span>“Sample Criteria for Testing Outlying Observations.”</span> <em>Ann. Math. Statist.</em> 21 (1): 27–58. <a href="https://doi.org/10.1214/aoms/1177729885">https://doi.org/10.1214/aoms/1177729885</a>.
</div>
<div id="ref-Hubert2015" class="csl-entry">
Hubert, Mia, Peter J. Rousseeuw, and Pieter Segaert. 2015. <span>“Multivariate Functional Outlier Detection.”</span> <em>Statistical Methods <span>&amp;</span> Applications</em> 24 (2): 177–202. <a href="https://doi.org/10.1007/s10260-015-0297-8">https://doi.org/10.1007/s10260-015-0297-8</a>.
</div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Emilie J Millet, Maria Xose Rodriguez Alvarez, Diana Marcela Perez Valencia, Isabelle Sanchez, Nadine Hilgert, Bart-Jan van Rossum, Fred van Eeuwijk, Martin Boer.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
