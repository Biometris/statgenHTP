<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Fit spatial models per time point — fitModels • statgenHTP</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Fit spatial models per time point — fitModels" />
<meta property="og:description" content="Perform REML analysis at each time point using either SpATS or asreml. The
idea is to is to accurately separate the genetic effects from the spatial
effects at each time point. SpATS is used as a default method. See details
for the exact models fitted." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">statgenHTP</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../articles/index.html">Vignettes</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="../news/index.html">
    <span class="fas fa-newspaper-o"></span>
     
    news
  </a>
</li>
<li>
  <a href="../reference/index.html">
    <span class="fas fa-file-code-o"></span>
     
    functions
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-seedling"></span>
     
    other packages
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="https://biometris.github.io/statgenSTA">statgenSTA</a>
    </li>
    <li>
      <a href="https://biometris.github.io/statgenGxE">statgenGxE</a>
    </li>
    <li>
      <a href="https://biometris.github.io/statgenGWAS">statgenGWAS</a>
    </li>
  </ul>
</li>
<li>
  <a href="https://github.com/Biometris/statgenHTP">
    <span class="fas fa-github fa-lg fab"></span>
     
    github
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Fit spatial models per time point</h1>
    <small class="dont-index">Source: <a href='https://github.com/Biometris/statgenHTP/blob/master/R/fitModels.R'><code>R/fitModels.R</code></a></small>
    <div class="hidden name"><code>fitModels.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Perform REML analysis at each time point using either SpATS or asreml. The
idea is to is to accurately separate the genetic effects from the spatial
effects at each time point. SpATS is used as a default method. See details
for the exact models fitted.</p>
    </div>

    <pre class="usage"><span class='fu'>fitModels</span><span class='op'>(</span>
  <span class='va'>TP</span>,
  <span class='va'>trait</span>,
  timePoints <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>TP</span><span class='op'>)</span>,
  extraFixedFactors <span class='op'>=</span> <span class='cn'>NULL</span>,
  geno.decomp <span class='op'>=</span> <span class='cn'>NULL</span>,
  what <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"random"</span>, <span class='st'>"fixed"</span><span class='op'>)</span>,
  useCheck <span class='op'>=</span> <span class='cn'>FALSE</span>,
  useRepId <span class='op'>=</span> <span class='cn'>FALSE</span>,
  engine <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"SpATS"</span>, <span class='st'>"asreml"</span><span class='op'>)</span>,
  spatial <span class='op'>=</span> <span class='cn'>FALSE</span>,
  quiet <span class='op'>=</span> <span class='cn'>FALSE</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>TP</th>
      <td><p>An object of class <code>TP</code>.</p></td>
    </tr>
    <tr>
      <th>trait</th>
      <td><p>A character string indicating the trait used as response
variable in the model.</p></td>
    </tr>
    <tr>
      <th>timePoints</th>
      <td><p>A character or numeric vector indicating the time points
to be modeled. When using a character string to reference a time point, the
value has to be an exact match to one of the existing time points. When using
a number it will be matched by its number ("timeNumber") in the timePoints
attribute of the <code>TP</code> object.</p></td>
    </tr>
    <tr>
      <th>extraFixedFactors</th>
      <td><p>A character vector indicating the variables to use
as extra fixed effects in the model.</p></td>
    </tr>
    <tr>
      <th>geno.decomp</th>
      <td><p>A character vector indicating the variables to use to
group the genotypic variance in the model.</p></td>
    </tr>
    <tr>
      <th>what</th>
      <td><p>A character vector specifying whether "genotype" should
be fitted as "random" or "fixed" effect. Note that when using
<code>geno.decomp</code>, fitting a model with genotype as "fixed" effect is not
possible.</p></td>
    </tr>
    <tr>
      <th>useCheck</th>
      <td><p>Should check genotypes be used as an extra factor in the
model?</p></td>
    </tr>
    <tr>
      <th>useRepId</th>
      <td><p>Should repId be used as a fixed effect in the model? When
fitting a spatial model rowId and colId are also nested within repId in the
random part of the model.</p></td>
    </tr>
    <tr>
      <th>engine</th>
      <td><p>A character string indicating the engine used to fit the
models.</p></td>
    </tr>
    <tr>
      <th>spatial</th>
      <td><p>Should a spatial model be fitted for asreml?</p></td>
    </tr>
    <tr>
      <th>quiet</th>
      <td><p>Should printed progress messages be suppressed?</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>An object of class <code>fitMod</code>, a list of fitted models.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The actual model fitted depends on the function parameters specified. The
basic model is the following:<br />
trait = <strong>genotype</strong> + e<br />
In case <code>useCheck = TRUE</code>, instead of genotype, genoCheck is used as
genotype and check is used as an extra fixed effect. So then the model
becomes:<br />
trait = <em>check</em> + <strong>genoCheck</strong> + e<br />
Variables in <code>extraFixedFactors</code> are fitted as extra fixed
effects.<br /><br />
When <code>SpATS</code> is used for modeling, an extra spatial term is always
included in the model. This term is constructed using the function
<code><a href='https://rdrr.io/pkg/SpATS/man/PSANOVA.html'>PSANOVA</a></code> from the SpATS package as<br />
<code>PSANOVA(colNum, rowNum, nseg = nSeg, nest.div = 2)</code>
where<br /> <code>nSeg = c(number of columns, number of rows)</code>.<br /><br />
When <code>asreml</code> is used for modeling and <code>spatial = TRUE</code>,
four models are fitted with different covariance structures.
The best model is determined based on a goodness-of-fit criterion, AIC,
on 20% of the time points or at least 10 time points. The best model is then
run on all time points.
The following combinations of random and spatial terms are fitted</p><ul>
<li><p>random = repId:rowId + repId:colId, spatial = NULL</p></li>
<li><p>random = repId:rowId + repId:colId, spatial = ar1(rowId):colId</p></li>
<li><p>random = repId:colId + repId:colId, spatial = rowId:ar1(colId)</p></li>
<li><p>random = repId:rowId + repId:colId, spatial = ar1(rowId):ar1(colId)</p></li>
</ul><p>If there are no replicates in the model, repId is left out from the random
parts above.<br /><br />
When <code>geno.decomp</code> is specified, the genotypic variance is decomposed
following the variable(s) chosen. For example, when a treatment is used in
<code>geno.decomp</code>, the initial model becomes:<br />
trait = <em>treatment</em> + <strong>treatment:genotype</strong> + e<br /></p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Maria Xose Rodriguez-Alvarez, Martin P. Boer, Fred A. van Eeuwijk, Paul H.C.
Eilers (2017). Correcting for spatial heterogeneity in plant breeding
experiments with P-splines. Spatial Statistics
doi: <a href='https://doi.org/10.1016/j.spasta.2017.10.003'>10.1016/j.spasta.2017.10.003</a>

Butler, D. G., et al. (2018). ASReml-R Reference Manual Version 4. VSN
International Ltd, http://asreml.org</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p>Other functions for spatial modeling: 
<code><a href='getCorrected.html'>getCorrected</a>()</code>,
<code><a href='getEffDims.html'>getEffDims</a>()</code>,
<code><a href='getGenoPred.html'>getGenoPred</a>()</code>,
<code><a href='getHerit.html'>getHerit</a>()</code>,
<code><a href='getVar.html'>getVar</a>()</code>,
<code><a href='plot.fitMod.html'>plot.fitMod</a>()</code>,
<code><a href='summary.fitMod.html'>summary.fitMod</a>()</code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'>## Using the first example dataset (PhenovatorDat1):</span>
<span class='co'>## Fit a model using SpATS on few time points:</span>
<span class='co'># \donttest{</span>
<span class='co'>## Create an object of class TP.</span>
<span class='va'>phenoTP</span> <span class='op'>&lt;-</span> <span class='fu'><a href='createTimePoints.html'>createTimePoints</a></span><span class='op'>(</span>dat <span class='op'>=</span> <span class='va'>PhenovatorDat1</span>,
                            experimentName <span class='op'>=</span> <span class='st'>"Phenovator"</span>,
                            genotype <span class='op'>=</span> <span class='st'>"Genotype"</span>,
                            timePoint <span class='op'>=</span> <span class='st'>"timepoints"</span>,
                            repId <span class='op'>=</span> <span class='st'>"Replicate"</span>,
                            plotId <span class='op'>=</span> <span class='st'>"pos"</span>,
                            rowNum <span class='op'>=</span> <span class='st'>"y"</span>, colNum <span class='op'>=</span> <span class='st'>"x"</span>,
                            addCheck <span class='op'>=</span> <span class='cn'>TRUE</span>,
                            checkGenotypes <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"check1"</span>, <span class='st'>"check2"</span>,
                                               <span class='st'>"check3"</span>, <span class='st'>"check4"</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='warning'>Warning: The following plotIds have observations for less than 50% of the time points:</span>
#&gt; <span class='warning'>c24r41, c7r18, c7r49</span></div><div class='input'><span class='co'>## Fit a model with SpATS for three time points.</span>
<span class='va'>modPhenoSp</span> <span class='op'>&lt;-</span> <span class='fu'>fitModels</span><span class='op'>(</span>TP <span class='op'>=</span> <span class='va'>phenoTP</span>,
                        trait <span class='op'>=</span> <span class='st'>"EffpsII"</span>,
                        timePoints <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>3</span>, <span class='fl'>6</span>, <span class='fl'>20</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='message'>2018-06-01 11:37:00</span></div><div class='output co'>#&gt; <span class='message'>2018-06-02 09:07:00</span></div><div class='output co'>#&gt; <span class='message'>2018-06-05 14:37:00</span></div><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>modPhenoSp</span><span class='op'>)</span>
</div><div class='output co'>#&gt; Models in modPhenoSp where fitted for experiment Phenovator.
#&gt; 
#&gt; It contains 3 time points.
#&gt; The models were fitted using SpATS.
#&gt; </div><div class='input'>
<span class='co'>## Fit a model with SpATS for a single time point with extra fixed factors</span>
<span class='co'>## and check genotypes:</span>
<span class='va'>modPhenoSpCheck</span> <span class='op'>&lt;-</span> <span class='fu'>fitModels</span><span class='op'>(</span>TP <span class='op'>=</span> <span class='va'>phenoTP</span>,
                             trait <span class='op'>=</span> <span class='st'>"EffpsII"</span>,
                             extraFixedFactors <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"repId"</span>, <span class='st'>"Image_pos"</span><span class='op'>)</span>,
                             useCheck <span class='op'>=</span> <span class='cn'>TRUE</span>,
                             timePoints <span class='op'>=</span> <span class='fl'>3</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='message'>2018-06-01 11:37:00</span></div><div class='input'>

<span class='co'>## Fit a model with asreml on few time points with a spatial function:</span>
<span class='kw'>if</span> <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/ns-load.html'>requireNamespace</a></span><span class='op'>(</span><span class='st'>"asreml"</span>, quietly <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='va'>modPhenoSpAs</span> <span class='op'>&lt;-</span> <span class='fu'>fitModels</span><span class='op'>(</span>TP <span class='op'>=</span> <span class='va'>phenoTP</span>,
                            trait <span class='op'>=</span> <span class='st'>"EffpsII"</span>,
                            timePoints <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>6</span>, <span class='fl'>20</span><span class='op'>)</span>,
                            engine <span class='op'>=</span> <span class='st'>"asreml"</span>,
                            spatial <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
<span class='op'>}</span>
</div><div class='output co'>#&gt; Online License checked out Wed Jun  9 16:24:20 2021</div><div class='output co'>#&gt; <span class='message'>2018-05-31 16:37:00</span></div><div class='output co'>#&gt; <span class='message'>2018-06-02 09:07:00</span></div><div class='output co'>#&gt; <span class='message'>2018-06-05 14:37:00</span></div><div class='input'>
<span class='co'>## Using the second example dataset (PhenoarchDat1):</span>
<span class='co'>## Fit a model with SpATS on one time points with two variables for</span>
<span class='co'>## geno.decomp:</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='st'>"PhenoarchDat1"</span><span class='op'>)</span>
<span class='va'>phenoTParch</span> <span class='op'>&lt;-</span> <span class='fu'><a href='createTimePoints.html'>createTimePoints</a></span><span class='op'>(</span>dat <span class='op'>=</span> <span class='va'>PhenoarchDat1</span>,
                                experimentName <span class='op'>=</span> <span class='st'>"Phenoarch"</span>,
                                genotype <span class='op'>=</span> <span class='st'>"Genotype"</span>,
                                timePoint <span class='op'>=</span> <span class='st'>"Date"</span>,
                                plotId <span class='op'>=</span> <span class='st'>"pos"</span>,
                                rowNum <span class='op'>=</span> <span class='st'>"Row"</span>,
                                colNum <span class='op'>=</span> <span class='st'>"Col"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='warning'>Warning: More than 5 plotIds have observations for less than 50% of the time points. The first 5 are printed, to see them all run</span>
#&gt; <span class='warning'>              attr(..., 'plotLimObs') on the output</span>
#&gt; <span class='warning'>c10r36, c11r54, c12r47, c15r30, c18r9</span></div><div class='input'>
<span class='va'>modPhenoSpGD</span> <span class='op'>&lt;-</span> <span class='fu'>fitModels</span><span class='op'>(</span>TP <span class='op'>=</span> <span class='va'>phenoTParch</span>,
                          trait <span class='op'>=</span> <span class='st'>"LeafArea"</span>,
                          geno.decomp <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Scenario"</span>, <span class='st'>"population"</span><span class='op'>)</span>,
                          timePoints <span class='op'>=</span> <span class='fl'>16</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='message'>2017-04-28</span></div><div class='input'><span class='co'># }</span>


</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Emilie J Millet, Maria Xose Rodriguez Alvarez, Diana Marcela Perez Valencia, Isabelle Sanchez, Nadine Hilgert, Bart-Jan van Rossum, Fred van Eeuwijk, Martin Boer.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


