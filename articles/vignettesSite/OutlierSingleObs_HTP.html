<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>statgenHTP tutorial: 2. Outlier detection for single observations • statgenHTP</title>
<script src="../../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../../deps/headroom-0.11.0/headroom.min.js"></script><script src="../../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../../deps/search-1.0.0/fuse.min.js"></script><script src="../../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../../pkgdown.js"></script><meta property="og:title" content="statgenHTP tutorial: 2. Outlier detection for single observations">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../../index.html">statgenHTP</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.7.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../../index.html"><span class="fa fa-home"></span></a></li>
<li class="active nav-item"><a class="nav-link" href="../../articles/index.html">Vignettes</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="nav-link" href="../../news/index.html"><span class="fa fa-newspaper-o"></span> news</a></li>
<li class="nav-item"><a class="nav-link" href="../../reference/index.html"><span class="fa fa-file-code-o"></span> functions</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-other-packages" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true"><span class="fa fa-seedling"></span> other packages</button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-other-packages">
<li><a class="external-link dropdown-item" href="https://biometris.github.io/statgenSTA">statgenSTA</a></li>
    <li><a class="external-link dropdown-item" href="https://biometris.github.io/statgenGxE">statgenGxE</a></li>
    <li><a class="external-link dropdown-item" href="https://biometris.github.io/statgenGWAS">statgenGWAS</a></li>
    <li><a class="external-link dropdown-item" href="https://biometris.github.io/statgenQTLxT">statgenQTLxT</a></li>
    <li><a class="external-link dropdown-item" href="https://biometris.github.io/statgenIBD">statgenIBD</a></li>
    <li><a class="external-link dropdown-item" href="https://biometris.github.io/statgenMPP">statgenMPP</a></li>
    <li><a class="external-link dropdown-item" href="https://biometris.github.io/LMMsolver">LMMsolver</a></li>
  </ul>
</li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Biometris/statgenHTP"><span class="fa fa-github fa-lg fab"></span> github</a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>statgenHTP tutorial: 2. Outlier detection for single observations</h1>
                        <h4 data-toc-skip class="author">Emilie Millet,
Bart-Jan van Rossum, Isabelle Sanchez, Nadine Hilgert</h4>
            
            <h4 data-toc-skip class="date">2024-12-19</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/Biometris/statgenHTP/blob/main/vignettes/vignettesSite/OutlierSingleObs_HTP.Rmd" class="external-link"><code>vignettes/vignettesSite/OutlierSingleObs_HTP.Rmd</code></a></small>
      <div class="d-none name"><code>OutlierSingleObs_HTP.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>An outlier is usually defined as an observation that appears to be
inconsistent with the remainder of the data set <span class="citation">(<a href="#ref-BarnettLewis1994">Barnett and Lewis
1994</a>)</span>. Observations may be single time points <span class="citation">(<a href="#ref-Grubbs1950">Grubbs 1950</a>)</span> or
whole time courses of one or more variables <span class="citation">(<a href="#ref-Hubert2015">Hubert, Rousseeuw, and Segaert 2015</a>)</span>.
An illustration is given below, where we see the difficulty of deciding
whether a biomass time course (red curve at the bottom left) is atypical
in a set of time courses from plants of the same genotype, or whether
this slow growth is due to the plant’s position in the platform.</p>
<div class="figure">
<img src="figures%2Fheatmap.png" alt="Heatmap of the biomass estimated at a specific time point (with a color gradient) of each plant according to its location in the platform (line, position). Well-watered (WW) treatment on the left, water deficit (WD) on the right. The plots show the biomass time courses for a given genotype (3 repetitions in each treatment). The question is whether the red growth curve on the left corresponds to an outlier plant (e.g. a seed problem) or whether this slow growth is due to the plant's location in the platform (PhenoArch Platform, INRAE). *Courtesy: Llorenç Cabrera-Bosquet and Santiago Alvarez Prado.*" width="80%"><p class="caption">
Heatmap of the biomass estimated at a specific time point (with a color
gradient) of each plant according to its location in the platform (line,
position). Well-watered (WW) treatment on the left, water deficit (WD)
on the right. The plots show the biomass time courses for a given
genotype (3 repetitions in each treatment). The question is whether the
red growth curve on the left corresponds to an outlier plant (e.g. a
seed problem) or whether this slow growth is due to the plant’s location
in the platform (PhenoArch Platform, INRAE). <em>Courtesy: Llorenç
Cabrera-Bosquet and Santiago Alvarez Prado.</em>
</p>
</div>
<p>The concept of outlier can be extended to “outlier plants”, defined
here as biological replicates deviating from the overall distribution of
plants on a multi-criteria basis, regardless of the quality of
measurements <span class="citation">(<a href="#ref-AlvarezPrado2019">Alvarez Prado et al. 2019</a>)</span>.</p>
<p>This documents describes the procedures to detect outlying single
observations in a time course with examples on experimental data
measured directly on the plants or indirectly via image analysis for
example.</p>
<hr>
</div>
<div class="section level2">
<h2 id="definition-of-outlying-single-observation">Definition of outlying single observation<a class="anchor" aria-label="anchor" href="#definition-of-outlying-single-observation"></a>
</h2>
<p>Time courses of phenotypic data are viewed as continuous time-related
functions. The first cleaning step consists of roughly checking the
consistency of each point with its neighbors within a time course.
Outlying single observations are measurements that do not follow the
expected behavior at a given time. The detection of outlying
observations is done “one time course after the other”. Identifying and
removing these points will facilitate the outlier detection of series of
observations or plants, as proposed in <a href="OutlierSerieObs_HTP.html"><strong>statgenHTP tutorial: 4. Outlier
detection for series of observations</strong></a>.</p>
<p>The detection requires fitting a model from the data, as a function
of time. Two types of models can be used, one based on nonlinear
parametric regression (Gompertz Model or sigmoidal function for example)
and the other on non-parametric regression. Data annotation is based on
the comparison of the experimental data with its estimated value from
the model. If they differ significantly, the data will be annotated as
suspect.</p>
<blockquote>
<p><em>NOTE: We only consider non-parametric regression in this package
because of its flexibility to fit any type of curve.</em></p>
</blockquote>
</div>
<div class="section level2">
<h2 id="illustration-of-the-non-parametric-function">Illustration of the non-parametric function<a class="anchor" aria-label="anchor" href="#illustration-of-the-non-parametric-function"></a>
</h2>
<p>Local regression is a well known smoothing technique which locally
approximates an unknown function by parametric functions. It is a
two-step procedure included in the <code>detectSingleOut</code>
function: the <code>locfit()</code> <a href="https://CRAN.R-project.org/package=locfit" class="external-link">function</a> fits a
local regression at a set of points, then, the <code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code>
function is used to interpolate this fit to other points. A confidence
interval can then be calculated. Points outside this interval will be
annotated as outliers.</p>
<p>The user can set:</p>
<ul>
<li><p>the smoothing parameter <code>nnLocfit</code>. This is the
parameter <code>nn</code> from the locfit package (Nearest neighbor
component of the smoothing parameter). This parameter values range from
0 to 1, with the higher the value, the smoother the curve.</p></li>
<li><p>the level at which the confidence interval
<code>confIntSize</code> is calculated. A large value calculates a wide
interval and fewer outliers are annotated.</p></li>
<li><p>the parameter <code>checkEdges</code>. By setting this parameter
to <code>TRUE</code> (the default), before the local regression a check
is done to determine if the first and last time point in the time series
for a plot are outliers. The <code>locfit</code> function sometimes has
problems determining these outliers. The use of this parameter is
demonstrated in example 2.</p></li>
</ul>
<p>The functions are illustrated with the three example data sets. For
more information about the data, see <a href="Intro_HTP.html"><strong>statgenHTP tutorial: 1. Introduction, data
description and preparation</strong></a>.</p>
<div class="section level3">
<h3 id="example-1">Example 1<a class="anchor" aria-label="anchor" href="#example-1"></a>
</h3>
<p>First a <code>TP</code> object is created containing all the time
points.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">PhenovatorDat1</span> <span class="op">&lt;-</span> <span class="va">PhenovatorDat1</span><span class="op">[</span><span class="op">!</span><span class="va">PhenovatorDat1</span><span class="op">$</span><span class="va">pos</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"c24r41"</span>, <span class="st">"c7r18"</span>, <span class="st">"c7r49"</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="co">## Create a TP object containing the data from the Phenovator.</span></span>
<span><span class="va">phenoTP</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/createTimePoints.html">createTimePoints</a></span><span class="op">(</span>dat <span class="op">=</span> <span class="va">PhenovatorDat1</span>,</span>
<span>                            experimentName <span class="op">=</span> <span class="st">"Phenovator"</span>,</span>
<span>                            genotype <span class="op">=</span> <span class="st">"Genotype"</span>,</span>
<span>                            timePoint <span class="op">=</span> <span class="st">"timepoints"</span>,</span>
<span>                            repId <span class="op">=</span> <span class="st">"Replicate"</span>,</span>
<span>                            plotId <span class="op">=</span> <span class="st">"pos"</span>,</span>
<span>                            rowNum <span class="op">=</span> <span class="st">"y"</span>, colNum <span class="op">=</span> <span class="st">"x"</span>,</span>
<span>                            addCheck <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                            checkGenotypes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"check1"</span>, <span class="st">"check2"</span>, <span class="st">"check3"</span>, <span class="st">"check4"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We then run the function on a subset of plants to set the parameters,
using the <code>plotIds</code> option. The smoothing parameter
<code>nnLocfit</code> is set at 0.1. The curves are atypical and to
detect only the very strange points, fitted curves cannot be too smooth.
The confidence interval size <code>confIntSize</code> is set at 3 which
is a relatively narrow interval.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># First select a subset of plants, for example here 8 plants.</span></span>
<span><span class="va">plantSel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"c1r17"</span>,<span class="st">"c13r17"</span>,<span class="st">"c6r51"</span>,<span class="st">"c21r24"</span>,<span class="st">"c5r54"</span>,<span class="st">"c21r32"</span>,<span class="st">"c14r48"</span>,<span class="st">"c5r26"</span><span class="op">)</span> </span>
<span><span class="co"># Then run on the subset</span></span>
<span><span class="va">resuVatorHTP</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/detectSingleOut.html">detectSingleOut</a></span><span class="op">(</span>TP <span class="op">=</span> <span class="va">phenoTP</span>,</span>
<span>                                trait <span class="op">=</span> <span class="st">"EffpsII"</span>,</span>
<span>                                plotIds <span class="op">=</span> <span class="va">plantSel</span>,</span>
<span>                                confIntSize <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                                nnLocfit <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="8%">
<col width="25%">
<col width="9%">
<col width="12%">
<col width="12%">
<col width="12%">
<col width="12%">
<col width="9%">
</colgroup>
<thead><tr class="header">
<th align="center">plotId</th>
<th align="center">timePoint</th>
<th align="center">EffpsII</th>
<th align="center">yPred</th>
<th align="center">sd_yPred</th>
<th align="center">lwr</th>
<th align="center">upr</th>
<th align="center">outlier</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">c13r17</td>
<td align="center">2018-06-03 09:07:00</td>
<td align="center">0.751</td>
<td align="center">0.6852574</td>
<td align="center">0.0389194</td>
<td align="center">0.5684992</td>
<td align="center">0.8020156</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="center">c13r17</td>
<td align="center">2018-06-03 11:37:00</td>
<td align="center">0.538</td>
<td align="center">0.6833963</td>
<td align="center">0.0255016</td>
<td align="center">0.6068916</td>
<td align="center">0.7599011</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">c13r17</td>
<td align="center">2018-06-03 14:37:00</td>
<td align="center">0.737</td>
<td align="center">0.7045487</td>
<td align="center">0.0342136</td>
<td align="center">0.6019078</td>
<td align="center">0.8071896</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="center">c13r17</td>
<td align="center">2018-06-04 09:07:00</td>
<td align="center">0.619</td>
<td align="center">0.6330957</td>
<td align="center">0.0436610</td>
<td align="center">0.5021126</td>
<td align="center">0.7640788</td>
<td align="center">0</td>
</tr>
<tr class="odd">
<td align="center">c13r17</td>
<td align="center">2018-06-04 11:37:00</td>
<td align="center">0.711</td>
<td align="center">0.6655915</td>
<td align="center">0.0322765</td>
<td align="center">0.5687620</td>
<td align="center">0.7624211</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="center">c13r17</td>
<td align="center">2018-06-04 14:37:00</td>
<td align="center">0.633</td>
<td align="center">0.6861254</td>
<td align="center">0.0330415</td>
<td align="center">0.5870010</td>
<td align="center">0.7852499</td>
<td align="center">0</td>
</tr>
</tbody>
</table>
<p>The function output is a <code>data.frame</code> containing for each
plant at each time point: the predicted value, <code>yPred</code>, the
standard deviation of the prediction, <code>sd_yPred</code>, the limits
of the confidence interval, <code>lwr</code> and <code>upr</code>, and
the <code>outlier</code> status. When a point is annotated as outlying,
the value of the outlier column is 1, it is 0 otherwise.</p>
<p>The predicted values can be visualized to adjust the smoothing
parameter and the confidence interval using the <code>plot</code>
function. The option <code>outOnly</code>, default value
<code>TRUE</code>, enables visualizing only plants with annotated
outliers. Here, we are visualizing one plant and then all the selected
plants to check the prediction.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">resuVatorHTP</span>,</span>
<span>     plotIds <span class="op">=</span> <span class="st">"c13r17"</span>,</span>
<span>     outOnly <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in get(paste0(generic, ".", class), envir = get_method_env()) : </span></span>
<span><span class="co">#&gt;   object 'type_sum.accel' not found</span></span></code></pre></div>
<p><img src="OutlierSingleObs_HTP_files/figure-html/plotOutVatorFA1-1.png" width="480" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">resuVatorHTP</span>,</span>
<span>     plotIds <span class="op">=</span> <span class="va">plantSel</span>,</span>
<span>     outOnly <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="OutlierSingleObs_HTP_files/figure-html/plotOutVatorFA2-1.png" width="672" style="display: block; margin: auto;"></p>
<p>In the plots, the black dots are the raw data, the red line is the
predicted curve, the green lines are the lower and upper limits of the
confidence interval. Outlying points are highlighted in blue.</p>
<p>The annotated points can be replaced by NA for the studied trait
using the function <code>removeSingleOut</code>. It creates a new
<code>TP</code> object.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">phenoTPOut</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/removeSingleOut.html">removeSingleOut</a></span><span class="op">(</span><span class="va">phenoTP</span>,</span>
<span>                              <span class="va">resuVatorHTP</span><span class="op">)</span></span>
<span><span class="co"># Check one value annotated as outlier in the original TP object</span></span>
<span><span class="va">phenoTP</span><span class="op">[[</span><span class="fl">16</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">phenoTP</span><span class="op">[[</span><span class="fl">16</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">plotId</span><span class="op">==</span><span class="st">"c14r32"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"plotId"</span>, <span class="st">"EffpsII"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt;    plotId EffpsII</span></span>
<span><span class="co">#&gt; 16 c14r32    0.63</span></span>
<span><span class="co"># Check the same value in the new TP object</span></span>
<span><span class="va">phenoTPOut</span><span class="op">[[</span><span class="fl">16</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">phenoTPOut</span><span class="op">[[</span><span class="fl">16</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">plotId</span><span class="op">==</span><span class="st">"c14r32"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"plotId"</span>, <span class="st">"EffpsII"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt;    plotId EffpsII</span></span>
<span><span class="co">#&gt; 16 c14r32    0.63</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="example-2">Example 2<a class="anchor" aria-label="anchor" href="#example-2"></a>
</h3>
<p>First a <code>TP</code> object is created containing all the time
points.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">phenoTParch</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/createTimePoints.html">createTimePoints</a></span><span class="op">(</span>dat <span class="op">=</span> <span class="va">PhenoarchDat1</span>,</span>
<span>                                experimentName <span class="op">=</span> <span class="st">"Phenoarch"</span>,</span>
<span>                                genotype <span class="op">=</span> <span class="st">"Genotype"</span>,</span>
<span>                                timePoint <span class="op">=</span> <span class="st">"Date"</span>,</span>
<span>                                plotId <span class="op">=</span> <span class="st">"pos"</span>,</span>
<span>                                rowNum <span class="op">=</span> <span class="st">"Row"</span>,</span>
<span>                                colNum <span class="op">=</span> <span class="st">"Col"</span><span class="op">)</span></span></code></pre></div>
<p>We then run the function on a subset of plants to set the parameters,
using the <code>plotIds</code> option. The smoothing parameter
<code>nnLocfit</code> is set at 0.5. The curves are linear and medium
smooth is enough. The confidence interval size <code>confIntSize</code>
is set at 5 which is a medium interval.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># First select a subset of plants, for example here 7 plants </span></span>
<span><span class="va">plantSelArch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"c22r7"</span>, <span class="st">"c8r22"</span>, <span class="st">"c1r10"</span>, <span class="st">"c21r43"</span>, <span class="st">"c14r15"</span>, <span class="st">"c25r12"</span>, <span class="st">"c6r54"</span><span class="op">)</span></span>
<span><span class="co"># Then run on the subset</span></span>
<span><span class="va">resuArchHTP</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/detectSingleOut.html">detectSingleOut</a></span><span class="op">(</span>TP <span class="op">=</span> <span class="va">phenoTParch</span>,</span>
<span>                               trait <span class="op">=</span> <span class="st">"LeafArea"</span>,</span>
<span>                               plotIds <span class="op">=</span> <span class="va">plantSelArch</span>,</span>
<span>                               confIntSize <span class="op">=</span> <span class="fl">5</span>,</span>
<span>                               nnLocfit <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code></pre></div>
<table style="width:100%;" class="table">
<colgroup>
<col width="4%">
<col width="8%">
<col width="14%">
<col width="12%">
<col width="12%">
<col width="12%">
<col width="12%">
<col width="12%">
<col width="9%">
</colgroup>
<thead><tr class="header">
<th align="left"></th>
<th align="center">plotId</th>
<th align="center">timePoint</th>
<th align="center">LeafArea</th>
<th align="center">yPred</th>
<th align="center">sd_yPred</th>
<th align="center">lwr</th>
<th align="center">upr</th>
<th align="center">outlier</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">22</td>
<td align="center">c14r15</td>
<td align="center">2017-05-09</td>
<td align="center">0.3095688</td>
<td align="center">0.2998288</td>
<td align="center">0.0023225</td>
<td align="center">0.2882164</td>
<td align="center">0.3114412</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="left">23</td>
<td align="center">c14r15</td>
<td align="center">2017-05-11</td>
<td align="center">0.3268933</td>
<td align="center">0.3305959</td>
<td align="center">0.0023188</td>
<td align="center">0.3190019</td>
<td align="center">0.3421899</td>
<td align="center">0</td>
</tr>
<tr class="odd">
<td align="left">24</td>
<td align="center">c14r15</td>
<td align="center">2017-05-12</td>
<td align="center">0.3420478</td>
<td align="center">0.3450079</td>
<td align="center">0.0028001</td>
<td align="center">0.3310072</td>
<td align="center">0.3590086</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="left">25</td>
<td align="center">c14r15</td>
<td align="center">2017-05-13</td>
<td align="center">0.3621102</td>
<td align="center">0.3587838</td>
<td align="center">0.0037381</td>
<td align="center">0.3400936</td>
<td align="center">0.3774741</td>
<td align="center">0</td>
</tr>
<tr class="odd">
<td align="left">26</td>
<td align="center">c14r15</td>
<td align="center">2017-05-15</td>
<td align="center">0.0910594</td>
<td align="center">0.3871152</td>
<td align="center">0.0062159</td>
<td align="center">0.3560358</td>
<td align="center">0.4181947</td>
<td align="center">1</td>
</tr>
</tbody>
</table>
<p>The prediction values can be visualized to adjust the smoothing
parameter and the confidence interval using the <code>plot</code>
function.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">resuArchHTP</span>,</span>
<span>     plotIds <span class="op">=</span> <span class="st">"c14r15"</span>,</span>
<span>     outOnly <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="OutlierSingleObs_HTP_files/figure-html/plotOutArchFA1-1.png" width="384" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">resuArchHTP</span>,</span>
<span>     plotIds <span class="op">=</span> <span class="va">plantSelArch</span>,</span>
<span>     outOnly <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="OutlierSingleObs_HTP_files/figure-html/plotOutArchFA2-1.png" width="672" style="display: block; margin: auto;"></p>
<p>In the plots, the black dots are the raw data, the red line is the
predicted curve, the green lines are the lower and upper limits of the
confidence interval. Outlying points are highlighted in blue.</p>
<p>It is possible to run the outlier detection without first checking if
the first and last time point are outlying. Doing this could be useful
is some cases, but might give undesired results as well as the example
below shows.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Detect outliers without first checking edges.</span></span>
<span><span class="va">resuArchHTPNoEdges</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/detectSingleOut.html">detectSingleOut</a></span><span class="op">(</span>TP <span class="op">=</span> <span class="va">phenoTParch</span>,</span>
<span>                                      trait <span class="op">=</span> <span class="st">"LeafArea"</span>,</span>
<span>                                      plotIds <span class="op">=</span> <span class="st">"c14r15"</span>,</span>
<span>                                      checkEdges <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                      confIntSize <span class="op">=</span> <span class="fl">5</span>,</span>
<span>                                      nnLocfit <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">resuArchHTPNoEdges</span><span class="op">)</span></span></code></pre></div>
<p><img src="OutlierSingleObs_HTP_files/figure-html/plotOutVatorFA3-1.png" width="672" style="display: block; margin: auto;"></p>
<p>The annotated points can be replaced by NA for the studied trait
using the function <code>removeSingleOut</code>. It creates a new
<code>TP</code> object.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">phenoTParchOut</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/removeSingleOut.html">removeSingleOut</a></span><span class="op">(</span><span class="va">phenoTParch</span>,</span>
<span>                                  <span class="va">resuArchHTP</span><span class="op">)</span></span>
<span><span class="co"># Check one value annotated as outlier in the original TP object</span></span>
<span><span class="va">phenoTParch</span><span class="op">[[</span><span class="fl">30</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">phenoTParch</span><span class="op">[[</span><span class="fl">30</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">plotId</span> <span class="op">==</span> <span class="st">"c12r31"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"plotId"</span>, <span class="st">"LeafArea"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt;       plotId  LeafArea</span></span>
<span><span class="co">#&gt; 16655 c12r31 0.2447164</span></span>
<span><span class="co"># Check the same value in the new TP object</span></span>
<span><span class="va">phenoTParchOut</span><span class="op">[[</span><span class="fl">30</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">phenoTParchOut</span><span class="op">[[</span><span class="fl">30</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">plotId</span> <span class="op">==</span> <span class="st">"c12r31"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"plotId"</span>, <span class="st">"LeafArea"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt;       plotId  LeafArea</span></span>
<span><span class="co">#&gt; 16655 c12r31 0.2447164</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="example-3">Example 3<a class="anchor" aria-label="anchor" href="#example-3"></a>
</h3>
<p>First a <code>TP</code> object is created containing all the time
points.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rootTP</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/createTimePoints.html">createTimePoints</a></span><span class="op">(</span>dat <span class="op">=</span> <span class="va">RootDat1</span>,</span>
<span>                           experimentName <span class="op">=</span> <span class="st">"UCL1"</span>,</span>
<span>                           genotype <span class="op">=</span> <span class="st">"Genotype"</span>,</span>
<span>                           timePoint <span class="op">=</span> <span class="st">"Time"</span>,</span>
<span>                           plotId <span class="op">=</span> <span class="st">"plantId"</span>,</span>
<span>                           rowNum <span class="op">=</span> <span class="st">"Strip"</span>,</span>
<span>                           colNum <span class="op">=</span> <span class="st">"Pos"</span><span class="op">)</span></span></code></pre></div>
<p>We then run the function on a subset of plants to set the parameters,
using the <code>plotIds</code> option. The smoothing parameter
<code>nnLocfit</code> is set at 1. The curves are almost linear and a
strong smooth is enough to get an accurate curve shape (line). The
confidence interval size <code>confIntSize</code> is set at 5 which is a
medium interval.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># First select a subset of plants, for example here 7 plants </span></span>
<span><span class="va">plantSelRoot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">RootDat1</span><span class="op">$</span><span class="va">plantId</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">7</span><span class="op">]</span></span>
<span><span class="co"># Then run on the subset</span></span>
<span><span class="va">resuRootHTP</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/detectSingleOut.html">detectSingleOut</a></span><span class="op">(</span>TP <span class="op">=</span> <span class="va">rootTP</span>,</span>
<span>                               trait <span class="op">=</span> <span class="st">"tipPos_y"</span>,</span>
<span>                               plotIds <span class="op">=</span> <span class="va">plantSelRoot</span>,</span>
<span>                               confIntSize <span class="op">=</span> <span class="fl">5</span>,</span>
<span>                               nnLocfit <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="3%">
<col width="7%">
<col width="25%">
<col width="10%">
<col width="10%">
<col width="11%">
<col width="10%">
<col width="10%">
<col width="9%">
</colgroup>
<thead><tr class="header">
<th align="left"></th>
<th align="center">plotId</th>
<th align="center">timePoint</th>
<th align="center">tipPos_y</th>
<th align="center">yPred</th>
<th align="center">sd_yPred</th>
<th align="center">lwr</th>
<th align="center">upr</th>
<th align="center">outlier</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">38</td>
<td align="center">A_01_2</td>
<td align="center">2016-11-12 03:21:58</td>
<td align="center">6.775000</td>
<td align="center">6.355150</td>
<td align="center">0.1571693</td>
<td align="center">5.569304</td>
<td align="center">7.140996</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="left">39</td>
<td align="center">A_01_2</td>
<td align="center">2016-11-12 05:41:17</td>
<td align="center">6.760714</td>
<td align="center">6.451046</td>
<td align="center">0.1570347</td>
<td align="center">5.665872</td>
<td align="center">7.236219</td>
<td align="center">0</td>
</tr>
<tr class="odd">
<td align="left">40</td>
<td align="center">A_01_2</td>
<td align="center">2016-11-12 14:57:43</td>
<td align="center">6.775000</td>
<td align="center">6.856314</td>
<td align="center">0.1555333</td>
<td align="center">6.078648</td>
<td align="center">7.633981</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="left">41</td>
<td align="center">A_01_2</td>
<td align="center">2016-11-12 17:16:51</td>
<td align="center">6.921429</td>
<td align="center">6.965262</td>
<td align="center">0.1550652</td>
<td align="center">6.189936</td>
<td align="center">7.740588</td>
<td align="center">0</td>
</tr>
<tr class="odd">
<td align="left">42</td>
<td align="center">A_01_2</td>
<td align="center">2016-11-13 04:52:57</td>
<td align="center">6.014286</td>
<td align="center">7.576345</td>
<td align="center">0.1541887</td>
<td align="center">6.805402</td>
<td align="center">8.347288</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="left">43</td>
<td align="center">A_01_2</td>
<td align="center">2016-11-13 07:12:14</td>
<td align="center">5.728571</td>
<td align="center">7.711560</td>
<td align="center">0.1549867</td>
<td align="center">6.936627</td>
<td align="center">8.486493</td>
<td align="center">1</td>
</tr>
</tbody>
</table>
<p>The prediction values can be visualized to adjust the smoothing
parameter and the confidence interval using the <code>plot</code>
function.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">resuRootHTP</span>,</span>
<span>     plotIds <span class="op">=</span> <span class="st">"A_03_2"</span>,</span>
<span>     outOnly <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="OutlierSingleObs_HTP_files/figure-html/plotOutRootFA1-1.png" width="288" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">resuRootHTP</span>,</span>
<span>     plotIds <span class="op">=</span> <span class="va">plantSelRoot</span>,</span>
<span>     outOnly <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="OutlierSingleObs_HTP_files/figure-html/plotOutRootFA2-1.png" width="672" style="display: block; margin: auto;"></p>
<p>In the plots, the black dots are the raw data, the red line is the
predicted curve, the green lines are the lower and upper limits of the
confidence interval. Outlying points are highlighted in blue.</p>
<p>The annotated points can be replaced by NA for the studied trait
using the function <code>removeSingleOut</code>. It creates an new
<code>TP</code> object.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rootTPOut</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/removeSingleOut.html">removeSingleOut</a></span><span class="op">(</span><span class="va">rootTP</span>,</span>
<span>                             <span class="va">resuRootHTP</span><span class="op">)</span></span>
<span><span class="co"># Check one value annotated as outlier in the original TP object</span></span>
<span><span class="va">rootTP</span><span class="op">[[</span><span class="fl">11127</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">rootTP</span><span class="op">[[</span><span class="fl">11127</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">plotId</span> <span class="op">==</span> <span class="st">"A_01_2"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"plotId"</span>, <span class="st">"tipPos_y"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt;    plotId tipPos_y</span></span>
<span><span class="co">#&gt; 42 A_01_2 6.014286</span></span>
<span><span class="co"># Check the same value in the new TP object</span></span>
<span><span class="va">rootTPOut</span><span class="op">[[</span><span class="fl">11127</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">rootTPOut</span><span class="op">[[</span><span class="fl">11127</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">plotId</span> <span class="op">==</span> <span class="st">"A_01_2"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"plotId"</span>, <span class="st">"tipPos_y"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt;    plotId tipPos_y</span></span>
<span><span class="co">#&gt; 42 A_01_2       NA</span></span></code></pre></div>
<hr>
</div>
<div class="section level3">
<h3 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h3>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-AlvarezPrado2019" class="csl-entry">
Alvarez Prado, Santiago, Isabelle Sanchez, Llorenç Cabrera-Bosquet,
Antonin Grau, Claude Welcker, François Tardieu, and Nadine Hilgert.
2019. <span>“To Clean or Not to Clean Phenotypic Datasets for Outlier
Plants in Genetic Analyses?”</span> <em>Journal of Experimental
Botany</em> 70 (15): 3693–98. <a href="https://doi.org/10.1093/jxb/erz191" class="external-link">https://doi.org/10.1093/jxb/erz191</a>.
</div>
<div id="ref-BarnettLewis1994" class="csl-entry">
Barnett, Vic, and Tobby Lewis. 1994. <em>Outliers in Statistical
Data</em>. Wiley Series in Probability and Statistics. Wiley. <a href="https://books.google.nl/books?id=B44QAQAAIAAJ" class="external-link">https://books.google.nl/books?id=B44QAQAAIAAJ</a>.
</div>
<div id="ref-Grubbs1950" class="csl-entry">
Grubbs, Frank E. 1950. <span>“Sample Criteria for Testing Outlying
Observations.”</span> <em>Ann. Math. Statist.</em> 21 (1): 27–58. <a href="https://doi.org/10.1214/aoms/1177729885" class="external-link">https://doi.org/10.1214/aoms/1177729885</a>.
</div>
<div id="ref-Hubert2015" class="csl-entry">
Hubert, Mia, Peter J. Rousseeuw, and Pieter Segaert. 2015.
<span>“Multivariate Functional Outlier Detection.”</span>
<em>Statistical Methods <span>&amp;</span> Applications</em> 24 (2):
177–202. <a href="https://doi.org/10.1007/s10260-015-0297-8" class="external-link">https://doi.org/10.1007/s10260-015-0297-8</a>.
</div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Emilie J Millet, Maria Xose Rodriguez Alvarez, Diana Marcela Perez Valencia, Isabelle Sanchez, Nadine Hilgert, Bart-Jan van Rossum, Fred van Eeuwijk, Martin Boer.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
