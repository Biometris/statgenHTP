<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>statgenHTP tutorial: 3. Correction for spatial trends • statgenHTP</title>
<script src="../../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../../deps/headroom-0.11.0/headroom.min.js"></script><script src="../../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../../deps/search-1.0.0/fuse.min.js"></script><script src="../../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../../pkgdown.js"></script><meta property="og:title" content="statgenHTP tutorial: 3. Correction for spatial trends">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../../index.html">statgenHTP</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.7.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../../index.html"><span class="fa fa-home"></span></a></li>
<li class="active nav-item"><a class="nav-link" href="../../articles/index.html">Vignettes</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="nav-link" href="../../news/index.html"><span class="fa fa-newspaper-o"></span> news</a></li>
<li class="nav-item"><a class="nav-link" href="../../reference/index.html"><span class="fa fa-file-code-o"></span> functions</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-other-packages" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true"><span class="fa fa-seedling"></span> other packages</button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-other-packages">
<li><a class="external-link dropdown-item" href="https://biometris.github.io/statgenSTA">statgenSTA</a></li>
    <li><a class="external-link dropdown-item" href="https://biometris.github.io/statgenGxE">statgenGxE</a></li>
    <li><a class="external-link dropdown-item" href="https://biometris.github.io/statgenGWAS">statgenGWAS</a></li>
    <li><a class="external-link dropdown-item" href="https://biometris.github.io/statgenQTLxT">statgenQTLxT</a></li>
    <li><a class="external-link dropdown-item" href="https://biometris.github.io/statgenIBD">statgenIBD</a></li>
    <li><a class="external-link dropdown-item" href="https://biometris.github.io/statgenMPP">statgenMPP</a></li>
    <li><a class="external-link dropdown-item" href="https://biometris.github.io/LMMsolver">LMMsolver</a></li>
  </ul>
</li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Biometris/statgenHTP"><span class="fa fa-github fa-lg fab"></span> github</a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>statgenHTP tutorial: 3. Correction for spatial trends</h1>
                        <h4 data-toc-skip class="author">Emilie Millet,
Bart-Jan van Rossum, Diana Marcela Perez Valencia, Maria Xose Rodriguez
Alvarez, Fred van Eeuwijk</h4>
            
            <h4 data-toc-skip class="date">2024-12-19</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/Biometris/statgenHTP/blob/main/vignettes/vignettesSite/SpatialModel_HTP.Rmd" class="external-link"><code>vignettes/vignettesSite/SpatialModel_HTP.Rmd</code></a></small>
      <div class="d-none name"><code>SpatialModel_HTP.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Phenotyping facilities display spatial heterogeneity. For example,
the spatial variability of incident light can go up to 100% between pots
within a greenhouse <span class="citation">(<a href="#ref-Cabrera2016">Cabrera-Bosquet et al. 2016</a>)</span>. Taking
into account these spatial trends is a prerequisite for precise
estimation of genetic and treatment effects. In the same way as in field
trials, platform experiments should obey standard principles for
experimental design and statistical modeling.</p>
<p>Popular mixed models to separate spatial trends from treatment and
genetic effects, rely on the use of autoregressive correlation functions
defined on rows and columns (AR1×AR1) to model the local trends <span class="citation">(<a href="#ref-Cullis2006">Cullis, Smith, and Coombes
2006</a>)</span>. These models are sometimes difficult to fit and the
selection of a best model is complicated, therefore preventing an
automated phenotypic analysis of series of trials. An attractive
alternative is the use of 2-dimensional P-spline surfaces, the SpATS
model (Spatial Analysis of Trials using Splines, <span class="citation">(<a href="#ref-RodAlv2018">Rodríguez-Álvarez et al.
2018</a>)</span>). This model corrects for spatial trends, row and
column effects and has the advantage of avoiding the model selection
step. It also provides the user with graphical outputs that are easy to
interpret. It has proven to be a good alternative to the classical
AR1×AR1 modeling in the field <span class="citation">(<a href="#ref-Velazco2017">Velazco et al. 2017</a>)</span>. It is also
suitable for phenotyping platform data and has been tested on several
datasets in the EPPN<sup>2020</sup> project.</p>
<p>The aim of this document is to accurately separate the genetic
effects from the spatial effects at each time point. It will provide the
user with either genotypic values or corrected values that can be used
for further modeling. In brief, separately for each measurement time
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>,
a spatial model is fitted for the trait
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>y</mi><mi>t</mi></msub><annotation encoding="application/x-tex">y_t</annotation></semantics></math>,</p>
<p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mi>t</mi></msub><mo>=</mo><msub><mn>1</mn><mi>M</mi></msub><msub><mi>β</mi><mrow><mn>0</mn><mi>t</mi></mrow></msub><mo>+</mo><msub><mi>X</mi><mi>h</mi></msub><msub><mi>β</mi><mrow><mi>h</mi><mi>t</mi></mrow></msub><mo>+</mo><msub><mi>X</mi><mi>q</mi></msub><msub><mi>β</mi><mrow><mi>q</mi><mi>t</mi></mrow></msub><mo>+</mo><msub><mi>Z</mi><mi>g</mi></msub><msub><mi>c</mi><mrow><mi>g</mi><mi>t</mi></mrow></msub><mo>+</mo><msub><mi>f</mi><mi>t</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>u</mi><mo>,</mo><mi>v</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><msub><mi>Z</mi><mi>r</mi></msub><msub><mi>c</mi><mrow><mi>r</mi><mi>t</mi></mrow></msub><mo>+</mo><msub><mi>Z</mi><mi>c</mi></msub><msub><mi>c</mi><mrow><mi>c</mi><mi>t</mi></mrow></msub><mo>+</mo><msub><mi>ϵ</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">y_t = 1_M \beta_{0t} +  X_h \beta_{ht} + X_q \beta_{qt} + Z_g c_{gt} + f_t(u,v) + Z_r c_{rt} + Z_c c_{ct} + \epsilon_t</annotation></semantics></math></p>
<p>where briefly,</p>
<ul>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mn>1</mn><mi>M</mi></msub><msub><mi>β</mi><mrow><mn>0</mn><mi>t</mi></mrow></msub></mrow><annotation encoding="application/x-tex">1_M \beta_{0t}</annotation></semantics></math>,
is the intercept,<br>
</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>X</mi><mi>h</mi></msub><msub><mi>β</mi><mrow><mi>h</mi><mi>t</mi></mrow></msub></mrow><annotation encoding="application/x-tex">X_h \beta_{ht}</annotation></semantics></math>,
corresponds to the factors/covariates whose effects we are interested in
modeling,<br>
</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>X</mi><mi>q</mi></msub><msub><mi>β</mi><mrow><mi>q</mi><mi>t</mi></mrow></msub></mrow><annotation encoding="application/x-tex">X_q \beta_{qt}</annotation></semantics></math>,
corresponds to the factors/covariates whose effects we are interested in
removing,<br>
</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Z</mi><mi>g</mi></msub><msub><mi>c</mi><mrow><mi>g</mi><mi>t</mi></mrow></msub></mrow><annotation encoding="application/x-tex">Z_g c_{gt}</annotation></semantics></math>,
corresponds the genotypic effects,</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>f</mi><mi>t</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>u</mi><mo>,</mo><mi>v</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><msub><mi>Z</mi><mi>r</mi></msub><msub><mi>c</mi><mrow><mi>r</mi><mi>t</mi></mrow></msub><mo>+</mo><msub><mi>Z</mi><mi>c</mi></msub><msub><mi>c</mi><mrow><mi>c</mi><mi>t</mi></mrow></msub></mrow><annotation encoding="application/x-tex">f_t(u,v) + Z_r c_{rt} + Z_c c_{ct}</annotation></semantics></math>,
represents the spatial effects, with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>f</mi><mi>t</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>u</mi><mo>,</mo><mi>v</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">f_t(u,v)</annotation></semantics></math>
corresponding to the spatial function, e.g. the <code>PSANOVA</code>
function from the SpATS package,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Z</mi><mi>r</mi></msub><msub><mi>c</mi><mrow><mi>r</mi><mi>t</mi></mrow></msub></mrow><annotation encoding="application/x-tex">Z_r c_{rt}</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Z</mi><mi>c</mi></msub><msub><mi>c</mi><mrow><mi>c</mi><mi>t</mi></mrow></msub></mrow><annotation encoding="application/x-tex">Z_c c_{ct}</annotation></semantics></math>
represent the design matrices and effects for the random row and column
effects respectively,</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ϵ</mi><mi>t</mi></msub><annotation encoding="application/x-tex">\epsilon_t</annotation></semantics></math>,
is the residual.</li>
</ul>
<blockquote>
<p>For more details see <span class="citation">Pérez-Valencia et al. (<a href="#ref-Perez2022">2022</a>)</span>.</p>
</blockquote>
<p>This tutorial describes in detail how to perform analyses to correct
for spatial trends using different modeling engines and how to extract
the results from the models.</p>
<hr>
</div>
<div class="section level2">
<h2 id="modeling-with-spatial-terms-using-example-1">Modeling with spatial terms using Example 1<a class="anchor" aria-label="anchor" href="#modeling-with-spatial-terms-using-example-1"></a>
</h2>
<p>We will use the <code>TP</code> object <code>phenoTPOut</code> in
which annotated time points were replaced by <code>NA</code> because
they were considered to be outliers. (see <a href="OutlierSingleObs_HTP.html"><strong>statgenHTP tutorial: 2. Outlier
detection for single observations</strong></a>).</p>
<p>After creating a <code>TP</code> object, a model can be fitted on the
data. This is done using the function <code>fitModels</code>, which uses
two different engines for fitting the models, namely <em>SpATS</em>
<span class="citation">(<a href="#ref-RodAlv2018">Rodríguez-Álvarez et
al. 2018</a>)</span> and <em>ASReml</em> <span class="citation">(<a href="#ref-Gilmour2017">Butler et al. 2017</a>)</span>. For models with
row and column coordinates, SpATS is the default engine (see section <a href="#SpATS"><strong>2.1</strong></a>). This can be overruled by
specifying the function parameter <code>engine</code> and using ASReml
for spatial models (see section <a href="#ASReml"><strong>2.2</strong></a>). When the row and column
coordinates are not available, ASReml is used for modeling without
spatial components (see section <a href="#ASRemlnoSP"><strong>3</strong></a>). Finally, it is possible to
decompose the genotypic variance using, for example, a treatment effect
(see section <a href="#genodecomp"><strong>4</strong></a>).</p>
<p>The output of <code>fitModels</code> is an object of class
<code>fitMod</code>, a list of fitted models with one item for each time
point the model was fitted for.</p>
<div class="section level3">
<h3 id="SpATS">Spatial model using SpATS<a class="anchor" aria-label="anchor" href="#SpATS"></a>
</h3>
<p>When SpATS is used for modeling, an extra spatial term is included in
the model. This spatial component is composed using the
<code>PSANOVA</code> function in the SpATS package which uses
2-dimensional smoothing with P-splines as described in <span class="citation">Lee, Durbán, and Eilers (<a href="#ref-Lee2013">2013</a>)</span> and in <span class="citation">Rodríguez-Álvarez et al. (<a href="#ref-RodAlv2018">2018</a>)</span>. See
<code><a href="https://rdrr.io/pkg/SpATS/man/PSANOVA.html" class="external-link">help(PSANOVA, SpATS)</a></code> for a detailed description. Extra
fixed effects may be fitted using the option
<code>extraFixedFactors</code>. The model can also be fitted following a
resolvable row-column design setting <code>useRepId</code> as
<code>TRUE</code>.</p>
<p>The model specifications are listed in the table below with a
simplified model.</p>
<table class="table">
<colgroup>
<col width="23%">
<col width="57%">
<col width="19%">
</colgroup>
<thead><tr class="header">
<th>OPTION</th>
<th>MODEL FITTED</th>
<th>SPATIAL TERM</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>default</td>
<td>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math>
=
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>μ</mi><annotation encoding="application/x-tex">\mu</annotation></semantics></math>
+ <strong>genotype</strong> + <strong>rowId</strong> +
<strong>colId</strong> +
<strong><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ϵ</mi><annotation encoding="application/x-tex">\epsilon</annotation></semantics></math></strong>
</td>
<td>PSANOVA</td>
</tr>
<tr class="even">
<td>extraFixedFactors = c(“A”, “B”)</td>
<td>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math>
=
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>μ</mi><annotation encoding="application/x-tex">\mu</annotation></semantics></math>
+ <em>A</em> + <em>B</em> + <strong>genotype</strong> +
<strong>rowId</strong> + <strong>colId</strong> +
<strong><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ϵ</mi><annotation encoding="application/x-tex">\epsilon</annotation></semantics></math></strong>
</td>
<td>PSANOVA</td>
</tr>
<tr class="odd">
<td>useRepId = TRUE</td>
<td>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math>
=
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>μ</mi><annotation encoding="application/x-tex">\mu</annotation></semantics></math>
+ <em>repId</em> + <strong>genotype</strong> +
<strong>repId:rowId</strong> + <strong>repId:colId</strong> +
<strong><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ϵ</mi><annotation encoding="application/x-tex">\epsilon</annotation></semantics></math></strong>
</td>
<td>PSANOVA</td>
</tr>
<tr class="even">
<td>useCheck = TRUE</td>
<td>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math>
=
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>μ</mi><annotation encoding="application/x-tex">\mu</annotation></semantics></math>
+ <em>check</em> + <strong>genoCheck</strong> + <strong>rowId</strong> +
<strong>colId</strong> +
<strong><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ϵ</mi><annotation encoding="application/x-tex">\epsilon</annotation></semantics></math></strong>
</td>
<td>PSANOVA</td>
</tr>
</tbody>
</table>
<p>In the models above, fixed effects are indicated in <em>italics</em>
whereas random effects are indicated in <strong>bold</strong>.
“genotype” can be fitted as <strong>random</strong> or <em>fixed</em>
effect using the option <code>what</code>. The option
<code>useCheck</code> allows treating some genotypes as check: it splits
the column “genotype” into two columns as follows:</p>
<center>
<table class="table">
<thead><tr class="header">
<th align="center">genotype</th>
<th align="center">check</th>
<th align="center">genoCheck</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">G<sub>1</sub>
</td>
<td align="center">noCheck</td>
<td align="center">G<sub>1</sub>
</td>
</tr>
<tr class="even">
<td align="center">G<sub>2</sub>
</td>
<td align="center">noCheck</td>
<td align="center">G<sub>2</sub>
</td>
</tr>
<tr class="odd">
<td align="center">…</td>
<td align="center">noCheck</td>
<td align="center">…</td>
</tr>
<tr class="even">
<td align="center">G<sub>n-1</sub>
</td>
<td align="center">noCheck</td>
<td align="center">G<sub>n-1</sub>
</td>
</tr>
<tr class="odd">
<td align="center">G<sub>n</sub>
</td>
<td align="center">noCheck</td>
<td align="center">G<sub>n</sub>
</td>
</tr>
<tr class="even">
<td align="center">check<sub>1</sub>
</td>
<td align="center">check<sub>1</sub>
</td>
<td align="center">NA</td>
</tr>
<tr class="odd">
<td align="center">check<sub>2</sub>
</td>
<td align="center">check<sub>2</sub>
</td>
<td align="center">NA</td>
</tr>
<tr class="even">
<td align="center">…</td>
<td align="center">…</td>
<td align="center">…</td>
</tr>
<tr class="odd">
<td align="center">check<sub>m-1</sub>
</td>
<td align="center">check<sub>m-1</sub>
</td>
<td align="center">NA</td>
</tr>
<tr class="even">
<td align="center">check<sub>m</sub>
</td>
<td align="center">check<sub>m</sub>
</td>
<td align="center">NA</td>
</tr>
</tbody>
</table>
</center>
<blockquote>
<p><em>NOTE: It is only possible to use the combination of check and
genotype as random.</em></p>
</blockquote>
<div class="section level4">
<h4 id="calling-spats">Calling SpATS<a class="anchor" aria-label="anchor" href="#calling-spats"></a>
</h4>
<p>Using the <code>TP</code> object <strong>phenoTPOut</strong> from the
previous vignette, a model for a few time points and trait “EffpsII” can
now be fitted on the data as follows. Since <code>engine</code> is not
supplied as an option, SpATS is used for fitting the following
model:<br>
EffpsII =
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>μ</mi><annotation encoding="application/x-tex">\mu</annotation></semantics></math>
+ <strong>genotype</strong> + <strong>rowId</strong> +
<strong>colId</strong> +
<strong><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ϵ</mi><annotation encoding="application/x-tex">\epsilon</annotation></semantics></math></strong></p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Fit a model for a few time points.</span></span>
<span><span class="va">modPhenoSp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/fitModels.html">fitModels</a></span><span class="op">(</span>TP <span class="op">=</span> <span class="va">phenoTPOut</span>, </span>
<span>                        trait <span class="op">=</span> <span class="st">"EffpsII"</span>,</span>
<span>                        timePoints <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">1</span>, to <span class="op">=</span> <span class="fl">73</span>, by <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">modPhenoSp</span><span class="op">)</span></span>
<span><span class="co">#&gt; Models in modPhenoSp where fitted for experiment Phenovator.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; It contains 15 time points.</span></span>
<span><span class="co">#&gt; The models were fitted using SpATS.</span></span></code></pre></div>
<p>The output is a <code>fitMod</code> object, a list containing one
fitted model per time point. Note that by not supplying the
<code>what</code> argument to the function, genotype is set as random.
It can be run again with genotype as fixed using <code>what</code>:</p>
<p>EffpsII =
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>μ</mi><annotation encoding="application/x-tex">\mu</annotation></semantics></math>
+ genotype + <strong>rowId</strong> + <strong>colId</strong> +
<strong><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ϵ</mi><annotation encoding="application/x-tex">\epsilon</annotation></semantics></math></strong></p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Fit a model for a single time point.</span></span>
<span><span class="va">modPhenoSpFix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/fitModels.html">fitModels</a></span><span class="op">(</span>TP <span class="op">=</span> <span class="va">phenoTPOut</span>, </span>
<span>                           trait <span class="op">=</span> <span class="st">"EffpsII"</span>,</span>
<span>                           timePoints <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                           what <span class="op">=</span> <span class="st">"fixed"</span><span class="op">)</span></span></code></pre></div>
<p>The model can be extended by including extra main fixed effects, here
to include extra experimental design factors:<br>
EffpsII =
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>μ</mi><annotation encoding="application/x-tex">\mu</annotation></semantics></math>
+ repId + Image_pos + <strong>genotype</strong> + <strong>rowId</strong>
+ <strong>colId</strong> +
<strong><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ϵ</mi><annotation encoding="application/x-tex">\epsilon</annotation></semantics></math></strong></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Fit a model for a single time point with extra fixed factors.</span></span>
<span><span class="va">modPhenoSpCov</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/fitModels.html">fitModels</a></span><span class="op">(</span>TP <span class="op">=</span> <span class="va">phenoTPOut</span>, </span>
<span>                           trait <span class="op">=</span> <span class="st">"EffpsII"</span>,</span>
<span>                           extraFixedFactors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"repId"</span>, <span class="st">"Image_pos"</span><span class="op">)</span>, </span>
<span>                           timePoints <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p>It can be further extended by including check genotypes:<br>
EffpsII =
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>μ</mi><annotation encoding="application/x-tex">\mu</annotation></semantics></math>
+ repId + Image_pos + check + <strong>genoCheck</strong> +
<strong>rowId</strong> + <strong>colId</strong> +
<strong><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ϵ</mi><annotation encoding="application/x-tex">\epsilon</annotation></semantics></math></strong></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Fit a model for a single time point with extra fixed effects and check genotypes.</span></span>
<span><span class="va">modPhenoSpCheck</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/fitModels.html">fitModels</a></span><span class="op">(</span>TP <span class="op">=</span> <span class="va">phenoTPOut</span>, </span>
<span>                             trait <span class="op">=</span> <span class="st">"EffpsII"</span>,</span>
<span>                             extraFixedFactors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"repId"</span>, <span class="st">"Image_pos"</span><span class="op">)</span>,</span>
<span>                             useCheck <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                             timePoints <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p>Finally, a model following a resolvable row-column design can be
fitted: including the effects of row and column nested within
replicate.<br>
EffpsII =
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>μ</mi><annotation encoding="application/x-tex">\mu</annotation></semantics></math>
+ repId + <strong>genotype</strong> + <strong>repId:rowId</strong> +
<strong>repId:colId</strong> +
<strong><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ϵ</mi><annotation encoding="application/x-tex">\epsilon</annotation></semantics></math></strong></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Fit a model for a single time point.</span></span>
<span><span class="va">modPhenoSpRCD</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/fitModels.html">fitModels</a></span><span class="op">(</span>TP <span class="op">=</span> <span class="va">phenoTPOut</span>,</span>
<span>                           trait <span class="op">=</span> <span class="st">"EffpsII"</span>,</span>
<span>                           timePoints <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                           useRepId <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="model-plots">Model plots<a class="anchor" aria-label="anchor" href="#model-plots"></a>
</h4>
<p>The first type of plot that can be made for fitted models, is a
spatial plot per time point using <code>plotType = "spatial"</code>. It
consists of plots, spatial plots of the raw data, fitted values,
residuals and either BLUEs or BLUPs, and a histogram of the BLUEs or
BLUPs. When SpATS is used for modeling an extra plot with the fitted
spatial trend is included (see <span class="citation">(<a href="#ref-RodAlv2018">Rodríguez-Álvarez et al. 2018</a>)</span> and
<span class="citation">(<a href="#ref-Velazco2017">Velazco et al.
2017</a>)</span> for interpretation).</p>
<p>Note that spatial plots can only be made if spatial information,
i.e. <code>rowNum</code> and <code>colNum</code>, is available in the
<code>TP</code> object.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">modPhenoSp</span>,</span>
<span>     timePoints <span class="op">=</span> <span class="fl">36</span>,</span>
<span>     plotType <span class="op">=</span> <span class="st">"spatial"</span>,</span>
<span>     spaTrend <span class="op">=</span> <span class="st">"raw"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in get(paste0(generic, ".", class), envir = get_method_env()) : </span></span>
<span><span class="co">#&gt;   object 'type_sum.accel' not found</span></span></code></pre></div>
<p><img src="SpatialModel_HTP_files/figure-html/plotSpatRaw-1.png" width="700.8"></p>
<p>For assessing the importance of the fitted spatial trends at one
glance, and for comparison between time points, the plot of the fitted
spatial trend can be displayed as a ratio of the raw phenotypic mean:
SpatTrend(proportion) = Estimated SpatTrend / mean(raw EffpsII). In this
case, the scale will be in percentage and the min/max will be adjusted
based on all the time points used but will be at least 10%. This
empirical threshold allows visualizing fitted trends that have a
relatively small to large importance.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">modPhenoSp</span>,</span>
<span>     timePoints <span class="op">=</span> <span class="fl">36</span>,</span>
<span>     plotType <span class="op">=</span> <span class="st">"spatial"</span>,</span>
<span>     spaTrend <span class="op">=</span> <span class="st">"percentage"</span><span class="op">)</span></span></code></pre></div>
<p><img src="SpatialModel_HTP_files/figure-html/plotSpatPerc-1.png" width="672"></p>
<p>It is also possible to create a time lapse of the ratio of spatial
trends over time. The scale is the same as previously described. The
time lapse is always written to an output file.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">modPhenoSp</span>, </span>
<span>     plotType <span class="op">=</span> <span class="st">"timeLapse"</span>,</span>
<span>     outFile <span class="op">=</span> <span class="st">"TimeLapse_modPhenoSp.gif"</span><span class="op">)</span></span></code></pre></div>
<p>Here is an illustration with three time points:
<img src="figures%2Ftimelapse_nogif.png" width="80%" style="display: block; margin: auto;"></p>
</div>
<div class="section level4">
<h4 id="extracting-model-results">Extracting model results<a class="anchor" aria-label="anchor" href="#extracting-model-results"></a>
</h4>
<p>All results that can be extracted are shown in the table below. The
first column contains the function names. The second column contains a
short description of the result that will be extracted and, where
needed, states for which modeling engines it can be extracted.</p>
<table class="table">
<colgroup>
<col width="17%">
<col width="82%">
</colgroup>
<thead><tr class="header">
<th>FUNCTION</th>
<th>DESCRIPTION</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>getGenoPred</td>
<td>Best Linear Unbiased Predictions (BLUPS, genotype as random) or
Estimators (BLUEs, genotype as fixed)</td>
</tr>
<tr class="even">
<td>getCorrected</td>
<td>Spatially corrected values at the experimental unit level</td>
</tr>
<tr class="odd">
<td>getVar</td>
<td>Variance components</td>
</tr>
<tr class="even">
<td>getHerit</td>
<td>Generalized heritabilities - only when genotype is random</td>
</tr>
<tr class="odd">
<td>getEffDims</td>
<td>Effective dimensions - only for SpATS engine</td>
</tr>
</tbody>
</table>
<p>By default, all the functions run for all the time points. It is
possible to select some of them using <code>timePoints</code>. The ratio
of the effective dimensions can also be extracted using
<code>EDType = "ratio"</code> in the <code>getEffDims</code>
function.</p>
<p>The output of the function <code>getGenoPred</code> is a list of two
dataframes: “genoPred” which contains the predicted values for all
tested genotypes and “checkPred” which contains the predicted values of
the check genotypes, when <code>useCheck = TRUE</code> in the model.
“checkPred” is empty when <code>useCheck = FALSE</code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Extract the genotypic predictions for one time point: </span></span>
<span><span class="va">genoPredSp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/getGenoPred.html">getGenoPred</a></span><span class="op">(</span><span class="va">modPhenoSp</span>, timePoints <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span>
<span><span class="co">## Extract the corrected values for one time point: </span></span>
<span><span class="va">spatCorrSp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/getCorrected.html">getCorrected</a></span><span class="op">(</span><span class="va">modPhenoSp</span>, timePoints <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span>
<span><span class="co">## Extract model components: </span></span>
<span><span class="va">varianceSp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/getVar.html">getVar</a></span><span class="op">(</span><span class="va">modPhenoSp</span><span class="op">)</span></span>
<span><span class="va">heritSp</span>    <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/getHerit.html">getHerit</a></span><span class="op">(</span><span class="va">modPhenoSp</span><span class="op">)</span></span>
<span><span class="va">effDimSp</span>   <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/getEffDims.html">getEffDims</a></span><span class="op">(</span><span class="va">modPhenoSp</span><span class="op">)</span></span></code></pre></div>
<p>The genotypic predictions of the test genotypes for one time point
are displayed in a table like the following:</p>
<table class="table">
<colgroup>
<col width="14%">
<col width="27%">
<col width="11%">
<col width="23%">
<col width="22%">
</colgroup>
<thead><tr class="header">
<th align="center">timeNumber</th>
<th align="center">timePoint</th>
<th align="center">genotype</th>
<th align="center">predicted.values</th>
<th align="center">standard.errors</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">6</td>
<td align="center">2018-06-02 09:07:00</td>
<td align="center">check1</td>
<td align="center">0.6659103</td>
<td align="center">0.0042991</td>
</tr>
<tr class="even">
<td align="center">6</td>
<td align="center">2018-06-02 09:07:00</td>
<td align="center">check2</td>
<td align="center">0.5894471</td>
<td align="center">0.0059116</td>
</tr>
<tr class="odd">
<td align="center">6</td>
<td align="center">2018-06-02 09:07:00</td>
<td align="center">check3</td>
<td align="center">0.6675676</td>
<td align="center">0.0057804</td>
</tr>
<tr class="even">
<td align="center">6</td>
<td align="center">2018-06-02 09:07:00</td>
<td align="center">check4</td>
<td align="center">0.6746556</td>
<td align="center">0.0042381</td>
</tr>
<tr class="odd">
<td align="center">6</td>
<td align="center">2018-06-02 09:07:00</td>
<td align="center">G001</td>
<td align="center">0.6664412</td>
<td align="center">0.0077009</td>
</tr>
<tr class="even">
<td align="center">6</td>
<td align="center">2018-06-02 09:07:00</td>
<td align="center">G002</td>
<td align="center">0.6650949</td>
<td align="center">0.0077011</td>
</tr>
</tbody>
</table>
<p>The corrected values are obtained by considering only the estimated
sources of variation which are of interest. Here, the correction follows
the procedure described in <span class="citation">(<a href="#ref-Welham2004">Welham et al. 2004</a>)</span>. They propose a
partition of the explanatory variables in three groups: (i) those for
which predicted values are required (<em>i.e.</em> population and
genotypic effects), (ii) those to be averaged over (<em>i.e.</em>
experimental factors effects), and (iii) those to be ignored
(<em>i.e.</em> spatial effects). The corrected trait is obtained as
follows (in simplified terms, for full explanation see Pérez <em>et
al.</em> (<em>in prep</em>)):
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>y</mi><mo accent="true">̃</mo></mover><mi>t</mi></msub><mo>=</mo><msub><mover><mi>μ</mi><mo accent="true">̂</mo></mover><mi>t</mi></msub><mo>+</mo><msub><mover><mrow><mi>g</mi><mi>e</mi><mi>n</mi><mi>o</mi></mrow><mo accent="true">̂</mo></mover><mi>t</mi></msub><mo>+</mo><msub><mover><mrow><mi>f</mi><mi>i</mi><mi>x</mi><mi>e</mi><mi>d</mi></mrow><mo accent="true">̂</mo></mover><mi>t</mi></msub><mo>+</mo><msub><mover><mi>ϵ</mi><mo accent="true">̂</mo></mover><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">\tilde{y}_t = \hat \mu_t + \widehat{geno}_t + \widehat{fixed}_t + \hat{\epsilon}_t</annotation></semantics></math><br>
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mover><mrow><mi>f</mi><mi>i</mi><mi>x</mi><mi>e</mi><mi>d</mi></mrow><mo accent="true">̂</mo></mover><mi>t</mi></msub><annotation encoding="application/x-tex">\widehat{fixed}_t</annotation></semantics></math>
are the fixed covariates of interest (e.g. population effect).</p>
<p>This allows keeping the data at the experimental unit level (plants)
and having more degrees of freedom for further modeling (e.g. time
course modeling and estimation of the time course parameter(s)).</p>
<blockquote>
<p><em>NOTE: The estimated fixed effects included in
<code>extraFixedFactors</code> are removed from the corrected phenotype
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mover><mi>y</mi><mo accent="true">̃</mo></mover><mi>t</mi></msub><annotation encoding="application/x-tex">\tilde{y}_t</annotation></semantics></math>).</em></p>
</blockquote>
<p>The corrected values of one time point are displayed in a table like
the following:</p>
<table style="width:100%;" class="table">
<colgroup>
<col width="12%">
<col width="23%">
<col width="15%">
<col width="8%">
<col width="10%">
<col width="10%">
<col width="6%">
<col width="6%">
<col width="7%">
</colgroup>
<thead><tr class="header">
<th align="center">timeNumber</th>
<th align="center">timePoint</th>
<th align="center">EffpsII_corr</th>
<th align="center">EffpsII</th>
<th align="center">wt</th>
<th align="center">genotype</th>
<th align="center">rowId</th>
<th align="center">colId</th>
<th align="center">plotId</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">6</td>
<td align="center">2018-06-02 09:07:00</td>
<td align="center">0.6472045</td>
<td align="center">0.645</td>
<td align="center">1756.311</td>
<td align="center">check1</td>
<td align="center">28</td>
<td align="center">11</td>
<td align="center">c11r28</td>
</tr>
<tr class="even">
<td align="center">6</td>
<td align="center">2018-06-02 09:07:00</td>
<td align="center">0.6477295</td>
<td align="center">0.658</td>
<td align="center">1756.311</td>
<td align="center">check1</td>
<td align="center">10</td>
<td align="center">16</td>
<td align="center">c16r10</td>
</tr>
<tr class="odd">
<td align="center">6</td>
<td align="center">2018-06-02 09:07:00</td>
<td align="center">0.6854932</td>
<td align="center">0.678</td>
<td align="center">1756.311</td>
<td align="center">check1</td>
<td align="center">56</td>
<td align="center">9</td>
<td align="center">c9r56</td>
</tr>
<tr class="even">
<td align="center">6</td>
<td align="center">2018-06-02 09:07:00</td>
<td align="center">0.6589555</td>
<td align="center">0.669</td>
<td align="center">1756.311</td>
<td align="center">check1</td>
<td align="center">30</td>
<td align="center">4</td>
<td align="center">c4r30</td>
</tr>
<tr class="odd">
<td align="center">6</td>
<td align="center">2018-06-02 09:07:00</td>
<td align="center">0.6698425</td>
<td align="center">0.669</td>
<td align="center">1756.311</td>
<td align="center">check1</td>
<td align="center">4</td>
<td align="center">20</td>
<td align="center">c20r4</td>
</tr>
<tr class="even">
<td align="center">6</td>
<td align="center">2018-06-02 09:07:00</td>
<td align="center">0.6804443</td>
<td align="center">0.679</td>
<td align="center">1756.311</td>
<td align="center">check1</td>
<td align="center">35</td>
<td align="center">13</td>
<td align="center">c13r35</td>
</tr>
</tbody>
</table>
</div>
<div class="section level4">
<h4 id="plotting-model-results">Plotting model results<a class="anchor" aria-label="anchor" href="#plotting-model-results"></a>
</h4>
<p>Different plots can be displayed for the <code>fitMod</code> object.
The first one is <strong>rawPred</strong>, it plots the raw data
(colored dots, one color per plotId) overlaid with the predicted values
(black dots) from the fitted model. One plot is made per genotype with
all its plotId. These plots are put together in a 5×5 grid per
page.<br>
Using the parameter <code>genotypes</code>, a subset of genotypes will
be plotted. By default, data are plotted as dots but this can be changed
by setting <code>plotLine = TRUE</code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">modPhenoSp</span>, </span>
<span>     plotType <span class="op">=</span> <span class="st">"rawPred"</span>,</span>
<span>     genotypes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"check1"</span>, <span class="st">"check2"</span>, <span class="st">"G007"</span>, <span class="st">"G058"</span><span class="op">)</span><span class="op">)</span> </span></code></pre></div>
<p><img src="SpatialModel_HTP_files/figure-html/plotSpPred-1.png" width="576" style="display: block; margin: auto;"></p>
<p>The second one is <strong>corrPred</strong>, it plots the spatially
corrected data (colored dots, one color per plotId) overlaid with the
predicted values from the fitted model (black dots). One plot is made
per genotype with all its plotId. These plots are put together in a 5×5
grid per page.<br>
Using the parameter <code>genotypes</code>, a subset of genotypes will
be plotted. By default, data are plotted as dots but this can be changed
by setting <code>plotLine = TRUE</code>.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">modPhenoSp</span>, </span>
<span>     plotType <span class="op">=</span> <span class="st">"corrPred"</span>,</span>
<span>     genotypes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"check1"</span>, <span class="st">"check2"</span>, <span class="st">"G007"</span>, <span class="st">"G058"</span><span class="op">)</span> <span class="op">)</span></span></code></pre></div>
<p><img src="SpatialModel_HTP_files/figure-html/plotSpCorr-1.png" width="576" style="display: block; margin: auto;"></p>
<p>Note that when check genotypes are used for modeling, for the two
previous plot types (<code>rawPred</code> and <code>corrPred</code>),
the parameter <code>plotChecks</code> should be set to <code>TRUE</code>
to display check genotypes.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">modPhenoSpCheck</span>, </span>
<span>     plotType <span class="op">=</span> <span class="st">"rawPred"</span>,</span>
<span>     plotChecks <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>     genotypes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"check1"</span>, <span class="st">"check2"</span>, <span class="st">"G007"</span>, <span class="st">"G058"</span><span class="op">)</span><span class="op">)</span> </span></code></pre></div>
<p>The last three types of plot display different model parameters over
time. Plot type <strong>herit</strong> plots the heritability over time.
If <code>geno.decomp</code> is used when fitting the model,
heritabilities are plotted for each level of the genotype groups in a
single plot (see section <a href="#genodecomp"><strong>4</strong></a>).
The scale of the plot can be adjusted using <code>yLim</code>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">modPhenoSp</span>, </span>
<span>     plotType <span class="op">=</span> <span class="st">"herit"</span>,</span>
<span>     yLim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="SpatialModel_HTP_files/figure-html/plotSpHerit-1.png" width="336" style="display: block; margin: auto;"></p>
<p>Plot type <strong>variance</strong> plots the residual, column and
row variances over time. These plots can serve as diagnostics of the
experiment. The scale of the plot can be adjusted using
<code>yLim</code>.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">modPhenoSp</span>, </span>
<span>     plotType <span class="op">=</span> <span class="st">"variance"</span>,</span>
<span>     yLim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.00125</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="SpatialModel_HTP_files/figure-html/plotSpVar-1.png" width="480" style="display: block; margin: auto;"></p>
<p>Plot type <strong>effDim</strong> plots the effective dimension from
models fitted using SpATS over time. By default, all the spatial
components are plotted. This can be restricted using the option
<code>whichED</code>. The scale of the plot can be adjusted using
<code>yLim</code>.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">modPhenoSp</span>, </span>
<span>     plotType <span class="op">=</span> <span class="st">"effDim"</span>,</span>
<span>     whichED <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"colId"</span>, <span class="st">"rowId"</span>, <span class="st">"fColRow"</span>,<span class="st">"colfRow"</span>, <span class="st">"surface"</span><span class="op">)</span>,</span>
<span>     EDType <span class="op">=</span> <span class="st">"ratio"</span><span class="op">)</span></span></code></pre></div>
<p><img src="SpatialModel_HTP_files/figure-html/plotSpED-1.png" width="480" style="display: block; margin: auto;"></p>
<p>The effective dimensions are also known as the effective degrees of
freedom. They can be interpreted as a measure of the complexity of the
corresponding component: if the effective dimension of one component is
large, it indicates that there are strong spatial trends in this
direction. For better comparison between components, the ratio of
effective dimensions vs. total dimensions can be used. It has a value
between 0, no spatial trend, and 1, strong spatial trend (almost all the
degrees of freedom are used to model it).</p>
<p>The table below gives an overview of the effective dimensions and an
explanation of their meaning.</p>
<table class="table">
<thead><tr class="header">
<th align="left">EFFECTIVE DIMENSION</th>
<th align="left">EXPLANATION</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">colId</td>
<td align="left">Linear trend along columns</td>
</tr>
<tr class="even">
<td align="left">rowId</td>
<td align="left">Linear trend along rows</td>
</tr>
<tr class="odd">
<td align="left">fCol</td>
<td align="left">Smooth trend along columns</td>
</tr>
<tr class="even">
<td align="left">fRow</td>
<td align="left">Smooth trend along rows</td>
</tr>
<tr class="odd">
<td align="left">fColRow</td>
<td align="left">Linear trend in rows changing smoothly along cols</td>
</tr>
<tr class="even">
<td align="left">colfRow</td>
<td align="left">Linear trend in cols changing smoothly along rows</td>
</tr>
<tr class="odd">
<td align="left">fColfRow</td>
<td align="left">Smooth-by-smooth interaction trend over rows and
cols</td>
</tr>
<tr class="even">
<td align="left">surface</td>
<td align="left">Sum of smooth trends</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level3">
<h3 id="ASReml">Spatial model with ASReml<a class="anchor" aria-label="anchor" href="#ASReml"></a>
</h3>
<p>When ASReml is used for modeling and <code>spatial = TRUE</code>,
four models are fitted with different random terms and covariance
structures. The best model is determined based on a goodness-of-fit
criterion, AIC, on 20% of the time points or at least 10 time points.
The best model is then run on all time points. As for SpATS, all the
ASReml models can be extended by fitting extra fixed factors using the
option <code>extraFixedFactors</code>.</p>
<blockquote>
<p><em>Note that for the moment, it is only running with ASReml-R
version 4 or higher.</em></p>
</blockquote>
<table class="table">
<colgroup>
<col width="27%">
<col width="51%">
<col width="20%">
</colgroup>
<thead><tr class="header">
<th>OPTION</th>
<th>MODEL FITTED</th>
<th>SPATIAL TERM</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>spatial = TRUE</td>
<td>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math>
=
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>μ</mi><annotation encoding="application/x-tex">\mu</annotation></semantics></math>
+ <strong>genotype</strong> + <strong>row</strong> +
<strong>col</strong> +
<strong><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ϵ</mi><annotation encoding="application/x-tex">\epsilon</annotation></semantics></math></strong>
</td>
<td>AR1(rowId):AR1(colId)</td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td>AR1(rowId):colId</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td>rowId:AR1(colId)</td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td>-</td>
</tr>
<tr class="odd">
<td>spatial = TRUE, extraFixedFactors = c(“A”, “B”)</td>
<td>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math>
=
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>μ</mi><annotation encoding="application/x-tex">\mu</annotation></semantics></math>
+ <em>A</em> + <em>B</em> + <strong>genotype</strong> +
<strong>row</strong> + <strong>col</strong> +
<strong><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ϵ</mi><annotation encoding="application/x-tex">\epsilon</annotation></semantics></math></strong>
</td>
<td>AR1(rowId):AR1(colId)</td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td>AR1(rowId):colId</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td>rowId:AR1(colId)</td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td>-</td>
</tr>
<tr class="odd">
<td>spatial = TRUE, repID = TRUE</td>
<td>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math>
=
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>μ</mi><annotation encoding="application/x-tex">\mu</annotation></semantics></math>
+ <em>repId</em> + <strong>genotype</strong> +
<strong>repId:row</strong> + <strong>repId:col</strong> +
<strong><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ϵ</mi><annotation encoding="application/x-tex">\epsilon</annotation></semantics></math></strong>
</td>
<td>AR1(rowId):AR1(colId)</td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td>AR1(rowId):colId</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td>rowId:AR1(colId)</td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td>-</td>
</tr>
</tbody>
</table>
<p>In the models above, fixed effects are indicated in <em>italics</em>
whereas random effects are indicated in <strong>bold</strong>.
“genotype” can be fitted as <strong>random</strong> or <em>fixed</em>
effect using the option <code>what</code>. The option
<code>useCheck</code> is not displayed in the table but works the same
as for SpATS: treating some genotypes as check (see section <a href="#SpATS"><strong>2.1</strong></a> for details).</p>
<p>Calling ASReml is done by changing the <code>engine</code> option in
the <code>fitModels</code> function.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"asreml"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co">## Fit a model on few time points with spatial function:</span></span>
<span>  <span class="va">modPhenoSpAs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/fitModels.html">fitModels</a></span><span class="op">(</span>TP <span class="op">=</span> <span class="va">phenoTPOut</span>, </span>
<span>                            trait <span class="op">=</span> <span class="st">"EffpsII"</span>,</span>
<span>                            timePoints <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">1</span>, to <span class="op">=</span> <span class="fl">73</span>, by <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,</span>
<span>                            engine <span class="op">=</span> <span class="st">"asreml"</span>,</span>
<span>                            spatial <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">modPhenoSpAs</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Here the best spatial model is: trait = <strong>genotype</strong> +
<strong>row</strong> + <strong>col</strong> +
<strong><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ϵ</mi><annotation encoding="application/x-tex">\epsilon</annotation></semantics></math></strong>,
with a spatial component: <strong>AR1(rowId):AR1(colId)</strong>. It has
been selected using 10 time points.</p>
<p>Plotting and extracting results is then done the same way as for
SpATS. Below are a few examples.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"asreml"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">spatCorrSpAs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/getCorrected.html">getCorrected</a></span><span class="op">(</span><span class="va">modPhenoSpAs</span>, timePoints <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"asreml"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">modPhenoSpAs</span>, </span>
<span>       plotType <span class="op">=</span> <span class="st">"herit"</span>,</span>
<span>       yLim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Note that when the engine is ASReml, the heritability is calculated
using the formula provided in <span class="citation">(<a href="#ref-Cullis2006">Cullis, Smith, and Coombes 2006</a>)</span>.</p>
</div>
</div>
<div class="section level2">
<h2 id="ASRemlnoSP">Modeling without spatial terms with ASReml<a class="anchor" aria-label="anchor" href="#ASRemlnoSP"></a>
</h2>
<p>When the row and column coordinates are not available, only ASReml
can be used for modeling. In that case, the model simply uses the
genotype and the extraFixedFactors, if any.</p>
<table class="table">
<colgroup>
<col width="45%">
<col width="30%">
<col width="24%">
</colgroup>
<thead><tr class="header">
<th>OPTION</th>
<th>MODEL FITTED</th>
<th>SPATIAL TERM</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>spatial = FALSE</td>
<td>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>y</mi><mi>t</mi></msub><annotation encoding="application/x-tex">y_t</annotation></semantics></math>
= <strong>genotype</strong> +
<strong><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ϵ</mi><annotation encoding="application/x-tex">\epsilon</annotation></semantics></math></strong>
</td>
<td>-</td>
</tr>
<tr class="even">
<td>spatial = FALSE, extraFixedFactors = c(“A”, “B”)</td>
<td>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>y</mi><mi>t</mi></msub><annotation encoding="application/x-tex">y_t</annotation></semantics></math>
= <em>A</em> + <em>B</em> + <strong>genotype</strong> +
<strong><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ϵ</mi><annotation encoding="application/x-tex">\epsilon</annotation></semantics></math></strong>
</td>
<td>-</td>
</tr>
</tbody>
</table>
<p>In the models above and below, fixed effects are indicated in
<em>italics</em> whereas random effects are indicated in
<strong>bold</strong>. <code>genotype</code> can be fitted as
<strong>random</strong> or <em>fixed</em> effect using the option
<code>what</code>. The option <code>useCheck</code> is not displayed in
the table, but works the same as for SpATS (see section <a href="#SpATS"><strong>3.1</strong></a>).</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Fit a model on few time points without spatial function.</span></span>
<span><span class="va">modPhenoAs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/fitModels.html">fitModels</a></span><span class="op">(</span>TP <span class="op">=</span> <span class="va">phenoTPOut</span>, </span>
<span>                        trait <span class="op">=</span> <span class="st">"EffpsII"</span>,</span>
<span>                        timePoints <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">1</span>, to <span class="op">=</span> <span class="fl">73</span>, by <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,</span>
<span>                        engine <span class="op">=</span> <span class="st">"asreml"</span>,</span>
<span>                        spatial <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="genodecomp">Modeling with decomposition of genotypes using Example 2<a class="anchor" aria-label="anchor" href="#genodecomp"></a>
</h2>
<p>When an experimental treatment is applied, for example, a water
scenario, it is required to decompose the genotypic variance into the
levels of the treatment. In the following example, two water scenarios,
well-watered (WW) and water deficit (WD), were applied. Thus, instead of
modeling one genotypic variance, there will be one genotypic variance
per treatment. In this part, we will describe briefly what is specific
of such modeling with the statgenHTP package using the second example
data set.</p>
<p>We will use the <code>TP</code> object
<strong>phenoTParchOut</strong> in which annotated time points have been
replaced by NA (see <a href="OutlierSingleObs_HTP.html"><strong>statgenHTP tutorial: 2. Outlier
detection for single observations</strong></a>).</p>
<p>We can first check the number of time points containing data for a
given trait:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../reference/countValid.html">countValid</a></span><span class="op">(</span><span class="va">phenoTParchOut</span>, <span class="st">"LeafArea"</span><span class="op">)</span></span>
<span><span class="co">#&gt; 2017-04-13 2017-04-14 2017-04-15 2017-04-16 2017-04-17 2017-04-18 2017-04-19 </span></span>
<span><span class="co">#&gt;        815       1346       1666       1665       1669       1671       1192 </span></span>
<span><span class="co">#&gt; 2017-04-20 2017-04-21 2017-04-22 2017-04-23 2017-04-24 2017-04-25 2017-04-26 </span></span>
<span><span class="co">#&gt;       1532        823       1673       1617       1221       1672       1072 </span></span>
<span><span class="co">#&gt; 2017-04-27 2017-04-28 2017-04-29 2017-04-30 2017-05-01 2017-05-02 2017-05-03 </span></span>
<span><span class="co">#&gt;       1673       1134       1137       1074       1134       1137       1092 </span></span>
<span><span class="co">#&gt; 2017-05-04 2017-05-05 2017-05-06 2017-05-07 2017-05-08 2017-05-09 2017-05-10 </span></span>
<span><span class="co">#&gt;       1449        782       1058       1240       1034        665        885 </span></span>
<span><span class="co">#&gt; 2017-05-11 2017-05-12 2017-05-13 2017-05-14 2017-05-15 </span></span>
<span><span class="co">#&gt;       1022       1313       1044        452        840</span></span></code></pre></div>
<p>In this case, time point “2017-05-14” has only 455 observations, less
than half of the total number of observations. It can bias the modeling
at this time point and one may want to remove it before running the
spatial analysis.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># getTimePoints(phenoTParchOut)</span></span>
<span><span class="va">phenoTParchOut</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/removeTimePoints.html">removeTimePoints</a></span><span class="op">(</span><span class="va">phenoTParchOut</span>,</span>
<span>                                   timePoints <span class="op">=</span> <span class="fl">32</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="modeling">Modeling<a class="anchor" aria-label="anchor" href="#modeling"></a>
</h3>
<p>Using the <code>geno.decomp</code> option when modeling will have two
main consequences in the model: the <code>geno.decomp</code> variable(s)
will be added as a fixed main effect for the grouping factor and
separate variance components for the genotypes at each level of the
grouping or decomposing factor (and the extraFixedFactors and/or check,
if any, with SpATS only). The table below provides one example with
three models:</p>
<table class="table">
<colgroup>
<col width="24%">
<col width="9%">
<col width="50%">
<col width="14%">
</colgroup>
<thead><tr class="header">
<th>OPTION</th>
<th>ENGINE</th>
<th>MODEL FITTED</th>
<th>SPATIAL TERM</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>geno.decomp = “treatment”</td>
<td>SpATS</td>
<td>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math>
=
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>μ</mi><annotation encoding="application/x-tex">\mu</annotation></semantics></math>
+ <em>treatment</em> + <strong>treatment:genotype</strong> +
<strong>rowId</strong> + <strong>colId</strong> +
<strong><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ϵ</mi><annotation encoding="application/x-tex">\epsilon</annotation></semantics></math></strong>
</td>
<td>PSANOVA</td>
</tr>
<tr class="even">
<td>geno.decomp = “treatment”, useCheck = TRUE, extraFixedFactors =
“covar1”</td>
<td>SpATS</td>
<td>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math>
=
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>μ</mi><annotation encoding="application/x-tex">\mu</annotation></semantics></math>
+ <em>treatment</em> + <em>treatment:covar1</em> +
<em>treatment:check</em> + <strong>treatment:genoCheck</strong> +
<strong>rowId</strong> + <strong>colId</strong> +
<strong><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ϵ</mi><annotation encoding="application/x-tex">\epsilon</annotation></semantics></math></strong>
</td>
<td>PSANOVA</td>
</tr>
<tr class="odd">
<td>spatial = TRUE, geno.decomp = “treatment”</td>
<td>ASReml</td>
<td>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math>
=
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>μ</mi><annotation encoding="application/x-tex">\mu</annotation></semantics></math>
+ <em>treatment</em> + <strong>treatment:genotype</strong> +
<strong>rowId</strong> + <strong>colId</strong> +
<strong><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ϵ</mi><annotation encoding="application/x-tex">\epsilon</annotation></semantics></math></strong>
</td>
<td>AR1(rowId):AR1(colId)</td>
</tr>
</tbody>
</table>
<blockquote>
<p><em>NOTE: At the moment, it is not possible to use the combination of
<code>geno.decomp</code> and <code>what = "fixed"</code>.</em></p>
</blockquote>
<p>Using the Phenoarch example, we will apply a genotype decomposition
using the variables “Scenario” and “population”:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">modPhenoSpGD</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/fitModels.html">fitModels</a></span><span class="op">(</span>TP <span class="op">=</span> <span class="va">phenoTParchOut</span>,</span>
<span>                          trait <span class="op">=</span> <span class="st">"LeafArea"</span>,</span>
<span>                          geno.decomp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Scenario"</span>, <span class="st">"population"</span><span class="op">)</span>,</span>
<span>                          timePoints <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">1</span>, to <span class="op">=</span> <span class="fl">33</span>, by <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="output">Output<a class="anchor" aria-label="anchor" href="#output"></a>
</h3>
<p>Extracting results and plotting from the models work exactly the same
as previously. For example, the spatial plot on this data set looks like
the following for one time point:</p>
<p><img src="SpatialModel_HTP_files/figure-html/plotSatASReml-1.png" width="672" style="display: block; margin: auto;"></p>
<p>There are some significant differences in the display of some results
and plots. They are highlighted below.</p>
<p>The predictions have two values per genotype, one for each level of
the decomposition <code>geno.decomp</code>, here “Scenario_population”,
as illustrated in the table below for three genotypes predicted from the
SpATS model <code>modPhenoSpGD</code>.</p>
<table class="table">
<colgroup>
<col width="14%">
<col width="14%">
<col width="15%">
<col width="11%">
<col width="22%">
<col width="21%">
</colgroup>
<thead><tr class="header">
<th align="center">timeNumber</th>
<th align="center">timePoint</th>
<th align="center">geno.decomp</th>
<th align="center">genotype</th>
<th align="center">predicted.values</th>
<th align="center">standard.errors</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">16</td>
<td align="center">2017-04-28</td>
<td align="center">WD_Panel1</td>
<td align="center">GenoA01</td>
<td align="center">0.0680753</td>
<td align="center">0.0032742</td>
</tr>
<tr class="even">
<td align="center">16</td>
<td align="center">2017-04-28</td>
<td align="center">WD_Panel1</td>
<td align="center">GenoA02</td>
<td align="center">0.0812845</td>
<td align="center">0.0032697</td>
</tr>
<tr class="odd">
<td align="center">16</td>
<td align="center">2017-04-28</td>
<td align="center">WD_Panel2</td>
<td align="center">GenoB01</td>
<td align="center">0.0767823</td>
<td align="center">0.0043653</td>
</tr>
<tr class="even">
<td align="center">16</td>
<td align="center">2017-04-28</td>
<td align="center">WD_Panel2</td>
<td align="center">GenoB02</td>
<td align="center">0.0748107</td>
<td align="center">0.0043197</td>
</tr>
<tr class="odd">
<td align="center">16</td>
<td align="center">2017-04-28</td>
<td align="center">WW_Panel1</td>
<td align="center">GenoA01</td>
<td align="center">0.0714313</td>
<td align="center">0.0025789</td>
</tr>
<tr class="even">
<td align="center">16</td>
<td align="center">2017-04-28</td>
<td align="center">WW_Panel1</td>
<td align="center">GenoA02</td>
<td align="center">0.0802842</td>
<td align="center">0.0025788</td>
</tr>
<tr class="odd">
<td align="center">16</td>
<td align="center">2017-04-28</td>
<td align="center">WW_Panel2</td>
<td align="center">GenoB01</td>
<td align="center">0.0731028</td>
<td align="center">0.0041211</td>
</tr>
<tr class="even">
<td align="center">16</td>
<td align="center">2017-04-28</td>
<td align="center">WW_Panel2</td>
<td align="center">GenoB02</td>
<td align="center">0.0771899</td>
<td align="center">0.0041214</td>
</tr>
</tbody>
</table>
<p>The heritabilities are now given for each of the
<code>geno.decomp</code> levels and their plot now displays one line per
level.</p>
<table class="table">
<thead><tr class="header">
<th align="center">timeNumber</th>
<th align="center">timePoint</th>
<th align="center">WD_Panel1</th>
<th align="center">WW_Panel1</th>
<th align="center">WD_Panel2</th>
<th align="center">WW_Panel2</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">2017-04-13</td>
<td align="center">0.89</td>
<td align="center">0.91</td>
<td align="center">0.52</td>
<td align="center">0.49</td>
</tr>
<tr class="even">
<td align="center">4</td>
<td align="center">2017-04-16</td>
<td align="center">0.94</td>
<td align="center">0.95</td>
<td align="center">0.72</td>
<td align="center">0.67</td>
</tr>
<tr class="odd">
<td align="center">7</td>
<td align="center">2017-04-19</td>
<td align="center">0.92</td>
<td align="center">0.94</td>
<td align="center">0.73</td>
<td align="center">0.64</td>
</tr>
<tr class="even">
<td align="center">10</td>
<td align="center">2017-04-22</td>
<td align="center">0.94</td>
<td align="center">0.96</td>
<td align="center">0.80</td>
<td align="center">0.73</td>
</tr>
<tr class="odd">
<td align="center">13</td>
<td align="center">2017-04-25</td>
<td align="center">0.94</td>
<td align="center">0.95</td>
<td align="center">0.79</td>
<td align="center">0.71</td>
</tr>
<tr class="even">
<td align="center">16</td>
<td align="center">2017-04-28</td>
<td align="center">0.91</td>
<td align="center">0.94</td>
<td align="center">0.79</td>
<td align="center">0.71</td>
</tr>
</tbody>
</table>
<p><img src="SpatialModel_HTP_files/figure-html/plotSpHeritGD-1.png" width="480" style="display: block; margin: auto;"></p>
<p>The prediction and corrected data plots display one plot per
combination genotype × geno.decomp.</p>
<p><img src="SpatialModel_HTP_files/figure-html/plotSprawGD-1.png" width="672" style="display: block; margin: auto;"></p>
<hr>
</div>
<div class="section level3">
<h3 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h3>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-Gilmour2017" class="csl-entry">
Butler, D. G., B. R. Cullis, A. R. Gilmour, B. G. Gogel, and R.
Thompson. 2017. <span>“ASReml-r Reference Manual Version 4.”</span> <a href="https://www.vsni.co.uk/" class="external-link">https://www.vsni.co.uk/</a>.
</div>
<div id="ref-Cabrera2016" class="csl-entry">
Cabrera-Bosquet, Llorenç, Christian Fournier, Nicolas Brichet, Claude
Welcker, Benoît Suard, and François Tardieu. 2016.
<span>“High-Throughput Estimation of Incident Light, Light Interception
and Radiation-Use Efficiency of Thousands of Plants in a Phenotyping
Platform.”</span> <em>New Phytologist</em> 212 (1): 269–81. <a href="https://doi.org/10.1111/nph.14027" class="external-link">https://doi.org/10.1111/nph.14027</a>.
</div>
<div id="ref-Cullis2006" class="csl-entry">
Cullis, B. R., A. B. Smith, and N. E. Coombes. 2006. <span>“On the
Design of Early Generation Variety Trials with Correlated Data.”</span>
<em>Journal of Agricultural, Biological, and Environmental
Statistics</em> 11 (4): 381–93. <a href="https://doi.org/10.1198/108571106X154443" class="external-link">https://doi.org/10.1198/108571106X154443</a>.
</div>
<div id="ref-Lee2013" class="csl-entry">
Lee, Dae-Jin, María Durbán, and Paul Eilers. 2013. <span>“Efficient
Two-Dimensional Smoothing with p-Spline ANOVA Mixed Models and Nested
Bases.”</span> <em>Computational Statistics <span>&amp;</span> Data
Analysis</em> 61 (May): 22–37. <a href="https://doi.org/10.1016/j.csda.2012.11.013" class="external-link">https://doi.org/10.1016/j.csda.2012.11.013</a>.
</div>
<div id="ref-Perez2022" class="csl-entry">
Pérez-Valencia, Diana M, María Xosé Rodríguez-Álvarez, Martin P Boer,
Lukas Kronenberg, Andreas Hund, Llorenç Cabrera-Bosquet, Emilie J
Millet, and Fred A van Eeuwijk. 2022. <span>“A Two-Stage Approach for
the Spatio-Temporal Analysis of High-Throughput Phenotyping
Data.”</span> <em>Scientific Reports</em> 12 (1): 1–16. <a href="https://doi.org/10.1038/s41598-022-06935-9" class="external-link">https://doi.org/10.1038/s41598-022-06935-9</a>.
</div>
<div id="ref-RodAlv2018" class="csl-entry">
Rodríguez-Álvarez, María, Martin P. Boer, Fred van Eeuwijk, and Paul H.
C. Eilers. 2018. <span>“Correcting for Spatial Heterogeneity in Plant
Breeding Experiments with p-Splines.”</span> <em>Spatial Statistics</em>
23 (October): 52–71. <a href="https://doi.org/10.1016/j.spasta.2017.10.003" class="external-link">https://doi.org/10.1016/j.spasta.2017.10.003</a>.
</div>
<div id="ref-Velazco2017" class="csl-entry">
Velazco, Julio G., María Xosé Rodríguez-Álvarez, Martin P. Boer, David
R. Jordan, Paul H. C. Eilers, Marcos Malosetti, and Fred A. van Eeuwijk.
2017. <span>“Modelling Spatial Trends in Sorghum Breeding Field Trials
Using a Two-Dimensional <span>P</span>-Spline Mixed Model.”</span>
<em>Theoretical and Applied Genetics</em> 130 (7): 1375–92. <a href="https://doi.org/10.1007/s00122-017-2894-4" class="external-link">https://doi.org/10.1007/s00122-017-2894-4</a>.
</div>
<div id="ref-Welham2004" class="csl-entry">
Welham, Sue, Brian Cullis, Beverley Gogel, Arthur Gilmour, and Robin
Thompson. 2004. <span>“Prediction in Linear Mixed Models.”</span>
<em>Australian &amp; New Zealand Journal of Statistics</em> 46 (3):
325–47. <a href="https://doi.org/10.1111/j.1467-842X.2004.00334.x" class="external-link">https://doi.org/10.1111/j.1467-842X.2004.00334.x</a>.
</div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Emilie J Millet, Maria Xose Rodriguez Alvarez, Diana Marcela Perez Valencia, Isabelle Sanchez, Nadine Hilgert, Bart-Jan van Rossum, Fred van Eeuwijk, Martin Boer.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
