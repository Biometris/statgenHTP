<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>statgenHTP: A short overview • statgenHTP</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="statgenHTP: A short overview">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">statgenHTP</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.8</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html" aria-label="home"><span class="fa fa-home"></span></a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Vignettes</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="nav-link" href="../news/index.html"><span class="fa fa-newspaper-o"></span> news</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html"><span class="fa fa-file-code-o"></span> functions</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-other-packages" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true"><span class="fa fa-seedling"></span> other packages</button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-other-packages">
<li><a class="external-link dropdown-item" href="https://biometris.github.io/statgenSTA">statgenSTA</a></li>
    <li><a class="external-link dropdown-item" href="https://biometris.github.io/statgenGxE">statgenGxE</a></li>
    <li><a class="external-link dropdown-item" href="https://biometris.github.io/statgenGWAS">statgenGWAS</a></li>
    <li><a class="external-link dropdown-item" href="https://biometris.github.io/statgenQTLxT">statgenQTLxT</a></li>
    <li><a class="external-link dropdown-item" href="https://biometris.github.io/statgenIBD">statgenIBD</a></li>
    <li><a class="external-link dropdown-item" href="https://biometris.github.io/statgenMPP">statgenMPP</a></li>
    <li><a class="external-link dropdown-item" href="https://biometris.github.io/LMMsolver">LMMsolver</a></li>
  </ul>
</li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Biometris/statgenHTP"><span class="fa fa-github fa-lg fab"></span> github</a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>statgenHTP: A short overview</h1>
                        <h4 data-toc-skip class="author">Emilie Millet,
Diana M. Pérez-Valencia, Bart-Jan van Rossum</h4>
            
            <h4 data-toc-skip class="date">2025-04-29</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/Biometris/statgenHTP/blob/main/vignettes/Overview_HTP.Rmd" class="external-link"><code>vignettes/Overview_HTP.Rmd</code></a></small>
      <div class="d-none name"><code>Overview_HTP.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="the-statgenhtp-package">The statgenHTP Package<a class="anchor" aria-label="anchor" href="#the-statgenhtp-package"></a>
</h2>
<p>The statgenHTP package is developed as an easy-to-use package for
analyzing data coming from high throughput phenotyping (HTP) platform
experiments. The package provides many options for plotting and
exporting the results of the analyses. It was developed within the <a href="https://eppn2020.plant-phenotyping.eu/" class="external-link">EPPN<sup>2020</sup>project</a>
to meet the needs for automated analyses of HTP data.</p>
<p>New phenotyping techniques enable measuring traits at high
throughput, with traits being measured at multiple time points for
hundreds or thousands of plants. This requires automatic modeling of the
data <span class="citation">(<a href="#ref-Tardieu2017">Tardieu et al.
2017</a>)</span> with a model that is robust, flexible and has easy
selection steps.</p>
<p>The aim of this package is to provide a suit of functions to (1)
detect outliers at the time point or at the plant levels, (2) accurately
separate the genetic effects from the spatial effects at each time
point, (3) model the temporal evolution of the genetic signal, and (4)
estimate relevant parameters from a modeled time course. It will provide
the user with either genotypic values or corrected values that can be
used for further modeling, e.g. extract responses to environment <span class="citation">(<a href="#ref-vanEeuw2019">Eeuwijk et al.
2019</a>)</span>.</p>
<p><strong>Structure of the package</strong></p>
<p>The overall structure of the package is in six main parts:</p>
<ol style="list-style-type: decimal">
<li>Data description and preparation - <a href="https://biometris.github.io/statgenHTP/articles/vignettesSite/Intro_HTP.html" class="external-link"><em>statgenHTP
tutorial: 1. Introduction, data description and
preparation</em></a>
</li>
<li>Outlier detection: single observations - <a href="https://biometris.github.io/statgenHTP/articles/vignettesSite/OutlierSingleObs_HTP.html" class="external-link"><em>statgenHTP
tutorial: 2. Outlier detection for single observations</em></a>
</li>
<li>Correction for spatial trends - <a href="https://biometris.github.io/statgenHTP/articles/vignettesSite/SpatialModel_HTP.html" class="external-link"><em>statgenHTP
tutorial: 3. Correction for spatial trends</em></a>
</li>
<li>Outlier detection: series of observations - <a href="https://biometris.github.io/statgenHTP/articles/vignettesSite/OutlierSerieObs_HTP.html" class="external-link"><em>statgenHTP
tutorial: 4. Outlier detection for series of observations</em></a>
</li>
<li>Modeling genetic signal - <a href="https://biometris.github.io/statgenHTP/articles/vignettesSite/HierarchicalDataModel_HTP.html" class="external-link"><em>statgenHTP
tutorial: 5. Modelling the temporal evolution of the genetic
signal</em></a>
</li>
<li>Parameter estimation - <a href="https://biometris.github.io/statgenHTP/articles/vignettesSite/ParameterEstimation_HTP.html" class="external-link"><em>statgenHTP
tutorial: 6. Estimation of parameters for time courses</em></a>
</li>
</ol>
<p>This document gives an overview of these steps and how to use the
package to perform an analysis. For a more in depth description of the
data, a theoretical background for the different steps and examples with
additional data sets see the package <a href="https://biometris.github.io/statgenHTP/" class="external-link">website</a>.</p>
<hr>
</div>
<div class="section level2">
<h2 id="data-description">Data description<a class="anchor" aria-label="anchor" href="#data-description"></a>
</h2>
<div class="section level3">
<h3 id="ex1">Example 1: photosystem efficiency in Arabidopsis<a class="anchor" aria-label="anchor" href="#ex1"></a>
</h3>
<p>The used in this vignette contains data from an experiment in the
Phenovator platform (WUR, Netherlands, <span class="citation">(<a href="#ref-Flood2016">Flood et al. 2016</a>)</span>) with Arabidopsis
plants. It consists of one experiment with 1440 plants grown in a growth
chamber with different light intensity. The data set called
“PhenovatorDat1” is included in the package.</p>
<p>The number of tested genotypes (<code>Genotype</code>) is 192 with
6-7 replicates per genotype (<code>Replicate</code>). Four reference
genotypes were also tested with 15 or 30 replicates. The studied trait
is the photosystem II efficiency (<code>EffpsII</code>) extracted from
the pictures over time <span class="citation">(<a href="#ref-vanRooi2017">Rooijen et al. 2017</a>)</span>. The unique ID
of the plant is recorded (<code>pos</code>), together with the pot
position in row (<code>x</code>) and in column (<code>y</code>). The
data set also includes factors from the design: the position of the
camera (<code>Image_pos</code>) and the pots table
(<code>Basin</code>).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"PhenovatorDat1"</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="9%">
<col width="6%">
<col width="10%">
<col width="10%">
<col width="3%">
<col width="3%">
<col width="16%">
<col width="20%">
<col width="8%">
<col width="7%">
</colgroup>
<thead><tr class="header">
<th align="center">Genotype</th>
<th align="center">Basin</th>
<th align="center">Image_pos</th>
<th align="center">Replicate</th>
<th align="center">x</th>
<th align="center">y</th>
<th align="center">Sowing_Position</th>
<th align="center">timepoints</th>
<th align="center">EffpsII</th>
<th align="center">pos</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">G001</td>
<td align="center">2</td>
<td align="center">1b</td>
<td align="center">8</td>
<td align="center">14</td>
<td align="center">32</td>
<td align="center">8R02</td>
<td align="center">2018-05-31 16:37:00</td>
<td align="center">0.685</td>
<td align="center">c14r32</td>
</tr>
<tr class="even">
<td align="center">G001</td>
<td align="center">2</td>
<td align="center">1b</td>
<td align="center">8</td>
<td align="center">14</td>
<td align="center">32</td>
<td align="center">8R02</td>
<td align="center">2018-06-01 09:07:00</td>
<td align="center">0.688</td>
<td align="center">c14r32</td>
</tr>
<tr class="odd">
<td align="center">G001</td>
<td align="center">2</td>
<td align="center">1b</td>
<td align="center">8</td>
<td align="center">14</td>
<td align="center">32</td>
<td align="center">8R02</td>
<td align="center">2018-06-01 11:37:00</td>
<td align="center">0.652</td>
<td align="center">c14r32</td>
</tr>
<tr class="even">
<td align="center">G001</td>
<td align="center">2</td>
<td align="center">1b</td>
<td align="center">8</td>
<td align="center">14</td>
<td align="center">32</td>
<td align="center">8R02</td>
<td align="center">2018-06-01 14:37:00</td>
<td align="center">0.671</td>
<td align="center">c14r32</td>
</tr>
<tr class="odd">
<td align="center">G001</td>
<td align="center">2</td>
<td align="center">1b</td>
<td align="center">8</td>
<td align="center">14</td>
<td align="center">32</td>
<td align="center">8R02</td>
<td align="center">2018-06-01 16:37:00</td>
<td align="center">0.616</td>
<td align="center">c14r32</td>
</tr>
<tr class="even">
<td align="center">G001</td>
<td align="center">2</td>
<td align="center">1b</td>
<td align="center">8</td>
<td align="center">14</td>
<td align="center">32</td>
<td align="center">8R02</td>
<td align="center">2018-06-02 09:07:00</td>
<td align="center">0.678</td>
<td align="center">c14r32</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level2">
<h2 id="data-preparation">Data preparation<a class="anchor" aria-label="anchor" href="#data-preparation"></a>
</h2>
<p>The first step when modeling platform experiment data with the
statgenHTP package is creating an object of class <code>TP</code> (Time
Points). In this object, the time points are split into single
<code>data.frames</code>. It is then used throughout the statgenHTP
package as input for analyses.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Create a TP object containing the data from the Phenovator.</span></span>
<span><span class="va">phenoTP</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createTimePoints.html">createTimePoints</a></span><span class="op">(</span>dat <span class="op">=</span> <span class="va">PhenovatorDat1</span>,</span>
<span>                            experimentName <span class="op">=</span> <span class="st">"Phenovator"</span>,</span>
<span>                            genotype <span class="op">=</span> <span class="st">"Genotype"</span>,</span>
<span>                            timePoint <span class="op">=</span> <span class="st">"timepoints"</span>,</span>
<span>                            repId <span class="op">=</span> <span class="st">"Replicate"</span>,</span>
<span>                            plotId <span class="op">=</span> <span class="st">"pos"</span>,</span>
<span>                            rowNum <span class="op">=</span> <span class="st">"y"</span>, colNum <span class="op">=</span> <span class="st">"x"</span>,</span>
<span>                            addCheck <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                            checkGenotypes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"check1"</span>, <span class="st">"check2"</span>, <span class="st">"check3"</span>, <span class="st">"check4"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: The following plotIds have observations for less than 50% of the time points:</span></span>
<span><span class="co">#&gt; c24r41, c7r18, c7r49</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">phenoTP</span><span class="op">)</span></span>
<span><span class="co">#&gt; phenoTP contains data for experiment Phenovator.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; It contains 73 time points.</span></span>
<span><span class="co">#&gt; First time point: 2018-05-31 16:37:00 </span></span>
<span><span class="co">#&gt; Last time point: 2018-06-18 16:37:00 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; The following genotypes are defined as check genotypes: check1, check2, check3, check4.</span></span></code></pre></div>
<p>In this data set, 3 plants contain less than 50% of the 73 time
points. The user may choose to check the data for these plants and
eventually to remove them from the data set.</p>
<p>The function <code><a href="../reference/getTimePoints.html">getTimePoints()</a></code> allows to generate a
<code>data.frame</code> containing the time points and their numbers in
the <code>TP</code> object. Below is an example with the first 6 time
points of the <code>phenoTP</code>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Extract the time points table.</span></span>
<span><span class="va">timepoint</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getTimePoints.html">getTimePoints</a></span><span class="op">(</span><span class="va">phenoTP</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="center">timeNumber</th>
<th align="center">timePoint</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">2018-05-31 16:37:00</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">2018-06-01 09:07:00</td>
</tr>
<tr class="odd">
<td align="center">3</td>
<td align="center">2018-06-01 11:37:00</td>
</tr>
<tr class="even">
<td align="center">4</td>
<td align="center">2018-06-01 14:37:00</td>
</tr>
<tr class="odd">
<td align="center">5</td>
<td align="center">2018-06-01 16:37:00</td>
</tr>
<tr class="even">
<td align="center">6</td>
<td align="center">2018-06-02 09:07:00</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="data-visualization">Data visualization<a class="anchor" aria-label="anchor" href="#data-visualization"></a>
</h2>
<p>Several plots can be made to further investigate the content of a
<code>TP</code> object.</p>
<div class="section level3">
<h3 id="layout-plot">Layout plot<a class="anchor" aria-label="anchor" href="#layout-plot"></a>
</h3>
<p>The first type of plot displays the layout of the experiment as a
grid using the row and column coordinates. The default option creates
plots of all time points in the <code>TP</code> object. This can be
restricted to a selection of time points using their number in the
option <code>timePoints</code>. If <code>repId</code> was specified when
creating the <code>TP</code> object, replicate blocks are delineated by
a black line. Missing plots are indicated in white enclosed with a bold
black line. This type of plot allows checking the design of the
experiment.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Plot the layout for the third time point.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">phenoTP</span>, </span>
<span>     plotType <span class="op">=</span> <span class="st">"layout"</span>,</span>
<span>     timePoints <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p><img src="Overview_HTP_files/figure-html/layoutPlot-1.png" width="480" style="display: block; margin: auto;"></p>
<p>Here, the third time point is displayed which corresponds to the
1<sup>st</sup> of June 2018 at 11:37. Note that the title can be
manually changed using the <code>title</code> option. This plot can be
extended by highlighting interesting genotypes in the layout. Hereafter
the check genotypes are highlighted:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Plot the layout for the third time point with the check genotypes highlighted.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">phenoTP</span>, </span>
<span>     plotType <span class="op">=</span> <span class="st">"layout"</span>,</span>
<span>     timePoints <span class="op">=</span> <span class="fl">3</span>,  </span>
<span>     highlight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"check1"</span>, <span class="st">"check2"</span>, <span class="st">"check3"</span>, <span class="st">"check4"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Overview_HTP_files/figure-html/layoutPlotHL-1.png" width="480" style="display: block; margin: auto;"></p>
<p>It is possible to add the labels of the genotypes to the layout.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Plot the layout for the third time point.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">phenoTP</span>, </span>
<span>     plotType <span class="op">=</span> <span class="st">"layout"</span>,</span>
<span>     timePoints <span class="op">=</span> <span class="fl">3</span>,  </span>
<span>     highlight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"check1"</span>, <span class="st">"check2"</span>, <span class="st">"check3"</span>, <span class="st">"check4"</span><span class="op">)</span>,</span>
<span>     showGeno <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="Overview_HTP_files/figure-html/layoutPlotSG-1.png" width="768" style="display: block; margin: auto;"></p>
<p>We can visualize the raw data of a given trait on the layout, as a
heatmap. This type of plot gives a first indication of the spatial
variability at a given time point. This can be further investigated with
the spatial modeling.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Plot the layout for the third time point.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">phenoTP</span>, </span>
<span>     plotType <span class="op">=</span> <span class="st">"layout"</span>,</span>
<span>     timePoints <span class="op">=</span> <span class="fl">3</span>,  </span>
<span>     traits <span class="op">=</span> <span class="st">"EffpsII"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Overview_HTP_files/figure-html/layoutPlotheatmap-1.png" width="768" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="raw-data-plot">Raw data plot<a class="anchor" aria-label="anchor" href="#raw-data-plot"></a>
</h3>
<p>Raw data can be displayed per genotype with one color per plotId.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Create the raw data time courses for three genotypes.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">phenoTP</span>, </span>
<span>     traits <span class="op">=</span> <span class="st">"EffpsII"</span>,</span>
<span>     plotType <span class="op">=</span> <span class="st">"raw"</span>,</span>
<span>     genotypes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"G001"</span>, <span class="st">"G002"</span>, <span class="st">"check1"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Overview_HTP_files/figure-html/rawVator-1.png" width="672" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="boxplot">Boxplot<a class="anchor" aria-label="anchor" href="#boxplot"></a>
</h3>
<p>Boxplots can be made to visually assess the variability of the
trait(s) in the <code>TP</code> object. By default a box is plotted per
time point for the specified trait using all time points.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Create a boxplot for "EffpsII" using the default all time points.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">phenoTP</span>, </span>
<span>     plotType <span class="op">=</span> <span class="st">"box"</span>,</span>
<span>     traits <span class="op">=</span> <span class="st">"EffpsII"</span><span class="op">)</span> </span></code></pre></div>
<p><img src="Overview_HTP_files/figure-html/boxPlot-1.png" width="672" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="correlation-plot">Correlation plot<a class="anchor" aria-label="anchor" href="#correlation-plot"></a>
</h3>
<p>Finally, a plot of the correlations between the observations in time
for a specified trait can be made. The order of the plot is
chronological and by default all time points are used.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Create a correlation plot for "EffpsII" for a selection of time points.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">phenoTP</span>, </span>
<span>     plotType <span class="op">=</span> <span class="st">"cor"</span>,</span>
<span>     traits <span class="op">=</span> <span class="st">"EffpsII"</span>,</span>
<span>     timePoints <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">1</span>, to <span class="op">=</span> <span class="fl">73</span>, by <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Overview_HTP_files/figure-html/corPlot-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level2">
<h2 id="outlier-detection-for-single-observations">Outlier detection for single observations<a class="anchor" aria-label="anchor" href="#outlier-detection-for-single-observations"></a>
</h2>
<p>Time courses of phenotypic data are viewed as continuous time-related
functions. The first cleaning step consists of roughly checking the
consistency of each point with its neighbors within a time course.
Outlying single observations are measurements that do not follow the
expected behavior at a given time. The detection of outlying
observations is done “one time course after the other”.</p>
<p>Local regression is used to locally approximate the time courses by
parametric functions. First a local regression is fitted at a set of
points, then the fit is interpolated to other points. A confidence
interval can then be calculated. Points outside this interval will be
annotated as outliers.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># First select a subset of plants, for example here 4 plants.</span></span>
<span><span class="va">plantSel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"c1r17"</span>,<span class="st">"c13r17"</span>,<span class="st">"c6r51"</span>,<span class="st">"c21r24"</span><span class="op">)</span> </span>
<span><span class="co"># Then run on the subset</span></span>
<span><span class="va">resuVatorHTP</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/detectSingleOut.html">detectSingleOut</a></span><span class="op">(</span>TP <span class="op">=</span> <span class="va">phenoTP</span>,</span>
<span>                                trait <span class="op">=</span> <span class="st">"EffpsII"</span>,</span>
<span>                                plotIds <span class="op">=</span> <span class="va">plantSel</span>,</span>
<span>                                confIntSize <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                                nnLocfit <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="8%">
<col width="25%">
<col width="9%">
<col width="12%">
<col width="12%">
<col width="12%">
<col width="12%">
<col width="9%">
</colgroup>
<thead><tr class="header">
<th align="center">plotId</th>
<th align="center">timePoint</th>
<th align="center">EffpsII</th>
<th align="center">yPred</th>
<th align="center">sd_yPred</th>
<th align="center">lwr</th>
<th align="center">upr</th>
<th align="center">outlier</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">c13r17</td>
<td align="center">2018-06-03 09:07:00</td>
<td align="center">0.751</td>
<td align="center">0.6852574</td>
<td align="center">0.0389194</td>
<td align="center">0.5684992</td>
<td align="center">0.8020156</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="center">c13r17</td>
<td align="center">2018-06-03 11:37:00</td>
<td align="center">0.538</td>
<td align="center">0.6833963</td>
<td align="center">0.0255016</td>
<td align="center">0.6068916</td>
<td align="center">0.7599011</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">c13r17</td>
<td align="center">2018-06-03 14:37:00</td>
<td align="center">0.737</td>
<td align="center">0.7045487</td>
<td align="center">0.0342136</td>
<td align="center">0.6019078</td>
<td align="center">0.8071896</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="center">c13r17</td>
<td align="center">2018-06-04 09:07:00</td>
<td align="center">0.619</td>
<td align="center">0.6330957</td>
<td align="center">0.0436610</td>
<td align="center">0.5021126</td>
<td align="center">0.7640788</td>
<td align="center">0</td>
</tr>
<tr class="odd">
<td align="center">c13r17</td>
<td align="center">2018-06-04 11:37:00</td>
<td align="center">0.711</td>
<td align="center">0.6655915</td>
<td align="center">0.0322765</td>
<td align="center">0.5687620</td>
<td align="center">0.7624211</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="center">c13r17</td>
<td align="center">2018-06-04 14:37:00</td>
<td align="center">0.633</td>
<td align="center">0.6861254</td>
<td align="center">0.0330415</td>
<td align="center">0.5870010</td>
<td align="center">0.7852499</td>
<td align="center">0</td>
</tr>
</tbody>
</table>
<p>The predicted values and the confidence interval can be visualized
using the <code>plot</code> function.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">resuVatorHTP</span>,</span>
<span>     outOnly <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="Overview_HTP_files/figure-html/plotOutVatorFA1-1.png" width="480" style="display: block; margin: auto;"></p>
<p>The annotated points can be replaced by NA for the studied trait
using the function <code><a href="../reference/removeSingleOut.html">removeSingleOut()</a></code>. It creates a new
<code>TP</code> object.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">phenoTPOut</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/removeSingleOut.html">removeSingleOut</a></span><span class="op">(</span><span class="va">phenoTP</span>,</span>
<span>                              <span class="va">resuVatorHTP</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="correction-for-spatial-trends">Correction for spatial trends<a class="anchor" aria-label="anchor" href="#correction-for-spatial-trends"></a>
</h2>
<p>Phenotyping facilities display spatial heterogeneity. For example,
the spatial variability of incident light can go up to 100% between pots
within a greenhouse <span class="citation">(<a href="#ref-Cabrera2016">Cabrera-Bosquet et al. 2016</a>)</span>. Taking
into account these spatial trends is a prerequisite for precise
estimation of genetic and treatment effects. In the same way as in field
trials, platform experiments should obey standard principles for
experimental design and statistical modeling.</p>
<p>To get corrected values and genotypic predictions we want to
accurately separate the genetic effects from the spatial effects at each
time point. To do this, for each time point a spatial model is fitted
for the trait we are interested in. In <code>statgenHTP</code> spatial
models can either be fitted using <em>SpATS</em> <span class="citation">(<a href="#ref-RodAlv2018">Rodríguez-Álvarez et al.
2018</a>)</span> and <em>ASReml</em> <span class="citation">(<a href="#ref-Gilmour2017">Butler et al. 2017</a>)</span>. This vignette
will focus on models fitted using SpATS. For models fitted using ASReml
see <a href="https://biometris.github.io/statgenHTP/articles/vignettesSite/SpatialModel_HTP.html" class="external-link">this
vignette</a>.</p>
<div class="section level3">
<h3 id="SpATS">Spatial model using SpATS<a class="anchor" aria-label="anchor" href="#SpATS"></a>
</h3>
<p>When SpATS is used for modeling, an extra spatial term is included in
the model. This spatial component is composed using the
<code>PSANOVA</code> function in the SpATS package which uses
2-dimensional smoothing with P-splines as described in <span class="citation">Lee, Durbán, and Eilers (<a href="#ref-Lee2013">2013</a>)</span> and in <span class="citation">Rodríguez-Álvarez et al. (<a href="#ref-RodAlv2018">2018</a>)</span>.</p>
<p>In the example below the model is fitted for a few points.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Fit a model for a few time points.</span></span>
<span><span class="va">modPhenoSp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fitModels.html">fitModels</a></span><span class="op">(</span>TP <span class="op">=</span> <span class="va">phenoTPOut</span>, </span>
<span>                        trait <span class="op">=</span> <span class="st">"EffpsII"</span>,</span>
<span>                        timePoints <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">33</span>, <span class="fl">36</span>, <span class="fl">54</span>, <span class="fl">73</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">modPhenoSp</span><span class="op">)</span></span>
<span><span class="co">#&gt; Models in modPhenoSp where fitted for experiment Phenovator.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; It contains 5 time points.</span></span>
<span><span class="co">#&gt; The models were fitted using SpATS.</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="model-plots">Model plots<a class="anchor" aria-label="anchor" href="#model-plots"></a>
</h3>
<p>Several types of plots can be made for fitted models. A
<strong>spatial</strong> plot consists of spatial plots of the raw data,
fitted values, residuals and either BLUEs or BLUPs, and a histogram of
the BLUEs or BLUPs. When SpATS is used for modeling an extra plot with
the fitted spatial trend is included.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">modPhenoSp</span>,</span>
<span>     timePoints <span class="op">=</span> <span class="fl">36</span>,</span>
<span>     plotType <span class="op">=</span> <span class="st">"spatial"</span>,</span>
<span>     spaTrend <span class="op">=</span> <span class="st">"percentage"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Overview_HTP_files/figure-html/plotSpatPerc-1.png" width="700.8"></p>
<p>It is also possible to create a time lapse of the ratio of spatial
trends over time. The scale is the same as previously described. The
time lapse is always written to an output file.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">modPhenoSp</span>, </span>
<span>     plotType <span class="op">=</span> <span class="st">"timeLapse"</span>,</span>
<span>     outFile <span class="op">=</span> <span class="st">"TimeLapse_modPhenoSp.gif"</span><span class="op">)</span></span></code></pre></div>
<p>In the <strong>rawPred</strong> plot the raw data (colored dots, one
color per plotId) is plotted overlaid with the predicted values (black
dots) from the fitted model.</p>
<blockquote>
<p>Note: The model has been fitted on a limited number of time points,
which is reflected in the plots. For plots using more time point see <a href="https://biometris.github.io/statgenHTP/articles/vignettesSite/SpatialModel_HTP.html" class="external-link">this
vignette</a>.</p>
</blockquote>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">modPhenoSp</span>, </span>
<span>     plotType <span class="op">=</span> <span class="st">"rawPred"</span>,</span>
<span>     genotypes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"G007"</span>, <span class="st">"G058"</span><span class="op">)</span><span class="op">)</span> </span></code></pre></div>
<p><img src="Overview_HTP_files/figure-html/plotSpPred-1.png" width="576" style="display: block; margin: auto;"></p>
<p>In the <strong>corrPred</strong> plot the corrected data (colored
dots, one color per plotId) is plotted overlaid with the predicted
values (black dots) from the fitted model.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">modPhenoSp</span>, </span>
<span>     plotType <span class="op">=</span> <span class="st">"corrPred"</span>,</span>
<span>     genotypes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"G007"</span>, <span class="st">"G058"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Overview_HTP_files/figure-html/plotSpCorr-1.png" width="576" style="display: block; margin: auto;"></p>
<p>The last three types of plot display different model parameters over
time. Plot type <strong>herit</strong> plots the heritability over
time.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">modPhenoSp</span>, </span>
<span>     plotType <span class="op">=</span> <span class="st">"herit"</span>,</span>
<span>     yLim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Overview_HTP_files/figure-html/plotSpHerit-1.png" width="336" style="display: block; margin: auto;"></p>
<p>Plot type <strong>variance</strong> plots the residual, column and
row variances over time. These plots can serve as diagnostics of the
experiment.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">modPhenoSp</span>, </span>
<span>     plotType <span class="op">=</span> <span class="st">"variance"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Overview_HTP_files/figure-html/plotSpVar-1.png" width="480" style="display: block; margin: auto;"></p>
<p>Plot type <strong>effDim</strong> plots the effective dimension from
models fitted using SpATS over time.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">modPhenoSp</span>, </span>
<span>     plotType <span class="op">=</span> <span class="st">"effDim"</span>,</span>
<span>     whichED <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"colId"</span>, <span class="st">"rowId"</span>, <span class="st">"fColRow"</span>,<span class="st">"colfRow"</span>, <span class="st">"surface"</span><span class="op">)</span>,</span>
<span>     EDType <span class="op">=</span> <span class="st">"ratio"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Overview_HTP_files/figure-html/plotSpED-1.png" width="480" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="extracting-model-results">Extracting model results<a class="anchor" aria-label="anchor" href="#extracting-model-results"></a>
</h3>
<p>All results that can be extracted are shown in the table below. The
first column contains the function names. The second column contains a
short description of the result that will be extracted and, where
needed, states for which modeling engines it can be extracted.</p>
<table class="table">
<colgroup>
<col width="22%">
<col width="77%">
</colgroup>
<thead><tr class="header">
<th>FUNCTION</th>
<th>DESCRIPTION</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>getGenoPred()</td>
<td>Best Linear Unbiased Predictions (BLUPS, genotype as random) or
Estimators (BLUEs, genotype as fixed)</td>
</tr>
<tr class="even">
<td>getCorrected()</td>
<td>Spatially corrected values at the experimental unit level</td>
</tr>
<tr class="odd">
<td>getVar()</td>
<td>Variance components</td>
</tr>
<tr class="even">
<td>getHerit()</td>
<td>Generalized heritabilities - only when genotype is random</td>
</tr>
<tr class="odd">
<td>getEffDims()</td>
<td>Effective dimensions - only for SpATS engine</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Extract the genotypic predictions for one time point: </span></span>
<span><span class="va">genoPredSp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getGenoPred.html">getGenoPred</a></span><span class="op">(</span><span class="va">modPhenoSp</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="14%">
<col width="27%">
<col width="11%">
<col width="23%">
<col width="22%">
</colgroup>
<thead><tr class="header">
<th align="center">timeNumber</th>
<th align="center">timePoint</th>
<th align="center">genotype</th>
<th align="center">predicted.values</th>
<th align="center">standard.errors</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">2018-05-31 16:37:00</td>
<td align="center">check1</td>
<td align="center">0.6708932</td>
<td align="center">0.0050545</td>
</tr>
<tr class="even">
<td align="center">1</td>
<td align="center">2018-05-31 16:37:00</td>
<td align="center">check2</td>
<td align="center">0.5811530</td>
<td align="center">0.0068930</td>
</tr>
<tr class="odd">
<td align="center">1</td>
<td align="center">2018-05-31 16:37:00</td>
<td align="center">check3</td>
<td align="center">0.6432175</td>
<td align="center">0.0067430</td>
</tr>
<tr class="even">
<td align="center">1</td>
<td align="center">2018-05-31 16:37:00</td>
<td align="center">check4</td>
<td align="center">0.6808257</td>
<td align="center">0.0049853</td>
</tr>
<tr class="odd">
<td align="center">1</td>
<td align="center">2018-05-31 16:37:00</td>
<td align="center">G001</td>
<td align="center">0.6706490</td>
<td align="center">0.0089158</td>
</tr>
<tr class="even">
<td align="center">1</td>
<td align="center">2018-05-31 16:37:00</td>
<td align="center">G002</td>
<td align="center">0.6640368</td>
<td align="center">0.0089164</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level2">
<h2 id="outlier-detection-for-series-of-observations">Outlier detection for series of observations<a class="anchor" aria-label="anchor" href="#outlier-detection-for-series-of-observations"></a>
</h2>
<p>After correcting the data for spatial trends, we can now check if the
data contains outliers for series of observations. We do this by
modeling each time course using a non-parametric smoothing spline with a
fixed number of knots. The estimates for the spline coefficients are
then extracted per time course (typically per plant) and correlations
between those coefficient vectors are calculated to identify outlying
time courses, <em>i.e.</em>, plants.</p>
<p>The function <code><a href="../reference/fitSpline.html">fitSpline()</a></code> fits a P-spline per plant for
the selected <code>trait</code>. The function output contains the
P-spline model coefficients and the values predicted on a dense grid
using the P-spline model coefficients.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">spatCorrectedVator</span><span class="op">)</span>  </span>
<span><span class="co"># Fit P-splines using on a subset of genotypes.</span></span>
<span><span class="va">subGenoVator</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"G160"</span>, <span class="st">"G151"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit.spline</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fitSpline.html">fitSpline</a></span><span class="op">(</span>inDat <span class="op">=</span> <span class="va">spatCorrectedVator</span>,</span>
<span>                        trait <span class="op">=</span> <span class="st">"EffpsII_corr"</span>,</span>
<span>                        genotypes <span class="op">=</span> <span class="va">subGenoVator</span>,</span>
<span>                        knots <span class="op">=</span> <span class="fl">50</span>,</span>
<span>                        useTimeNumber <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                        timeNumber <span class="op">=</span> <span class="st">"timeNumHour"</span><span class="op">)</span></span>
<span><span class="co"># Extracting the tables of predicted values and P-spline coefficients</span></span>
<span><span class="va">predDat</span> <span class="op">&lt;-</span> <span class="va">fit.spline</span><span class="op">$</span><span class="va">predDat</span></span>
<span><span class="va">coefDat</span> <span class="op">&lt;-</span> <span class="va">fit.spline</span><span class="op">$</span><span class="va">coefDat</span></span></code></pre></div>
<p>We can then visualize the P-spline predictions and first derivatives
for a subset of genotypes or for a subset of plots.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fit.spline</span>,</span>
<span>     genotypes <span class="op">=</span> <span class="st">"G160"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Overview_HTP_files/figure-html/plotSplGeno-1.png" width="672"></p>
<p>The coefficients are then used to tag suspect time courses with the
function <code><a href="../reference/detectSerieOut.html">detectSerieOut()</a></code>.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">outVator</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/detectSerieOut.html">detectSerieOut</a></span><span class="op">(</span>corrDat <span class="op">=</span> <span class="va">spatCorrectedVator</span>,</span>
<span>                           predDat <span class="op">=</span> <span class="va">predDat</span>,</span>
<span>                           coefDat <span class="op">=</span> <span class="va">coefDat</span>,</span>
<span>                           trait <span class="op">=</span> <span class="st">"EffpsII_corr"</span>,</span>
<span>                           genotypes <span class="op">=</span> <span class="va">subGenoVator</span>,</span>
<span>                           thrCor <span class="op">=</span> <span class="fl">0.9</span>,</span>
<span>                           thrPca <span class="op">=</span> <span class="fl">30</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="center">plotId</th>
<th align="center">genotype</th>
<th align="center">reason</th>
<th align="center">value</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">c21r25</td>
<td align="center">G151</td>
<td align="center">mean corr</td>
<td align="center">0.7620638</td>
</tr>
<tr class="even">
<td align="center">c21r25</td>
<td align="center">G151</td>
<td align="center">angle</td>
<td align="center">39.8776276</td>
</tr>
<tr class="odd">
<td align="center">c9r4</td>
<td align="center">G160</td>
<td align="center">mean corr</td>
<td align="center">0.6778041</td>
</tr>
<tr class="even">
<td align="center">c9r4</td>
<td align="center">G160</td>
<td align="center">angle</td>
<td align="center">47.3176970</td>
</tr>
<tr class="odd">
<td align="center">c9r4</td>
<td align="center">G160</td>
<td align="center">slope</td>
<td align="center">0.6046173</td>
</tr>
</tbody>
</table>
<p>Visualizing the results we see that for genotype G151 plant c21r25 is
tagged as outlier:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">outVator</span>, genotypes <span class="op">=</span> <span class="st">"G151"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Overview_HTP_files/figure-html/plotOutVator-1.png" width="576"></p>
<p>We can then remove the outlying plants from the data set or fitted
spline.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit.splineOut</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/removeSerieOut.html">removeSerieOut</a></span><span class="op">(</span>fitSpline <span class="op">=</span> <span class="va">fit.spline</span>,</span>
<span>                                serieOut <span class="op">=</span> <span class="va">outVator</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="modeling-the-genetic-signal">Modeling the genetic signal<a class="anchor" aria-label="anchor" href="#modeling-the-genetic-signal"></a>
</h2>
<p>This section presents the second stage of the two-stage approach
proposed by <span class="citation">Pérez-Valencia et al. (<a href="#ref-Perez2022">2022</a>)</span>. The aim is modeling the temporal
evolution of the genetic signal after a spatial correction is performed
on a phenotypic trait. Data consist of time-series (curves) of a
(possibly) spatially corrected plant/plot phenotype. We assume that data
present a hierarchical structure with plots nested in genotypes, and
genotypes nested in “populations”. To model this sample of curves an
additive decomposition of the phenotypic variation over time is
considered, and a P-spline-based three-level nested hierarchical data
model (hereafter refer as <strong>psHDM</strong>) is used.</p>
<p>To illustrate the analysis, we use the Arabidopsis data corrected for
spatial trends, <code>spatCorrectedVator</code>. For simplicity, we will
assume one population (<code>pop</code>) and two genotypes (genotypes in
<code>subGenoVator</code>). The data structure and the new “population”
variable are as follows</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">spatCorrectedVator</span><span class="op">)</span></span>
<span><span class="va">spatCorrectedVator</span><span class="op">[[</span><span class="st">"pop"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"Pop1"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">spatCorrectedVator</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/droplevels.html" class="external-link">droplevels</a></span><span class="op">(</span><span class="va">spatCorrectedVator</span><span class="op">[</span><span class="va">spatCorrectedVator</span><span class="op">$</span><span class="va">genotype</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">subGenoVator</span>,<span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'data.frame':    995 obs. of  14 variables:</span></span>
<span><span class="co">#&gt;  $ timeNumber  : int  1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;  $ timePoint   : POSIXct, format: "2018-05-31 16:37:00" "2018-05-31 16:37:00" ...</span></span>
<span><span class="co">#&gt;  $ EffpsII_corr: num  0.666 0.654 0.646 0.692 0.675 ...</span></span>
<span><span class="co">#&gt;  $ EffpsII     : num  0.663 0.655 0.655 0.706 0.672 0.649 0.692 0.67 0.714 0.674 ...</span></span>
<span><span class="co">#&gt;  $ wt          : num  36 36 36 36 36 ...</span></span>
<span><span class="co">#&gt;  $ genotype    : Factor w/ 2 levels "G151","G160": 1 1 1 1 1 1 2 2 2 2 ...</span></span>
<span><span class="co">#&gt;  $ check       : Factor w/ 1 level "noCheck": 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;  $ repId       : Factor w/ 7 levels "1","2","3","4",..: 7 2 4 6 1 3 7 4 5 2 ...</span></span>
<span><span class="co">#&gt;  $ Image_pos   : Factor w/ 9 levels "1a","1b","1c",..: 3 1 7 8 5 4 2 2 7 8 ...</span></span>
<span><span class="co">#&gt;  $ rowId       : Factor w/ 13 levels "1","4","7","11",..: 12 5 11 1 3 9 13 13 7 8 ...</span></span>
<span><span class="co">#&gt;  $ colId       : Factor w/ 11 levels "1","2","5","6",..: 9 1 4 8 2 5 10 2 11 7 ...</span></span>
<span><span class="co">#&gt;  $ plotId      : Factor w/ 14 levels "c10r29","c13r1",..: 4 6 11 2 9 12 5 8 7 1 ...</span></span>
<span><span class="co">#&gt;  $ timeNumHour : num  0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ pop         : Factor w/ 1 level "Pop1": 1 1 1 1 1 1 1 1 1 1 ...</span></span></code></pre></div>
<p>We will use the spatially corrected photosystem II efficiency
(<code>EffpsII_corr</code>) as response variable. We assume that plots
(<code>plotId</code>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi><mo>=</mo><mn>14</mn></mrow><annotation encoding="application/x-tex">M = 14</annotation></semantics></math>)
are nested in genotypes (<code>genotype</code>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mo>=</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">L = 2</annotation></semantics></math>),
and genotypes are nested in populations (<code>pop</code>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">k = 1</annotation></semantics></math>).
Furthermore, uncertainty is propagated from stage to stage using weights
(<code>wt</code>). Since we are in the context of longitudinal models,
it is natural that we use time as a covariate (i.e., the timepoints at
which the phenotype of interest was measured,
<code>timeNumber = timeNumHour</code>)</p>
<div class="section level3">
<h3 id="model-fitting">Model fitting<a class="anchor" aria-label="anchor" href="#model-fitting"></a>
</h3>
<p>To fit the <strong>psHDM</strong> model, we use the
<code><a href="../reference/fitSplineHDM.html">fitSplineHDM()</a></code> function with cubic (<code>bdeg</code>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>=</mo><mn>3</mn></mrow><annotation encoding="application/x-tex">= 3</annotation></semantics></math>)
B-spline basis functions with <code>nseg</code>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>=</mo><mn>20</mn></mrow><annotation encoding="application/x-tex">= 20</annotation></semantics></math>
segments, and second order penalties
(<code>pord</code><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>=</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">= 2</annotation></semantics></math>)
to represent functions at the three levels of the hierarchy (population,
genotype and plot).</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Fit P-spline HDM.</span></span>
<span><span class="va">fit.psHDM</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fitSplineHDM.html">fitSplineHDM</a></span><span class="op">(</span>inDat <span class="op">=</span> <span class="va">spatCorrectedVator</span>,</span>
<span>                           genotypes <span class="op">=</span> <span class="va">subGenoVator</span>,</span>
<span>                           trait <span class="op">=</span> <span class="st">"EffpsII_corr"</span>,</span>
<span>                           useTimeNumber <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                           timeNumber <span class="op">=</span> <span class="st">"timeNumHour"</span>,                           </span>
<span>                           pop <span class="op">=</span> <span class="st">"pop"</span>,</span>
<span>                           genotype <span class="op">=</span> <span class="st">"genotype"</span>,</span>
<span>                           plotId <span class="op">=</span> <span class="st">"plotId"</span>,</span>
<span>                           weights <span class="op">=</span> <span class="st">"wt"</span>,</span>
<span>                           difVar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>geno <span class="op">=</span> <span class="cn">FALSE</span>, plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>                           smoothPop <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>nseg <span class="op">=</span> <span class="fl">20</span>, bdeg <span class="op">=</span> <span class="fl">3</span>, pord <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>                           smoothGeno <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>nseg <span class="op">=</span> <span class="fl">20</span>, bdeg <span class="op">=</span> <span class="fl">3</span>, pord <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>                           smoothPlot <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>nseg <span class="op">=</span> <span class="fl">20</span>, bdeg <span class="op">=</span> <span class="fl">3</span>, pord <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>                           trace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>The resulting object, in this case <code>fit.psHDM</code>, contains
different information about the data structure, the fitting process, and
three data frames with the estimated curves at each of the three-levels
of the hierarchy (explore <code>fit.psHDM$popLevel</code>,
<code>fit.psHDM$genoLevel</code>, and <code>fit.psHDM$plotLevel</code>).
That is, it contains the estimated trajectories and deviations, as well
as their first and second-order derivatives. For a detailed description
of the returned values see <code><a href="../reference/fitSplineHDM.html">help(fitSplineHDM)</a></code>. All these
curves can be used as input to extract time‐independent parameters to
characterise genotypes (as illustrated in the final section of this
vignette).</p>
</div>
<div class="section level3">
<h3 id="model-prediction">Model prediction<a class="anchor" aria-label="anchor" href="#model-prediction"></a>
</h3>
<p>The <code><a href="../reference/predict.psHDM.html">predict.psHDM()</a></code> function can be used to obtain
predictions from a fitted <strong>psHDM</strong> model (obtained using
the <code><a href="../reference/fitSplineHDM.html">fitSplineHDM()</a></code> function; see above). In particular,
this function allows obtaining predictions (estimated curves at each
level of the hierarchy) on a dense grid of time points. Also, it allows
the calculation of standard errors. These standard errors can be used to
construct (approximate) pointwise confidence intervals for the estimated
curves.</p>
<p>In the following code, we use the <code>fit.psHDM</code> object to
make predictions at the three levels of the hierarchy
(<code>pred = list(pop = TRUE, geno = TRUE, plot = TRUE)</code>), and to
obtain standard errors at the population and genotype levels
(<code>se = list(pop = TRUE, geno = TRUE, plot = FALSE)</code>). The
original data is measured at
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>73</mn><annotation encoding="application/x-tex">73</annotation></semantics></math>
time points, but predictions are obtained at
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>100</mn><annotation encoding="application/x-tex">100</annotation></semantics></math>
time points in the same range than the original time points (argument
<code>newtimes</code>).</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Predict P-spline HDM.</span></span>
<span><span class="va">pred.psHDM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">fit.psHDM</span>,</span>
<span>                      newtimes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">fit.psHDM</span><span class="op">$</span><span class="va">time</span><span class="op">[[</span><span class="st">"timeNumber"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                                     <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">fit.psHDM</span><span class="op">$</span><span class="va">time</span><span class="op">[[</span><span class="st">"timeNumber"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                                     length.out <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>,</span>
<span>                      pred <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>pop <span class="op">=</span> <span class="cn">TRUE</span>, geno <span class="op">=</span> <span class="cn">TRUE</span>, plot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                      se <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>pop <span class="op">=</span> <span class="cn">TRUE</span>, geno <span class="op">=</span> <span class="cn">TRUE</span>, plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>                      trace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>As result, three data frames with predictions (and standard errors)
at population (<code>pred.psHDM$popLevel</code>), genotype
(<code>pred.psHDM$GenoLevel</code>) and plot
(<code>pred.psHDM$plotLevel</code>) levels are returned.</p>
</div>
<div class="section level3">
<h3 id="model-plot">Model plot<a class="anchor" aria-label="anchor" href="#model-plot"></a>
</h3>
<p>The <code><a href="../reference/plot.psHDM.html">plot.psHDM()</a></code> function plots <code>psHDM</code>
objects. We note that objects of class <code>psHDM</code> can be
obtained using both <code><a href="../reference/fitSplineHDM.html">fitSplineHDM()</a></code> and
<code><a href="../reference/predict.psHDM.html">predict.psHDM()</a></code> functions. In both cases, the resulting
object contains information about estimated trajectories, deviations and
first-order derivatives at the three levels of the hierarchy. As such,
plots of these curves can be obtained. In addition, when plots are
obtained from an object obtained using the <code><a href="../reference/predict.psHDM.html">predict.psHDM()</a></code>
function,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>95</mn><mi>%</mi></mrow><annotation encoding="application/x-tex">95\%</annotation></semantics></math>
pointwise confidence intervals are also depicted.</p>
<p>To illustrate the usage of function <code><a href="../reference/plot.psHDM.html">plot.psHDM()</a></code>, we use
here the object <code>pred.psHDM</code> obtained in the prediction
section.</p>
<ul>
<li>If <code>plotType = "popTra"</code>, the estimated population
trajectory
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>f</mi><mo accent="true">̂</mo></mover><mi>p</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\hat{f}_p(t)</annotation></semantics></math>)
is depicted and its
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>95</mn><mi>%</mi></mrow><annotation encoding="application/x-tex">95\%</annotation></semantics></math>
pointwise confidence intervals. Additionally, the grey lines represent
the observed <code>trait</code> that is used in the
<code>fitSplineHDM</code> function.</li>
</ul>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pred.psHDM</span>, plotType <span class="op">=</span> <span class="st">"popTra"</span>, themeSizeHDM <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<p><img src="Overview_HTP_files/figure-html/plotPredPopVator-1.png" width="480" style="display: block; margin: auto;"></p>
<ul>
<li>If <code>plotType = "popGenoTra"</code>, estimated population
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>f</mi><mo accent="true">̂</mo></mover><mi>p</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\hat{f}_p(t)</annotation></semantics></math>)
and genotype-especific
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>f</mi><mo accent="true">̂</mo></mover><mi>p</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><msub><mover><mi>f</mi><mo accent="true">̂</mo></mover><mrow><mi>p</mi><mi>g</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\hat{f}_p(t)+\hat{f}_{pg}(t)</annotation></semantics></math>)
trajectories are depicted for all genotypes.
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>95</mn><mi>%</mi></mrow><annotation encoding="application/x-tex">95\%</annotation></semantics></math>
pointwise confidence intervals are depicted for the population
trajectory. We let the user explore the plot for the first-order
derivative of the estimated population and genotype trajectories
(<code>plotType = "popGenoDeriv"</code>).</li>
</ul>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pred.psHDM</span>, plotType <span class="op">=</span> <span class="st">"popGenoTra"</span>, themeSizeHDM <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<p><img src="Overview_HTP_files/figure-html/plotPredGenoTraVator-1.png" width="480" style="display: block; margin: auto;"></p>
<ul>
<li>If <code>plotType = "GenoDev"</code>, estimated genotype-specific
deviations
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>f</mi><mo accent="true">̂</mo></mover><mrow><mi>p</mi><mi>g</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\hat{f}_{pg}(t)</annotation></semantics></math>)
are depicted for all genotypes.</li>
</ul>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pred.psHDM</span>, plotType <span class="op">=</span> <span class="st">"genoDev"</span>, themeSizeHDM <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<p><img src="Overview_HTP_files/figure-html/plotPredGenoDevVator-1.png" width="480" style="display: block; margin: auto;"></p>
<p>Finally, if we are interested in obtaining plots at the plot level,
we use <code>plotType = "genoPlotTra"</code>. Here, estimated genotype
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>f</mi><mo accent="true">̂</mo></mover><mi>p</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><msub><mover><mi>f</mi><mo accent="true">̂</mo></mover><mrow><mi>p</mi><mi>g</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\hat{f}_p(t)+\hat{f}_{pg}(t)</annotation></semantics></math>)
and plot-specific
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>f</mi><mo accent="true">̂</mo></mover><mi>p</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><msub><mover><mi>f</mi><mo accent="true">̂</mo></mover><mrow><mi>p</mi><mi>g</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><msub><mover><mi>f</mi><mo accent="true">̂</mo></mover><mrow><mi>p</mi><mi>g</mi><mi>i</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\hat{f}_p(t)+\hat{f}_{pg}(t)+\hat{f}_{pgi}(t)</annotation></semantics></math>)
trajectories are depicted for all plots separately for a selection of
genotypes. Also,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>95</mn><mi>%</mi></mrow><annotation encoding="application/x-tex">95\%</annotation></semantics></math>
pointwise confidence intervals are depicted for the estimated
genotype-specific trajectories.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pred.psHDM</span>, </span>
<span>     plotType <span class="op">=</span> <span class="st">"genoPlotTra"</span>, </span>
<span>     themeSizeHDM <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<p><img src="Overview_HTP_files/figure-html/plotPredPlotVator-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level2">
<h2 id="estimation-of-parameters-from-time-courses">Estimation of parameters from time courses<a class="anchor" aria-label="anchor" href="#estimation-of-parameters-from-time-courses"></a>
</h2>
<p>The final step in the HTP data analysis is extracting interesting
parameters from the modeled time courses. The parameters can then be
further analyzed, for example in a GxE analysis (see <a href="https://biometris.github.io/statgenGxE/index.html" class="external-link"><em>statgenGxE</em></a>),
or a genetic analysis (see <a href="https://biometris.github.io/statgenGWAS/index.html" class="external-link"><em>statgenGWAS</em></a>).
Note that <strong>timeMin</strong> and <strong>timeMax</strong> should
be specified at the time scale used when fitting the spline, in this
case the time number scale.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">paramVator1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimateSplineParameters.html">estimateSplineParameters</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">fit.splineOut</span>,</span>
<span>                                        estimate <span class="op">=</span> <span class="st">"predictions"</span>,</span>
<span>                                        what <span class="op">=</span> <span class="st">"AUC"</span>,</span>
<span>                                        timeMin <span class="op">=</span> <span class="fl">330</span>,</span>
<span>                                        timeMax <span class="op">=</span> <span class="fl">432</span>,</span>
<span>                                        genotypes <span class="op">=</span> <span class="va">subGenoVator</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">paramVator1</span>, plotType <span class="op">=</span> <span class="st">"box"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Overview_HTP_files/figure-html/paramVator-1.png" width="384" style="display: block; margin: auto;"></p>
<p>These parameters can also be obtained from estimated time courses
after the genetic signal is modeled with the <strong>psHDM</strong>
model. For example, we can extract the minimum spatially corrected
photosystem II efficiency (from previously estimated plot trajectories),
for two genotypes (as illustration).</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">paramVator2</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/estimateSplineParameters.html">estimateSplineParameters</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">pred.psHDM</span>,</span>
<span>                           what <span class="op">=</span> <span class="st">"min"</span>,</span>
<span>                           fitLevel <span class="op">=</span> <span class="st">"plot"</span>,</span>
<span>                           estimate <span class="op">=</span> <span class="st">"predictions"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">paramVator2</span>, plotType <span class="op">=</span> <span class="st">"box"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Overview_HTP_files/figure-html/paramPhenoGenoPred-1.png" width="384" style="display: block; margin: auto;"></p>
<hr>
<div class="section level3">
<h3 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h3>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-Gilmour2017" class="csl-entry">
Butler, D. G., B. R. Cullis, A. R. Gilmour, B. G. Gogel, and R.
Thompson. 2017. <span>“ASReml-r Reference Manual Version 4.”</span> <a href="https://vsni.co.uk/" class="external-link">https://vsni.co.uk/</a>.
</div>
<div id="ref-Cabrera2016" class="csl-entry">
Cabrera-Bosquet, Llorenç, Christian Fournier, Nicolas Brichet, Claude
Welcker, Benoît Suard, and François Tardieu. 2016.
<span>“High-Throughput Estimation of Incident Light, Light Interception
and Radiation-Use Efficiency of Thousands of Plants in a Phenotyping
Platform.”</span> <em>New Phytologist</em> 212 (1): 269–81. <a href="https://doi.org/10.1111/nph.14027" class="external-link">https://doi.org/10.1111/nph.14027</a>.
</div>
<div id="ref-vanEeuw2019" class="csl-entry">
Eeuwijk, Fred A. van, Daniela Bustos-Korts, Emilie J. Millet, Martin P.
Boer, Willem Kruijer, Addie Thompson, Marcos Malosetti, et al. 2019.
<span>“Modelling Strategies for Assessing and Increasing the
Effectiveness of New Phenotyping Techniques in Plant Breeding.”</span>
<em>Plant Science</em> 282 (May): 23–39. <a href="https://doi.org/10.1016/j.plantsci.2018.06.018" class="external-link">https://doi.org/10.1016/j.plantsci.2018.06.018</a>.
</div>
<div id="ref-Flood2016" class="csl-entry">
Flood, Pádraic J., Willem Kruijer, Sabine K. Schnabel, Rob van der
Schoor, Henk Jalink, Jan F. H. Snel, Jeremy Harbinson, and Mark G. M.
Aarts. 2016. <span>“Phenomics for Photosynthesis, Growth and Reflectance
in <span>Arabidopsis</span> Thaliana Reveals Circadian and Long-Term
Fluctuations in Heritability.”</span> <em>Plant Methods</em> 12 (1): 14.
<a href="https://doi.org/10.1186/s13007-016-0113-y" class="external-link">https://doi.org/10.1186/s13007-016-0113-y</a>.
</div>
<div id="ref-Lee2013" class="csl-entry">
Lee, Dae-Jin, María Durbán, and Paul Eilers. 2013. <span>“Efficient
Two-Dimensional Smoothing with p-Spline ANOVA Mixed Models and Nested
Bases.”</span> <em>Computational Statistics <span>&amp;</span> Data
Analysis</em> 61 (May): 22–37. <a href="https://doi.org/10.1016/j.csda.2012.11.013" class="external-link">https://doi.org/10.1016/j.csda.2012.11.013</a>.
</div>
<div id="ref-Perez2022" class="csl-entry">
Pérez-Valencia, Diana M, María Xosé Rodríguez-Álvarez, Martin P Boer,
Lukas Kronenberg, Andreas Hund, Llorenç Cabrera-Bosquet, Emilie J
Millet, and Fred A van Eeuwijk. 2022. <span>“A Two-Stage Approach for
the Spatio-Temporal Analysis of High-Throughput Phenotyping
Data.”</span> <em>Scientific Reports</em> 12 (1): 1–16. <a href="https://doi.org/10.1038/s41598-022-06935-9" class="external-link">https://doi.org/10.1038/s41598-022-06935-9</a>.
</div>
<div id="ref-RodAlv2018" class="csl-entry">
Rodríguez-Álvarez, María, Martin P. Boer, Fred van Eeuwijk, and Paul H.
C. Eilers. 2018. <span>“Correcting for Spatial Heterogeneity in Plant
Breeding Experiments with p-Splines.”</span> <em>Spatial Statistics</em>
23 (October): 52–71. <a href="https://doi.org/10.1016/j.spasta.2017.10.003" class="external-link">https://doi.org/10.1016/j.spasta.2017.10.003</a>.
</div>
<div id="ref-vanRooi2017" class="csl-entry">
Rooijen, Roxanne van, Willem Kruijer, René Boesten, Fred A. van Eeuwijk,
Jeremy Harbinson, and Mark G. M. Aarts. 2017. <span>“Natural Variation
of <span>YELLOW</span> <span>SEEDLING</span>1 Affects Photosynthetic
Acclimation of <span>Arabidopsis</span> Thaliana.”</span> <em>Nature
Communications</em> 8 (1). <a href="https://doi.org/10.1038/s41467-017-01576-3" class="external-link">https://doi.org/10.1038/s41467-017-01576-3</a>.
</div>
<div id="ref-Tardieu2017" class="csl-entry">
Tardieu, François, Llorenç Cabrera-Bosquet, Tony Pridmore, and Malcolm
Bennett. 2017. <span>“Plant <span>Phenomics</span>, <span>From</span>
<span>Sensors</span> to <span>Knowledge</span>.”</span> <em>Current
Biology</em> 27 (15): R770–83. <a href="https://doi.org/10.1016/j.cub.2017.05.055" class="external-link">https://doi.org/10.1016/j.cub.2017.05.055</a>.
</div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Emilie J Millet, Maria Xose Rodriguez Alvarez, Diana Marcela Perez Valencia, Isabelle Sanchez, Nadine Hilgert, Bart-Jan van Rossum, Fred van Eeuwijk, Martin Boer.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
