<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Fit P-Spline Hierarchical Curve Data Models — fitSplineHDM • statgenHTP</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Fit P-Spline Hierarchical Curve Data Models — fitSplineHDM"><meta name="description" content="Fit the P-spline Hierarchical Curve Data Model used in the second stage of
the two-stage approach proposed by Pérez-Valencia et al. (2022). This model
assumes a three-level hierarchical structure in the data, with plants nested
in genotypes, genotypes nested in populations. The input for this function
is the spatially corrected data, as obtained from the first stage of the
approach (see fitModels and getCorrected).
The number of segments is chosen by the user, as well as the B-spline degree,
and the penalty order for the three-levels of the hierarchy. The user can
also decide if different variances for random effects at genotype (separately
for each population) and plant (separately for each genotype) levels are
desired. The function outputs are estimated curves (time series of trajectories
and deviations) and their first and second derivatives for the three-levels
of the hierarchy. The outputs can then be used to estimate relevant parameters
from the curves for further analysis (see estimateSplineParameters)."><meta property="og:description" content="Fit the P-spline Hierarchical Curve Data Model used in the second stage of
the two-stage approach proposed by Pérez-Valencia et al. (2022). This model
assumes a three-level hierarchical structure in the data, with plants nested
in genotypes, genotypes nested in populations. The input for this function
is the spatially corrected data, as obtained from the first stage of the
approach (see fitModels and getCorrected).
The number of segments is chosen by the user, as well as the B-spline degree,
and the penalty order for the three-levels of the hierarchy. The user can
also decide if different variances for random effects at genotype (separately
for each population) and plant (separately for each genotype) levels are
desired. The function outputs are estimated curves (time series of trajectories
and deviations) and their first and second derivatives for the three-levels
of the hierarchy. The outputs can then be used to estimate relevant parameters
from the curves for further analysis (see estimateSplineParameters)."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">statgenHTP</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.7</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fa-home"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../articles/index.html">Vignettes</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="nav-link" href="../news/index.html"><span class="fa fa-newspaper-o"></span> news</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html"><span class="fa fa-file-code-o"></span> functions</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-other-packages" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true"><span class="fa fa-seedling"></span> other packages</button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-other-packages"><li><a class="external-link dropdown-item" href="https://biometris.github.io/statgenSTA">statgenSTA</a></li>
    <li><a class="external-link dropdown-item" href="https://biometris.github.io/statgenGxE">statgenGxE</a></li>
    <li><a class="external-link dropdown-item" href="https://biometris.github.io/statgenGWAS">statgenGWAS</a></li>
    <li><a class="external-link dropdown-item" href="https://biometris.github.io/statgenQTLxT">statgenQTLxT</a></li>
    <li><a class="external-link dropdown-item" href="https://biometris.github.io/statgenIBD">statgenIBD</a></li>
    <li><a class="external-link dropdown-item" href="https://biometris.github.io/statgenMPP">statgenMPP</a></li>
    <li><a class="external-link dropdown-item" href="https://biometris.github.io/LMMsolver">LMMsolver</a></li>
  </ul></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Biometris/statgenHTP"><span class="fa fa-github fa-lg fab"></span> github</a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Fit P-Spline Hierarchical Curve Data Models</h1>
      <small class="dont-index">Source: <a href="https://github.com/Biometris/statgenHTP/blob/main/R/fitSplineHDM.R" class="external-link"><code>R/fitSplineHDM.R</code></a></small>
      <div class="d-none name"><code>fitSplineHDM.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Fit the P-spline Hierarchical Curve Data Model used in the second stage of
the two-stage approach proposed by Pérez-Valencia et al. (2022). This model
assumes a three-level hierarchical structure in the data, with plants nested
in genotypes, genotypes nested in populations. The input for this function
is the spatially corrected data, as obtained from the first stage of the
approach (see <code><a href="fitModels.html">fitModels</a></code> and <code><a href="getCorrected.html">getCorrected</a></code>).
The number of segments is chosen by the user, as well as the B-spline degree,
and the penalty order for the three-levels of the hierarchy. The user can
also decide if different variances for random effects at genotype (separately
for each population) and plant (separately for each genotype) levels are
desired. The function outputs are estimated curves (time series of trajectories
and deviations) and their first and second derivatives for the three-levels
of the hierarchy. The outputs can then be used to estimate relevant parameters
from the curves for further analysis (see <code><a href="estimateSplineParameters.html">estimateSplineParameters</a></code>).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">fitSplineHDM</span><span class="op">(</span></span>
<span>  <span class="va">inDat</span>,</span>
<span>  genotypes <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  plotIds <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">trait</span>,</span>
<span>  useTimeNumber <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  timeNumber <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  pop <span class="op">=</span> <span class="st">"pop"</span>,</span>
<span>  genotype <span class="op">=</span> <span class="st">"genotype"</span>,</span>
<span>  plotId <span class="op">=</span> <span class="st">"plotId"</span>,</span>
<span>  weights <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  difVar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>geno <span class="op">=</span> <span class="cn">FALSE</span>, plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>  smoothPop <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>nseg <span class="op">=</span> <span class="fl">10</span>, bdeg <span class="op">=</span> <span class="fl">3</span>, pord <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>  smoothGeno <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>nseg <span class="op">=</span> <span class="fl">10</span>, bdeg <span class="op">=</span> <span class="fl">3</span>, pord <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>  smoothPlot <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>nseg <span class="op">=</span> <span class="fl">10</span>, bdeg <span class="op">=</span> <span class="fl">3</span>, pord <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>  offset <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">gaussian</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  maxit <span class="op">=</span> <span class="fl">200</span>,</span>
<span>  trace <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  thr <span class="op">=</span> <span class="fl">0.001</span>,</span>
<span>  minNoTP <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-indat">inDat<a class="anchor" aria-label="anchor" href="#arg-indat"></a></dt>
<dd><p>A data.frame with corrected spatial data.</p></dd>


<dt id="arg-genotypes">genotypes<a class="anchor" aria-label="anchor" href="#arg-genotypes"></a></dt>
<dd><p>A character vector indicating the genotypes for which
hierarchical models should be fitted. If <code>NULL</code>, splines will be fitted
for all genotypes.</p></dd>


<dt id="arg-plotids">plotIds<a class="anchor" aria-label="anchor" href="#arg-plotids"></a></dt>
<dd><p>A character vector indicating the plotIds for which
hierarchical models should be fitted. If <code>NULL</code>, splines will be
fitted for all plotIds.</p></dd>


<dt id="arg-trait">trait<a class="anchor" aria-label="anchor" href="#arg-trait"></a></dt>
<dd><p>A character string indicating the trait for which the spline
should be fitted.</p></dd>


<dt id="arg-usetimenumber">useTimeNumber<a class="anchor" aria-label="anchor" href="#arg-usetimenumber"></a></dt>
<dd><p>Should the timeNumber be used instead of the timePoint?.
If <code>useTimeNumber = FALSE</code>, inDat should contain a column called timePoint
of class <code>POSIXct</code>.</p></dd>


<dt id="arg-timenumber">timeNumber<a class="anchor" aria-label="anchor" href="#arg-timenumber"></a></dt>
<dd><p>If <code>useTimeNumber = TRUE</code>, a character vector
indicating the column containing the numerical time to use.</p></dd>


<dt id="arg-pop">pop<a class="anchor" aria-label="anchor" href="#arg-pop"></a></dt>
<dd><p>A character string indicating the the populations to which each
genotype/variety belongs. This variable must be a factor in the data frame.</p></dd>


<dt id="arg-genotype">genotype<a class="anchor" aria-label="anchor" href="#arg-genotype"></a></dt>
<dd><p>A character string indicating the populations to which each
genotype/variety belongs. This variable must be a factor in the data frame.</p></dd>


<dt id="arg-plotid">plotId<a class="anchor" aria-label="anchor" href="#arg-plotid"></a></dt>
<dd><p>A character string indicating the genotypes/varieties to which
each plant/plot/individual belongs. This variable must be a factor in the
data frame.</p></dd>


<dt id="arg-weights">weights<a class="anchor" aria-label="anchor" href="#arg-weights"></a></dt>
<dd><p>A character string indicating the column in the data containing
the weights to be used in the fitting process (for error propagation from
first stage to second stage). By default, when <code>weights = NULL</code>, the
weights are considered to be one.</p></dd>


<dt id="arg-difvar">difVar<a class="anchor" aria-label="anchor" href="#arg-difvar"></a></dt>
<dd><p>Should different variances for random effects at genotype
(separately for each population) and plant level (separately for each
genotype) be considered?.</p></dd>


<dt id="arg-smoothpop">smoothPop<a class="anchor" aria-label="anchor" href="#arg-smoothpop"></a></dt>
<dd><p>A list specifying the P-Spline model at the population
level (nseg: number of segments; bdeg: degree of the B-spline basis; pord:
penalty order).</p></dd>


<dt id="arg-smoothgeno">smoothGeno<a class="anchor" aria-label="anchor" href="#arg-smoothgeno"></a></dt>
<dd><p>A list specifying the P-Spline model at the genotype
level.</p></dd>


<dt id="arg-smoothplot">smoothPlot<a class="anchor" aria-label="anchor" href="#arg-smoothplot"></a></dt>
<dd><p>A list specifying the P-Spline model at the plant level.</p></dd>


<dt id="arg-offset">offset<a class="anchor" aria-label="anchor" href="#arg-offset"></a></dt>
<dd><p>A character string indicating the column in the data with
an a priori known component to be included in the linear predictor during
fitting. By default, when <code>offset = NULL</code>, the offset is considered to
be zero.</p></dd>


<dt id="arg-family">family<a class="anchor" aria-label="anchor" href="#arg-family"></a></dt>
<dd><p>An object of class <code>family</code> specifying the distribution
and link function. The default is <code><a href="https://rdrr.io/r/stats/family.html" class="external-link">gaussian()</a></code>.</p></dd>


<dt id="arg-maxit">maxit<a class="anchor" aria-label="anchor" href="#arg-maxit"></a></dt>
<dd><p>An optional value that controls the maximum number of iterations
of the algorithm. The default is 200.</p></dd>


<dt id="arg-trace">trace<a class="anchor" aria-label="anchor" href="#arg-trace"></a></dt>
<dd><p>An optional value that controls the function trace.
The default is <code>TRUE</code>.</p></dd>


<dt id="arg-thr">thr<a class="anchor" aria-label="anchor" href="#arg-thr"></a></dt>
<dd><p>An optional value that controls the convergence threshold of the
algorithm. The default is 1.e-03.</p></dd>


<dt id="arg-minnotp">minNoTP<a class="anchor" aria-label="anchor" href="#arg-minnotp"></a></dt>
<dd><p>The minimum number of time points for which data should be
available for a plant. Defaults to 60% of all time points present in the
TP object. No splines are fitted for plants with less than the minimum number
of timepoints.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>An object of class <code>psHDM</code>, a list with the following outputs:
<code>time</code>, a numeric vector with the timepoints.
<code>popLevs</code>, a data.frame with the names of the populations
<code>genoLevs</code>, a factor with the names of the genotypes.
<code>plotLevs</code>, a factor with the names of the plants
<code>nPlotPop</code>, a numeric vector with the number of plants per
population.
<code>nGenoPop</code>, a numeric vector with the number of genotypes per
population.
<code>nPlotGeno</code>, a numeric vector with the number of plants per
genotype.
<code>MM</code>, a list with the design matrices at plant, genotype and
population levels.
<code>ed</code>, a numeric vector with the estimated effective dimension
(or effective degrees of freedom) for each random component of the
model (intercept, slope and non-linear trend) at each level of the
hierarchy (population, genotype and plant)
<code>tot_ed</code>, a numeric value with the sum of the effective
dimensions for all components of the model.
<code>vc</code>, a numeric vector with the (REML) variance component
estimates for each random component of the model (intercept,
slope and non-linear trend) at each level of the hierarchy
(population, genotype and plant)
<code>phi</code>, a numeric value with the error variance estimate.
<code>coeff</code>, a numeric vector with the estimated fixed and random
effect coefficients.
<code>popLevel</code>, a data.frame with the estimated population trajectories
and first and second order derivatives.
<code>genoLevel</code>, a data.frame with the estimated genotype-specific
deviations and trajectories, and their respective first and second
order derivatives.
<code>plotLevel</code>, a data.frame with the estimated plant-specific
deviations and trajectories, and their respective first and second
order derivatives.
<code>deviance</code>, the (REML) deviance at convergence.
<code>convergence</code>, a logical value indicating whether the algorithm
managed to converge before the given number of iterations.
<code>dim</code>, a numeric vector with the (model) dimension of each
model component (fixed and/or random) at each level of the
hierarchy (population, genotype, and plant).
These values correspond to the number of parameters to be estimated.
<code>family</code>, an object of class family specifying the distribution
and link function.
<code>cholHn</code>, the inverse of the variance-covariance matrix for the
coefficients.
<code>smooth</code>, a list with the information about number of segments
(nseg), degree of the B-spline basis (bdeg) and penalty order (pord)
used for the three levels of the hierarchy.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Pérez-Valencia, D.M., Rodríguez-Álvarez, M.X., Boer, M.P. et al.
A two-stage approach for the spatio-temporal analysis of high-throughput
phenotyping data. Sci Rep 12, 3177 (2022). <a href="https://doi.org/10.1038/s41598-022-06935-9" class="external-link">doi:10.1038/s41598-022-06935-9</a></p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Other functions for fitting hierarchical curve data models:
<code><a href="plot.psHDM.html">plot.psHDM</a>()</code>,
<code><a href="predict.psHDM.html">predict.psHDM</a>()</code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">## The data from the Phenovator platform have been corrected for spatial</span></span></span>
<span class="r-in"><span><span class="co">## trends and outliers for single observations have been removed.</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">spatCorrectedArch</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   timeNumber  timePoint LeafArea_corr    LeafArea       wt genotype geno.decomp</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1          1 2017-04-13   0.002564006 0.002871676 2262.277  GenoA01   WD_Panel1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2          1 2017-04-13   0.002395392 0.002515396 2262.277  GenoA01   WD_Panel1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3          1 2017-04-13   0.003210178 0.003377735 2262.277  GenoA01   WD_Panel1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4          1 2017-04-13   0.003028267 0.003256119 2262.277  GenoA01   WD_Panel1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5          1 2017-04-13   0.002689516 0.002489031 2262.277  GenoA01   WD_Panel1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6          1 2017-04-13   0.002810055 0.002677329 2262.614  GenoA02   WD_Panel1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   rowId colId plotId</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1     2    16  c16r2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2     3    28  c28r3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3    26    24 c24r26</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4    24    20 c20r24</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5    56    21 c21r56</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6    38    16 c16r38</span>
<span class="r-in"><span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">spatCorrectedArch</span>,</span></span>
<span class="r-in"><span>                <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span> <span class="va">timeNumber</span>, y <span class="op">=</span> <span class="va">LeafArea_corr</span>, group <span class="op">=</span> <span class="va">plotId</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="op">~</span><span class="va">geno.decomp</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="fitSplineHDM-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## We need to specify the genotype-by-treatment interaction.</span></span></span>
<span class="r-in"><span><span class="co">## Treatment: water regime (WW, WD).</span></span></span>
<span class="r-in"><span><span class="va">spatCorrectedArch</span><span class="op">[[</span><span class="st">"treat"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">spatCorrectedArch</span><span class="op">[[</span><span class="st">"geno.decomp"</span><span class="op">]</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>                                      start <span class="op">=</span> <span class="fl">1</span>, stop <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">spatCorrectedArch</span><span class="op">[[</span><span class="st">"genoTreat"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">spatCorrectedArch</span><span class="op">[[</span><span class="st">"genotype"</span><span class="op">]</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>             <span class="va">spatCorrectedArch</span><span class="op">[[</span><span class="st">"treat"</span><span class="op">]</span><span class="op">]</span>, sep <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Fit P-Splines Hierarchical Curve Data Model for selection of genotypes.</span></span></span>
<span class="r-in"><span><span class="va">fit.psHDM</span>  <span class="op">&lt;-</span> <span class="fu">fitSplineHDM</span><span class="op">(</span>inDat <span class="op">=</span> <span class="va">spatCorrectedArch</span>,</span></span>
<span class="r-in"><span>                          trait <span class="op">=</span> <span class="st">"LeafArea_corr"</span>,</span></span>
<span class="r-in"><span>                          useTimeNumber <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>                          timeNumber <span class="op">=</span> <span class="st">"timeNumber"</span>,</span></span>
<span class="r-in"><span>                          genotypes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"GenoA14_WD"</span>, <span class="st">"GenoA51_WD"</span>,</span></span>
<span class="r-in"><span>                                       <span class="st">"GenoB11_WW"</span>, <span class="st">"GenoB02_WD"</span>,</span></span>
<span class="r-in"><span>                                       <span class="st">"GenoB02_WW"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                          pop <span class="op">=</span> <span class="st">"geno.decomp"</span>,</span></span>
<span class="r-in"><span>                          genotype <span class="op">=</span> <span class="st">"genoTreat"</span>,</span></span>
<span class="r-in"><span>                          plotId <span class="op">=</span> <span class="st">"plotId"</span>,</span></span>
<span class="r-in"><span>                          weights <span class="op">=</span> <span class="st">"wt"</span>,</span></span>
<span class="r-in"><span>                          difVar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>geno <span class="op">=</span> <span class="cn">FALSE</span>, plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                          smoothPop <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>nseg <span class="op">=</span> <span class="fl">4</span>, bdeg <span class="op">=</span> <span class="fl">3</span>, pord <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                          smoothGeno <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>nseg <span class="op">=</span> <span class="fl">4</span>, bdeg <span class="op">=</span> <span class="fl">3</span>, pord <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                          smoothPlot <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>nseg <span class="op">=</span> <span class="fl">4</span>, bdeg <span class="op">=</span> <span class="fl">3</span>, pord <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                          trace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Visualize the data.frames with predicted values at the three levels of</span></span></span>
<span class="r-in"><span><span class="co">## the hierarchy.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Population level</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">fit.psHDM</span><span class="op">$</span><span class="va">popLevel</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   timeNumber  timePoint       pop        fPop  fPopDeriv1    fPopDeriv2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1          1 2017-04-13 WD_Panel1 0.002463487 0.001279128 -5.201063e-05</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2          2 2017-04-14 WD_Panel1 0.003738644 0.001293221  8.019776e-05</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3          3 2017-04-15 WD_Panel1 0.005093999 0.001439523  2.124061e-04</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4          4 2017-04-16 WD_Panel1 0.006661760 0.001718034  3.446145e-04</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5          5 2017-04-17 WD_Panel1 0.008574135 0.002128752  4.768229e-04</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6          6 2017-04-18 WD_Panel1 0.010963334 0.002671679  6.090313e-04</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Genotype level</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">fit.psHDM</span><span class="op">$</span><span class="va">genoLevel</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   timeNumber  timePoint       pop   genotype       fGeno fGenoDeriv1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1          1 2017-04-13 WD_Panel1 GenoA14_WD 0.002075685 0.001195395</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2          2 2017-04-14 WD_Panel1 GenoA14_WD 0.003239685 0.001155231</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3          3 2017-04-15 WD_Panel1 GenoA14_WD 0.004431400 0.001250825</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4          4 2017-04-16 WD_Panel1 GenoA14_WD 0.005786587 0.001482175</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5          5 2017-04-17 WD_Panel1 GenoA14_WD 0.007441002 0.001849282</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6          6 2017-04-18 WD_Panel1 GenoA14_WD 0.009530403 0.002352147</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     fGenoDeriv2      fGenoDev fGenoDevDeriv1 fGenoDevDeriv2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 -1.080422e-04 -0.0003878021  -8.373266e-05  -5.603156e-05</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2  2.771481e-05 -0.0004989591  -1.379899e-04  -5.248295e-05</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3  1.634718e-04 -0.0006625990  -1.886986e-04  -4.893433e-05</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4  2.992288e-04 -0.0008751733  -2.358586e-04  -4.538572e-05</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5  4.349858e-04 -0.0011331333  -2.794700e-04  -4.183711e-05</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6  5.707428e-04 -0.0014329305  -3.195328e-04  -3.828850e-05</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Plot level</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">fit.psHDM</span><span class="op">$</span><span class="va">plotLevel</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   timeNumber  timePoint       pop   genotype plotId       fPlot fPlotDeriv1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1          1 2017-04-13 WD_Panel1 GenoA14_WD c12r19 0.001584312 0.001503451</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2          2 2017-04-14 WD_Panel1 GenoA14_WD c12r19 0.003010985 0.001373428</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3          3 2017-04-15 WD_Panel1 GenoA14_WD c12r19 0.004378235 0.001384605</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4          4 2017-04-16 WD_Panel1 GenoA14_WD c12r19 0.005827262 0.001536982</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5          5 2017-04-17 WD_Panel1 GenoA14_WD c12r19 0.007499265 0.001830558</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6          6 2017-04-18 WD_Panel1 GenoA14_WD c12r19 0.009535444 0.002265334</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     fPlotDeriv2      fPlotDev fPlotDevDeriv1 fPlotDevDeriv2     obsPlot</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 -0.0002006230 -4.913732e-04   3.080565e-04  -9.258081e-05          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 -0.0000594232 -2.287000e-04   2.181971e-04  -8.713801e-05 0.003152152</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3  0.0000817766 -5.316485e-05   1.337804e-04  -8.169521e-05 0.004326641</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4  0.0002229764  4.067512e-05   5.480663e-05  -7.625242e-05          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5  0.0003641762  5.826267e-05  -1.872439e-05  -7.080962e-05 0.007478926</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6  0.0005053760  5.040608e-06  -8.681261e-05  -6.536682e-05 0.009495492</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Emilie J Millet, Maria Xose Rodriguez Alvarez, Diana Marcela Perez Valencia, Isabelle Sanchez, Nadine Hilgert, Bart-Jan van Rossum, Fred van Eeuwijk, Martin Boer.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

