<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Fit spatial models per time point — fitModels • statgenHTP</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Fit spatial models per time point — fitModels"><meta name="description" content="Perform REML analysis at each time point using either SpATS or asreml. The
idea is to is to accurately separate the genetic effects from the spatial
effects at each time point. SpATS is used as a default method. See details
for the exact models fitted."><meta property="og:description" content="Perform REML analysis at each time point using either SpATS or asreml. The
idea is to is to accurately separate the genetic effects from the spatial
effects at each time point. SpATS is used as a default method. See details
for the exact models fitted."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">statgenHTP</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.8</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../index.html" aria-label="home"><span class="fa fa-home"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../articles/index.html">Vignettes</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="nav-link" href="../news/index.html"><span class="fa fa-newspaper-o"></span> news</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html"><span class="fa fa-file-code-o"></span> functions</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-other-packages" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true"><span class="fa fa-seedling"></span> other packages</button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-other-packages"><li><a class="external-link dropdown-item" href="https://biometris.github.io/statgenSTA">statgenSTA</a></li>
    <li><a class="external-link dropdown-item" href="https://biometris.github.io/statgenGxE">statgenGxE</a></li>
    <li><a class="external-link dropdown-item" href="https://biometris.github.io/statgenGWAS">statgenGWAS</a></li>
    <li><a class="external-link dropdown-item" href="https://biometris.github.io/statgenQTLxT">statgenQTLxT</a></li>
    <li><a class="external-link dropdown-item" href="https://biometris.github.io/statgenIBD">statgenIBD</a></li>
    <li><a class="external-link dropdown-item" href="https://biometris.github.io/statgenMPP">statgenMPP</a></li>
    <li><a class="external-link dropdown-item" href="https://biometris.github.io/LMMsolver">LMMsolver</a></li>
  </ul></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Biometris/statgenHTP"><span class="fa fa-github fa-lg fab"></span> github</a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Fit spatial models per time point</h1>
      <small class="dont-index">Source: <a href="https://github.com/Biometris/statgenHTP/blob/main/R/fitModels.R" class="external-link"><code>R/fitModels.R</code></a></small>
      <div class="d-none name"><code>fitModels.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Perform REML analysis at each time point using either SpATS or asreml. The
idea is to is to accurately separate the genetic effects from the spatial
effects at each time point. SpATS is used as a default method. See details
for the exact models fitted.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">fitModels</span><span class="op">(</span></span>
<span>  <span class="va">TP</span>,</span>
<span>  <span class="va">trait</span>,</span>
<span>  timePoints <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">TP</span><span class="op">)</span>,</span>
<span>  extraFixedFactors <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  geno.decomp <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  what <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"random"</span>, <span class="st">"fixed"</span><span class="op">)</span>,</span>
<span>  useCheck <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  useRepId <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  engine <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SpATS"</span>, <span class="st">"asreml"</span><span class="op">)</span>,</span>
<span>  spatial <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-tp">TP<a class="anchor" aria-label="anchor" href="#arg-tp"></a></dt>
<dd><p>An object of class <code>TP</code>.</p></dd>


<dt id="arg-trait">trait<a class="anchor" aria-label="anchor" href="#arg-trait"></a></dt>
<dd><p>A character string indicating the trait used as response
variable in the model.</p></dd>


<dt id="arg-timepoints">timePoints<a class="anchor" aria-label="anchor" href="#arg-timepoints"></a></dt>
<dd><p>A character or numeric vector indicating the time points
to be modeled. When using a character string to reference a time point, the
value has to be an exact match to one of the existing time points. When using
a number it will be matched by its number ("timeNumber") in the timePoints
attribute of the <code>TP</code> object.</p></dd>


<dt id="arg-extrafixedfactors">extraFixedFactors<a class="anchor" aria-label="anchor" href="#arg-extrafixedfactors"></a></dt>
<dd><p>A character vector indicating the variables to use
as extra fixed effects in the model.</p></dd>


<dt id="arg-geno-decomp">geno.decomp<a class="anchor" aria-label="anchor" href="#arg-geno-decomp"></a></dt>
<dd><p>A character vector indicating the variables to use to
group the genotypic variance in the model.</p></dd>


<dt id="arg-what">what<a class="anchor" aria-label="anchor" href="#arg-what"></a></dt>
<dd><p>A character vector specifying whether "genotype" should
be fitted as "random" or "fixed" effect. Note that when using
<code>geno.decomp</code>, fitting a model with genotype as "fixed" effect is not
possible.</p></dd>


<dt id="arg-usecheck">useCheck<a class="anchor" aria-label="anchor" href="#arg-usecheck"></a></dt>
<dd><p>Should check genotypes be used as an extra factor in the
model?</p></dd>


<dt id="arg-userepid">useRepId<a class="anchor" aria-label="anchor" href="#arg-userepid"></a></dt>
<dd><p>Should repId be used as a fixed effect in the model? When
fitting a spatial model rowId and colId are also nested within repId in the
random part of the model.</p></dd>


<dt id="arg-engine">engine<a class="anchor" aria-label="anchor" href="#arg-engine"></a></dt>
<dd><p>A character string indicating the engine used to fit the
models.</p></dd>


<dt id="arg-spatial">spatial<a class="anchor" aria-label="anchor" href="#arg-spatial"></a></dt>
<dd><p>Should a spatial model be fitted for asreml?</p></dd>


<dt id="arg-quiet">quiet<a class="anchor" aria-label="anchor" href="#arg-quiet"></a></dt>
<dd><p>Should printed progress messages be suppressed?</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>An object of class <code>fitMod</code>, a list of fitted models.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The actual model fitted depends on the function parameters specified. The
basic model is the following:<br>
trait = <strong>genotype</strong> + e<br>
In case <code>useCheck = TRUE</code>, instead of genotype, genoCheck is used as
genotype and check is used as an extra fixed effect. So then the model
becomes:<br>
trait = <em>check</em> + <strong>genoCheck</strong> + e<br>
Variables in <code>extraFixedFactors</code> are fitted as extra fixed
effects.<br><br>
When <code>SpATS</code> is used for modeling, an extra spatial term is always
included in the model. This term is constructed using the function
<code><a href="https://rdrr.io/pkg/SpATS/man/PSANOVA.html" class="external-link">PSANOVA</a></code> from the SpATS package as<br><code>PSANOVA(colNum, rowNum, nseg = nSeg, nest.div = 2)</code>
where<br><code>nSeg = c(number of columns, number of rows)</code>.<br><br>
When <code>asreml</code> is used for modeling and <code>spatial = TRUE</code>,
four models are fitted with different covariance structures.
The best model is determined based on a goodness-of-fit criterion, AIC,
on 20% of the time points or at least 10 time points. The best model is then
run on all time points.
The following combinations of random and spatial terms are fitted</p><ul><li><p>random = repId:rowId + repId:colId, spatial = NULL</p></li>
<li><p>random = repId:rowId + repId:colId, spatial = ar1(rowId):colId</p></li>
<li><p>random = repId:colId + repId:colId, spatial = rowId:ar1(colId)</p></li>
<li><p>random = repId:rowId + repId:colId, spatial = ar1(rowId):ar1(colId)</p></li>
</ul><p>If there are no replicates in the model, repId is left out from the random
parts above.<br><br>
When <code>geno.decomp</code> is specified, the genotypic variance is decomposed
following the variable(s) chosen. For example, when a treatment is used in
<code>geno.decomp</code>, the initial model becomes:<br>
trait = <em>treatment</em> + <strong>treatment:genotype</strong> + e<br></p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Maria Xose Rodriguez-Alvarez, Martin P. Boer, Fred A. van Eeuwijk, Paul H.C.
Eilers (2017). Correcting for spatial heterogeneity in plant breeding
experiments with P-splines. Spatial Statistics
<a href="https://doi.org/10.1016/j.spasta.2017.10.003" class="external-link">doi:10.1016/j.spasta.2017.10.003</a>

Butler, D. G., et al. (2018). ASReml-R Reference Manual Version 4. VSN
International Ltd, http://asreml.org</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Other functions for spatial modeling:
<code><a href="getCorrected.html">getCorrected</a>()</code>,
<code><a href="getEffDims.html">getEffDims</a>()</code>,
<code><a href="getGenoPred.html">getGenoPred</a>()</code>,
<code><a href="getHerit.html">getHerit</a>()</code>,
<code><a href="getVar.html">getVar</a>()</code>,
<code><a href="plot.fitMod.html">plot.fitMod</a>()</code>,
<code><a href="summary.fitMod.html">summary.fitMod</a>()</code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">## Using the first example dataset (PhenovatorDat1):</span></span></span>
<span class="r-in"><span><span class="co">## Fit a model using SpATS on few time points:</span></span></span>
<span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="co">## Create an object of class TP.</span></span></span>
<span class="r-in"><span><span class="va">phenoTP</span> <span class="op">&lt;-</span> <span class="fu"><a href="createTimePoints.html">createTimePoints</a></span><span class="op">(</span>dat <span class="op">=</span> <span class="va">PhenovatorDat1</span>,</span></span>
<span class="r-in"><span>                            experimentName <span class="op">=</span> <span class="st">"Phenovator"</span>,</span></span>
<span class="r-in"><span>                            genotype <span class="op">=</span> <span class="st">"Genotype"</span>,</span></span>
<span class="r-in"><span>                            timePoint <span class="op">=</span> <span class="st">"timepoints"</span>,</span></span>
<span class="r-in"><span>                            repId <span class="op">=</span> <span class="st">"Replicate"</span>,</span></span>
<span class="r-in"><span>                            plotId <span class="op">=</span> <span class="st">"pos"</span>,</span></span>
<span class="r-in"><span>                            rowNum <span class="op">=</span> <span class="st">"y"</span>, colNum <span class="op">=</span> <span class="st">"x"</span>,</span></span>
<span class="r-in"><span>                            addCheck <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>                            checkGenotypes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"check1"</span>, <span class="st">"check2"</span>,</span></span>
<span class="r-in"><span>                                               <span class="st">"check3"</span>, <span class="st">"check4"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>The following plotIds have observations for less than 50% of the time points:</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> c24r41, c7r18, c7r49</span>
<span class="r-in"><span><span class="co">## Fit a model with SpATS for three time points.</span></span></span>
<span class="r-in"><span><span class="va">modPhenoSp</span> <span class="op">&lt;-</span> <span class="fu">fitModels</span><span class="op">(</span>TP <span class="op">=</span> <span class="va">phenoTP</span>,</span></span>
<span class="r-in"><span>                        trait <span class="op">=</span> <span class="st">"EffpsII"</span>,</span></span>
<span class="r-in"><span>                        timePoints <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">6</span>, <span class="fl">20</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 2018-06-01 11:37:00</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 2018-06-02 09:07:00</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 2018-06-05 14:37:00</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">modPhenoSp</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Models in modPhenoSp where fitted for experiment Phenovator.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> It contains 3 time points.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> The models were fitted using SpATS.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Fit a model with SpATS for a single time point with extra fixed factors</span></span></span>
<span class="r-in"><span><span class="co">## and check genotypes:</span></span></span>
<span class="r-in"><span><span class="va">modPhenoSpCheck</span> <span class="op">&lt;-</span> <span class="fu">fitModels</span><span class="op">(</span>TP <span class="op">=</span> <span class="va">phenoTP</span>,</span></span>
<span class="r-in"><span>                             trait <span class="op">=</span> <span class="st">"EffpsII"</span>,</span></span>
<span class="r-in"><span>                             extraFixedFactors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"repId"</span>, <span class="st">"Image_pos"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                             useCheck <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>                             timePoints <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 2018-06-01 11:37:00</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Fit a model with asreml on few time points with a spatial function:</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"asreml"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">modPhenoSpAs</span> <span class="op">&lt;-</span> <span class="fu">fitModels</span><span class="op">(</span>TP <span class="op">=</span> <span class="va">phenoTP</span>,</span></span>
<span class="r-in"><span>                            trait <span class="op">=</span> <span class="st">"EffpsII"</span>,</span></span>
<span class="r-in"><span>                            timePoints <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">6</span>, <span class="fl">20</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                            engine <span class="op">=</span> <span class="st">"asreml"</span>,</span></span>
<span class="r-in"><span>                            spatial <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Using the second example dataset (PhenoarchDat1):</span></span></span>
<span class="r-in"><span><span class="co">## Fit a model with SpATS on one time points with two variables for</span></span></span>
<span class="r-in"><span><span class="co">## geno.decomp:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"PhenoarchDat1"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">phenoTParch</span> <span class="op">&lt;-</span> <span class="fu"><a href="createTimePoints.html">createTimePoints</a></span><span class="op">(</span>dat <span class="op">=</span> <span class="va">PhenoarchDat1</span>,</span></span>
<span class="r-in"><span>                                experimentName <span class="op">=</span> <span class="st">"Phenoarch"</span>,</span></span>
<span class="r-in"><span>                                genotype <span class="op">=</span> <span class="st">"Genotype"</span>,</span></span>
<span class="r-in"><span>                                timePoint <span class="op">=</span> <span class="st">"Date"</span>,</span></span>
<span class="r-in"><span>                                plotId <span class="op">=</span> <span class="st">"pos"</span>,</span></span>
<span class="r-in"><span>                                rowNum <span class="op">=</span> <span class="st">"Row"</span>,</span></span>
<span class="r-in"><span>                                colNum <span class="op">=</span> <span class="st">"Col"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">modPhenoSpGD</span> <span class="op">&lt;-</span> <span class="fu">fitModels</span><span class="op">(</span>TP <span class="op">=</span> <span class="va">phenoTParch</span>,</span></span>
<span class="r-in"><span>                          trait <span class="op">=</span> <span class="st">"LeafArea"</span>,</span></span>
<span class="r-in"><span>                          geno.decomp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Scenario"</span>, <span class="st">"population"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                          timePoints <span class="op">=</span> <span class="fl">16</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 2017-04-28</span>
<span class="r-in"><span><span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Emilie J Millet, Maria Xose Rodriguez Alvarez, Diana Marcela Perez Valencia, Isabelle Sanchez, Nadine Hilgert, Bart-Jan van Rossum, Fred van Eeuwijk, Martin Boer.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

